<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.42">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>15&nbsp; Introduction to Correlation and Regression Analysis – Social Data Analysis: An Introduction (PL: Wprowadzenie do Analizy Danych Społecznych)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./correg_pl.html" rel="next">
<link href="./rozdzial6.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-2f5df379a58b258e96c21c0638c20c03.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-d5d78c9e45e9a5253a6059031ce5ea1b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>

<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">


  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@latest/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./correg_en.html"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Introduction to Correlation and Regression Analysis</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Social Data Analysis: An Introduction (PL: Wprowadzenie do Analizy Danych Społecznych)</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to Statistics and Data Analysis for Political Science</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Wprowadzenie do Statystyki i Analizy Danych dla Politologii</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Understanding Data Types in Social Sciences</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Typy Danych w Naukach Społecznych</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">From Sample to Population - Understanding Randomness, Sampling, and Inference</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial3.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Od Próby do Populacji - Zrozumienie Losowości, Pobierania Próby i Wnioskowania</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter3b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Reliability and Validity in Data Science Research</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial3b.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Rzetelność i Trafność w Badaniach Nauk o Danych</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Research Designs: Experimental and Non-Experimental Approaches</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial4.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Projekty Badawcze: Podejścia Eksperymentalne i Nieeksperymentalne</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Fundamentals of Univariate Descriptive Statistics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial5.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Podstawy Jednowymiarowej Statystyki Opisowej</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./chapter6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Data Visualization: with examples in R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rozdzial6.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Wizualizacja Danych: z przykładami w R</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correg_en.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Introduction to Correlation and Regression Analysis</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./correg_pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Wprowadzenie do Analizy Korelacji i Regresji</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability_en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Introduction to (Discrete) Probability</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./probability_pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Wprowadzenie do Prawdopodobieństwa</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./rv_pdf_en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Random Variables and Probability Distributions</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference_en.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">Statistical Hypothesis Testing: A Fundamental Logic</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inference_pl.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Wprowadzenie do Wnioskowania Statystycznego: Logika Testowania Hipotez Statystycznych</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">15.1</span> Introduction</a>
  <ul class="collapse">
  <li><a href="#covariance" id="toc-covariance" class="nav-link" data-scroll-target="#covariance">Covariance</a></li>
  <li><a href="#correlation-coefficient" id="toc-correlation-coefficient" class="nav-link" data-scroll-target="#correlation-coefficient">Correlation Coefficient</a></li>
  <li><a href="#historical-context" id="toc-historical-context" class="nav-link" data-scroll-target="#historical-context">Historical Context</a></li>
  </ul></li>
  <li><a href="#types-of-correlations" id="toc-types-of-correlations" class="nav-link" data-scroll-target="#types-of-correlations"><span class="header-section-number">15.2</span> Types of Correlations</a>
  <ul class="collapse">
  <li><a href="#pearson-correlation" id="toc-pearson-correlation" class="nav-link" data-scroll-target="#pearson-correlation">Pearson Correlation</a></li>
  <li><a href="#spearman-correlation" id="toc-spearman-correlation" class="nav-link" data-scroll-target="#spearman-correlation">Spearman Correlation</a></li>
  <li><a href="#cross-tabulation" id="toc-cross-tabulation" class="nav-link" data-scroll-target="#cross-tabulation">Cross-tabulation</a></li>
  <li><a href="#choosing-the-appropriate-measure" id="toc-choosing-the-appropriate-measure" class="nav-link" data-scroll-target="#choosing-the-appropriate-measure">Choosing the Appropriate Measure</a></li>
  </ul></li>
  <li><a href="#an-informal-introduction-to-regression" id="toc-an-informal-introduction-to-regression" class="nav-link" data-scroll-target="#an-informal-introduction-to-regression"><span class="header-section-number">15.3</span> An Informal Introduction to Regression</a>
  <ul class="collapse">
  <li><a href="#the-linear-regression-model" id="toc-the-linear-regression-model" class="nav-link" data-scroll-target="#the-linear-regression-model">The Linear Regression Model</a></li>
  <li><a href="#intuitive-understanding-of-best-fit-in-ols-regression" id="toc-intuitive-understanding-of-best-fit-in-ols-regression" class="nav-link" data-scroll-target="#intuitive-understanding-of-best-fit-in-ols-regression">Intuitive Understanding of “Best Fit” in OLS Regression</a></li>
  <li><a href="#visualizing-the-sum-of-squared-errors-in-linear-regression" id="toc-visualizing-the-sum-of-squared-errors-in-linear-regression" class="nav-link" data-scroll-target="#visualizing-the-sum-of-squared-errors-in-linear-regression">Visualizing the Sum of Squared Errors in Linear Regression</a></li>
  <li><a href="#visualizing-ols-through-different-lines" id="toc-visualizing-ols-through-different-lines" class="nav-link" data-scroll-target="#visualizing-ols-through-different-lines">Visualizing OLS Through Different Lines</a></li>
  <li><a href="#key-learning-points" id="toc-key-learning-points" class="nav-link" data-scroll-target="#key-learning-points">Key Learning Points</a></li>
  <li><a href="#the-ols-estimator" id="toc-the-ols-estimator" class="nav-link" data-scroll-target="#the-ols-estimator">The OLS Estimator</a></li>
  <li><a href="#model-interpretation-a-beginners-guide" id="toc-model-interpretation-a-beginners-guide" class="nav-link" data-scroll-target="#model-interpretation-a-beginners-guide">Model Interpretation: A Beginner’s Guide</a></li>
  </ul></li>
  <li><a href="#spurious-correlation-causes-and-examples" id="toc-spurious-correlation-causes-and-examples" class="nav-link" data-scroll-target="#spurious-correlation-causes-and-examples"><span class="header-section-number">15.4</span> Spurious Correlation: Causes and Examples</a>
  <ul class="collapse">
  <li><a href="#random-coincidence-chance" id="toc-random-coincidence-chance" class="nav-link" data-scroll-target="#random-coincidence-chance">Random Coincidence (Chance)</a></li>
  <li><a href="#confounding-variables-hidden-third-factors" id="toc-confounding-variables-hidden-third-factors" class="nav-link" data-scroll-target="#confounding-variables-hidden-third-factors">Confounding Variables (Hidden Third Factors)</a></li>
  <li><a href="#reverse-causality" id="toc-reverse-causality" class="nav-link" data-scroll-target="#reverse-causality">Reverse Causality</a></li>
  <li><a href="#collider-bias-selection-bias" id="toc-collider-bias-selection-bias" class="nav-link" data-scroll-target="#collider-bias-selection-bias">Collider Bias (Selection Bias)</a></li>
  <li><a href="#improper-analysis" id="toc-improper-analysis" class="nav-link" data-scroll-target="#improper-analysis">Improper Analysis</a></li>
  <li><a href="#endogeneity-and-its-sources" id="toc-endogeneity-and-its-sources" class="nav-link" data-scroll-target="#endogeneity-and-its-sources">Endogeneity and Its Sources</a></li>
  </ul></li>
  <li><a href="#methods-for-addressing-spurious-correlations" id="toc-methods-for-addressing-spurious-correlations" class="nav-link" data-scroll-target="#methods-for-addressing-spurious-correlations"><span class="header-section-number">15.5</span> Methods for Addressing Spurious Correlations</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion"><span class="header-section-number">15.6</span> Conclusion</a></li>
  <li><a href="#regression-analysis" id="toc-regression-analysis" class="nav-link" data-scroll-target="#regression-analysis"><span class="header-section-number">15.7</span> Regression Analysis</a>
  <ul class="collapse">
  <li><a href="#regression-as-a-stochastic-model" id="toc-regression-as-a-stochastic-model" class="nav-link" data-scroll-target="#regression-as-a-stochastic-model">Regression as a Stochastic Model</a></li>
  <li><a href="#why-study-regression" id="toc-why-study-regression" class="nav-link" data-scroll-target="#why-study-regression">Why Study Regression?</a></li>
  <li><a href="#basic-concepts-and-terminology" id="toc-basic-concepts-and-terminology" class="nav-link" data-scroll-target="#basic-concepts-and-terminology">Basic Concepts and Terminology</a></li>
  <li><a href="#the-core-idea" id="toc-the-core-idea" class="nav-link" data-scroll-target="#the-core-idea">The Core Idea</a></li>
  </ul></li>
  <li><a href="#the-linear-regression-model-1" id="toc-the-linear-regression-model-1" class="nav-link" data-scroll-target="#the-linear-regression-model-1"><span class="header-section-number">15.8</span> The Linear Regression Model</a>
  <ul class="collapse">
  <li><a href="#population-model-vs.-sample-estimates" id="toc-population-model-vs.-sample-estimates" class="nav-link" data-scroll-target="#population-model-vs.-sample-estimates">Population Model vs.&nbsp;Sample Estimates</a></li>
  </ul></li>
  <li><a href="#key-assumptions-of-linear-regression" id="toc-key-assumptions-of-linear-regression" class="nav-link" data-scroll-target="#key-assumptions-of-linear-regression"><span class="header-section-number">15.9</span> Key Assumptions of Linear Regression</a>
  <ul class="collapse">
  <li><a href="#strict-exogeneity-the-fundamental-assumption" id="toc-strict-exogeneity-the-fundamental-assumption" class="nav-link" data-scroll-target="#strict-exogeneity-the-fundamental-assumption">Strict Exogeneity: The Fundamental Assumption</a></li>
  <li><a href="#linearity-the-form-assumption" id="toc-linearity-the-form-assumption" class="nav-link" data-scroll-target="#linearity-the-form-assumption">Linearity: The Form Assumption</a></li>
  <li><a href="#understanding-violations-and-solutions" id="toc-understanding-violations-and-solutions" class="nav-link" data-scroll-target="#understanding-violations-and-solutions">Understanding Violations and Solutions</a></li>
  </ul></li>
  <li><a href="#assessing-model-fit" id="toc-assessing-model-fit" class="nav-link" data-scroll-target="#assessing-model-fit"><span class="header-section-number">15.10</span> Assessing Model Fit</a>
  <ul class="collapse">
  <li><a href="#decomposition-of-variance" id="toc-decomposition-of-variance" class="nav-link" data-scroll-target="#decomposition-of-variance">Decomposition of Variance</a></li>
  <li><a href="#understanding-the-three-types-of-variation" id="toc-understanding-the-three-types-of-variation" class="nav-link" data-scroll-target="#understanding-the-three-types-of-variation">Understanding the Three Types of Variation</a></li>
  <li><a href="#r²-demystified" id="toc-r²-demystified" class="nav-link" data-scroll-target="#r²-demystified">R² Demystified</a></li>
  <li><a href="#when-to-be-cautious" id="toc-when-to-be-cautious" class="nav-link" data-scroll-target="#when-to-be-cautious">When to Be Cautious</a></li>
  <li><a href="#practical-tips-for-analysis" id="toc-practical-tips-for-analysis" class="nav-link" data-scroll-target="#practical-tips-for-analysis">Practical Tips for Analysis</a></li>
  <li><a href="#key-takeaways" id="toc-key-takeaways" class="nav-link" data-scroll-target="#key-takeaways">Key Takeaways</a></li>
  <li><a href="#measures-of-fit" id="toc-measures-of-fit" class="nav-link" data-scroll-target="#measures-of-fit">Measures of Fit</a></li>
  </ul></li>
  <li><a href="#multiple-regression" id="toc-multiple-regression" class="nav-link" data-scroll-target="#multiple-regression"><span class="header-section-number">15.11</span> Multiple Regression (*)</a>
  <ul class="collapse">
  <li><a href="#extending-to-multiple-predictors" id="toc-extending-to-multiple-predictors" class="nav-link" data-scroll-target="#extending-to-multiple-predictors">Extending to Multiple Predictors</a></li>
  <li><a href="#interpretation-of-coefficients" id="toc-interpretation-of-coefficients" class="nav-link" data-scroll-target="#interpretation-of-coefficients">Interpretation of Coefficients</a></li>
  <li><a href="#multicollinearity" id="toc-multicollinearity" class="nav-link" data-scroll-target="#multicollinearity">Multicollinearity</a></li>
  </ul></li>
  <li><a href="#advanced-topics" id="toc-advanced-topics" class="nav-link" data-scroll-target="#advanced-topics"><span class="header-section-number">15.12</span> Advanced Topics</a>
  <ul class="collapse">
  <li><a href="#interaction-terms" id="toc-interaction-terms" class="nav-link" data-scroll-target="#interaction-terms">Interaction Terms</a></li>
  <li><a href="#polynomial-terms" id="toc-polynomial-terms" class="nav-link" data-scroll-target="#polynomial-terms">Polynomial Terms</a></li>
  </ul></li>
  <li><a href="#practical-guidelines-for-regression-analysis" id="toc-practical-guidelines-for-regression-analysis" class="nav-link" data-scroll-target="#practical-guidelines-for-regression-analysis"><span class="header-section-number">15.13</span> Practical Guidelines for Regression Analysis</a>
  <ul class="collapse">
  <li><a href="#model-building-process" id="toc-model-building-process" class="nav-link" data-scroll-target="#model-building-process">Model Building Process</a></li>
  <li><a href="#common-pitfalls-and-solutions" id="toc-common-pitfalls-and-solutions" class="nav-link" data-scroll-target="#common-pitfalls-and-solutions">Common Pitfalls and Solutions</a></li>
  <li><a href="#best-practices" id="toc-best-practices" class="nav-link" data-scroll-target="#best-practices">Best Practices</a></li>
  </ul></li>
  <li><a href="#conclusion-1" id="toc-conclusion-1" class="nav-link" data-scroll-target="#conclusion-1"><span class="header-section-number">15.14</span> Conclusion</a>
  <ul class="collapse">
  <li><a href="#key-takeaways-1" id="toc-key-takeaways-1" class="nav-link" data-scroll-target="#key-takeaways-1">Key Takeaways</a></li>
  <li><a href="#further-reading" id="toc-further-reading" class="nav-link" data-scroll-target="#further-reading">Further Reading</a></li>
  </ul></li>
  <li><a href="#appendix-a.1-understanding-correlation-measures-a-self-study-tutorial-using-stress-level-and-cognitive-performance-data" id="toc-appendix-a.1-understanding-correlation-measures-a-self-study-tutorial-using-stress-level-and-cognitive-performance-data" class="nav-link" data-scroll-target="#appendix-a.1-understanding-correlation-measures-a-self-study-tutorial-using-stress-level-and-cognitive-performance-data"><span class="header-section-number">15.15</span> Appendix A.1: Understanding Correlation Measures: A Self-Study Tutorial (Using Stress Level and Cognitive Performance Data)</a>
  <ul class="collapse">
  <li><a href="#dataset-overview" id="toc-dataset-overview" class="nav-link" data-scroll-target="#dataset-overview">Dataset Overview</a></li>
  <li><a href="#covariance-calculation" id="toc-covariance-calculation" class="nav-link" data-scroll-target="#covariance-calculation">1. Covariance Calculation</a></li>
  <li><a href="#pearson-correlation-coefficient" id="toc-pearson-correlation-coefficient" class="nav-link" data-scroll-target="#pearson-correlation-coefficient">2. Pearson Correlation Coefficient</a></li>
  <li><a href="#spearman-rank-correlation" id="toc-spearman-rank-correlation" class="nav-link" data-scroll-target="#spearman-rank-correlation">3. Spearman Rank Correlation</a></li>
  <li><a href="#verification-using-r" id="toc-verification-using-r" class="nav-link" data-scroll-target="#verification-using-r">Verification using R</a></li>
  <li><a href="#interpretation" id="toc-interpretation" class="nav-link" data-scroll-target="#interpretation">Interpretation</a></li>
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  </ul></li>
  <li><a href="#appendix-a.2-calculating-covariance-pearson-spearman-correlation-and-ols---worked-example" id="toc-appendix-a.2-calculating-covariance-pearson-spearman-correlation-and-ols---worked-example" class="nav-link" data-scroll-target="#appendix-a.2-calculating-covariance-pearson-spearman-correlation-and-ols---worked-example"><span class="header-section-number">15.16</span> Appendix A.2: Calculating Covariance, Pearson, Spearman Correlation, and OLS - worked example</a>
  <ul class="collapse">
  <li><a href="#step-1-calculate-basic-statistics" id="toc-step-1-calculate-basic-statistics" class="nav-link" data-scroll-target="#step-1-calculate-basic-statistics">Step 1: Calculate Basic Statistics</a></li>
  <li><a href="#step-2-detailed-covariance-calculations" id="toc-step-2-detailed-covariance-calculations" class="nav-link" data-scroll-target="#step-2-detailed-covariance-calculations">Step 2: Detailed Covariance Calculations</a></li>
  <li><a href="#step-3-standard-deviation-calculations" id="toc-step-3-standard-deviation-calculations" class="nav-link" data-scroll-target="#step-3-standard-deviation-calculations">Step 3: Standard Deviation Calculations</a></li>
  <li><a href="#step-4-pearson-correlation-calculation" id="toc-step-4-pearson-correlation-calculation" class="nav-link" data-scroll-target="#step-4-pearson-correlation-calculation">Step 4: Pearson Correlation Calculation</a></li>
  <li><a href="#step-5-spearman-rank-correlation-calculation" id="toc-step-5-spearman-rank-correlation-calculation" class="nav-link" data-scroll-target="#step-5-spearman-rank-correlation-calculation">Step 5: Spearman Rank Correlation Calculation</a></li>
  <li><a href="#step-6-r-verification" id="toc-step-6-r-verification" class="nav-link" data-scroll-target="#step-6-r-verification">Step 6: R Verification</a></li>
  <li><a href="#step-7-basic-visualization" id="toc-step-7-basic-visualization" class="nav-link" data-scroll-target="#step-7-basic-visualization">Step 7: Basic Visualization</a></li>
  <li><a href="#ols-estimation-and-goodness-of-fit-measures" id="toc-ols-estimation-and-goodness-of-fit-measures" class="nav-link" data-scroll-target="#ols-estimation-and-goodness-of-fit-measures">OLS Estimation and Goodness-of-Fit Measures</a></li>
  <li><a href="#step-1-calculate-ols-estimates" id="toc-step-1-calculate-ols-estimates" class="nav-link" data-scroll-target="#step-1-calculate-ols-estimates">Step 1: Calculate OLS Estimates</a></li>
  <li><a href="#step-2-calculate-fitted-values-and-residuals" id="toc-step-2-calculate-fitted-values-and-residuals" class="nav-link" data-scroll-target="#step-2-calculate-fitted-values-and-residuals">Step 2: Calculate Fitted Values and Residuals</a></li>
  <li><a href="#step-3-calculate-goodness-of-fit-measures" id="toc-step-3-calculate-goodness-of-fit-measures" class="nav-link" data-scroll-target="#step-3-calculate-goodness-of-fit-measures">Step 3: Calculate Goodness-of-Fit Measures</a></li>
  <li><a href="#step-4-r-verification" id="toc-step-4-r-verification" class="nav-link" data-scroll-target="#step-4-r-verification">Step 4: R Verification</a></li>
  <li><a href="#step-5-residual-analysis" id="toc-step-5-residual-analysis" class="nav-link" data-scroll-target="#step-5-residual-analysis">Step 5: Residual Analysis</a></li>
  <li><a href="#step-6-predicted-vs-actual-values-plot" id="toc-step-6-predicted-vs-actual-values-plot" class="nav-link" data-scroll-target="#step-6-predicted-vs-actual-values-plot">Step 6: Predicted vs Actual Values Plot</a></li>
  <li><a href="#log-transformed-models" id="toc-log-transformed-models" class="nav-link" data-scroll-target="#log-transformed-models">Log-Transformed Models</a></li>
  <li><a href="#step-1-data-transformation" id="toc-step-1-data-transformation" class="nav-link" data-scroll-target="#step-1-data-transformation">Step 1: Data Transformation</a></li>
  <li><a href="#step-2-compare-different-model-specifications" id="toc-step-2-compare-different-model-specifications" class="nav-link" data-scroll-target="#step-2-compare-different-model-specifications">Step 2: Compare Different Model Specifications</a></li>
  <li><a href="#step-3-visual-comparison" id="toc-step-3-visual-comparison" class="nav-link" data-scroll-target="#step-3-visual-comparison">Step 3: Visual Comparison</a></li>
  <li><a href="#step-4-residual-analysis-for-best-model" id="toc-step-4-residual-analysis-for-best-model" class="nav-link" data-scroll-target="#step-4-residual-analysis-for-best-model">Step 4: Residual Analysis for Best Model</a></li>
  <li><a href="#step-5-interpretation-of-best-model" id="toc-step-5-interpretation-of-best-model" class="nav-link" data-scroll-target="#step-5-interpretation-of-best-model">Step 5: Interpretation of Best Model</a></li>
  <li><a href="#step-6-model-predictions" id="toc-step-6-model-predictions" class="nav-link" data-scroll-target="#step-6-model-predictions">Step 6: Model Predictions</a></li>
  <li><a href="#step-7-elasticity-analysis" id="toc-step-7-elasticity-analysis" class="nav-link" data-scroll-target="#step-7-elasticity-analysis">Step 7: Elasticity Analysis</a></li>
  </ul></li>
  <li><a href="#appendix-a.3-understanding-pearson-spearman-and-kendall" id="toc-appendix-a.3-understanding-pearson-spearman-and-kendall" class="nav-link" data-scroll-target="#appendix-a.3-understanding-pearson-spearman-and-kendall"><span class="header-section-number">15.17</span> Appendix A.3: Understanding Pearson, Spearman, and Kendall</a>
  <ul class="collapse">
  <li><a href="#dataset" id="toc-dataset" class="nav-link" data-scroll-target="#dataset">Dataset</a></li>
  <li><a href="#pearson-correlation-1" id="toc-pearson-correlation-1" class="nav-link" data-scroll-target="#pearson-correlation-1">Pearson Correlation</a></li>
  <li><a href="#spearman-correlation-1" id="toc-spearman-correlation-1" class="nav-link" data-scroll-target="#spearman-correlation-1">Spearman Correlation</a></li>
  <li><a href="#kendalls-tau" id="toc-kendalls-tau" class="nav-link" data-scroll-target="#kendalls-tau">Kendall’s Tau</a></li>
  <li><a href="#verification-in-r" id="toc-verification-in-r" class="nav-link" data-scroll-target="#verification-in-r">Verification in R</a></li>
  <li><a href="#interpretation-of-results" id="toc-interpretation-of-results" class="nav-link" data-scroll-target="#interpretation-of-results">Interpretation of Results</a></li>
  <li><a href="#comparison-of-measures" id="toc-comparison-of-measures" class="nav-link" data-scroll-target="#comparison-of-measures">Comparison of Measures</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a></li>
  <li><a href="#key-points-to-remember" id="toc-key-points-to-remember" class="nav-link" data-scroll-target="#key-points-to-remember">Key Points to Remember</a></li>
  </ul></li>
  <li><a href="#appendix-b-bias-in-ols-estimation-with-endogenous-regressors" id="toc-appendix-b-bias-in-ols-estimation-with-endogenous-regressors" class="nav-link" data-scroll-target="#appendix-b-bias-in-ols-estimation-with-endogenous-regressors"><span class="header-section-number">15.18</span> Appendix B: Bias in OLS Estimation with Endogenous Regressors</a></li>
  <li><a href="#theoretical-derivation" id="toc-theoretical-derivation" class="nav-link" data-scroll-target="#theoretical-derivation"><span class="header-section-number">15.19</span> Theoretical Derivation</a></li>
  <li><a href="#simulation-in-r" id="toc-simulation-in-r" class="nav-link" data-scroll-target="#simulation-in-r"><span class="header-section-number">15.20</span> Simulation in R</a></li>
  <li><a href="#conclusion-2" id="toc-conclusion-2" class="nav-link" data-scroll-target="#conclusion-2"><span class="header-section-number">15.21</span> Conclusion</a></li>
  <li><a href="#appendix-c.-worked-examples" id="toc-appendix-c.-worked-examples" class="nav-link" data-scroll-target="#appendix-c.-worked-examples"><span class="header-section-number">15.22</span> Appendix C. Worked Examples</a></li>
  <li><a href="#descriptive-statistics-and-ols-example---income-and-voter-turnout" id="toc-descriptive-statistics-and-ols-example---income-and-voter-turnout" class="nav-link" data-scroll-target="#descriptive-statistics-and-ols-example---income-and-voter-turnout"><span class="header-section-number">15.23</span> Descriptive Statistics and OLS Example - Income and Voter Turnout</a>
  <ul class="collapse">
  <li><a href="#initial-r-output-for-reference" id="toc-initial-r-output-for-reference" class="nav-link" data-scroll-target="#initial-r-output-for-reference">Initial R Output for Reference</a></li>
  <li><a href="#dispersion-measures" id="toc-dispersion-measures" class="nav-link" data-scroll-target="#dispersion-measures">Dispersion Measures</a></li>
  <li><a href="#covariance-and-correlation" id="toc-covariance-and-correlation" class="nav-link" data-scroll-target="#covariance-and-correlation">Covariance and Correlation</a></li>
  <li><a href="#ols-regression-haty-hatbeta_0-hatbeta_1x" id="toc-ols-regression-haty-hatbeta_0-hatbeta_1x" class="nav-link" data-scroll-target="#ols-regression-haty-hatbeta_0-hatbeta_1x">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></a></li>
  <li><a href="#detailed-decomposition-of-variance-and-r-squared" id="toc-detailed-decomposition-of-variance-and-r-squared" class="nav-link" data-scroll-target="#detailed-decomposition-of-variance-and-r-squared">Detailed Decomposition of Variance and R-squared</a></li>
  <li><a href="#visualization" id="toc-visualization" class="nav-link" data-scroll-target="#visualization">Visualization</a></li>
  <li><a href="#interpretation-1" id="toc-interpretation-1" class="nav-link" data-scroll-target="#interpretation-1">Interpretation</a></li>
  </ul></li>
  <li><a href="#anxiety-levels-and-cognitive-performance-a-laboratory-study" id="toc-anxiety-levels-and-cognitive-performance-a-laboratory-study" class="nav-link" data-scroll-target="#anxiety-levels-and-cognitive-performance-a-laboratory-study"><span class="header-section-number">15.24</span> Anxiety Levels and Cognitive Performance: A Laboratory Study</a>
  <ul class="collapse">
  <li><a href="#data-and-context" id="toc-data-and-context" class="nav-link" data-scroll-target="#data-and-context">Data and Context</a></li>
  <li><a href="#descriptive-statistics" id="toc-descriptive-statistics" class="nav-link" data-scroll-target="#descriptive-statistics">Descriptive Statistics</a></li>
  <li><a href="#covariance-and-correlation-1" id="toc-covariance-and-correlation-1" class="nav-link" data-scroll-target="#covariance-and-correlation-1">Covariance and Correlation</a></li>
  <li><a href="#ols-regression-haty-hatbeta_0-hatbeta_1x-1" id="toc-ols-regression-haty-hatbeta_0-hatbeta_1x-1" class="nav-link" data-scroll-target="#ols-regression-haty-hatbeta_0-hatbeta_1x-1">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></a></li>
  <li><a href="#r-squared-calculation" id="toc-r-squared-calculation" class="nav-link" data-scroll-target="#r-squared-calculation">4. R-squared Calculation</a></li>
  <li><a href="#visualization-1" id="toc-visualization-1" class="nav-link" data-scroll-target="#visualization-1">Visualization</a></li>
  <li><a href="#interpretation-2" id="toc-interpretation-2" class="nav-link" data-scroll-target="#interpretation-2">Interpretation</a></li>
  <li><a href="#study-limitations" id="toc-study-limitations" class="nav-link" data-scroll-target="#study-limitations">Study Limitations</a></li>
  </ul></li>
  <li><a href="#district-magnitude-and-electoral-disproportionality-a-comparative-analysis" id="toc-district-magnitude-and-electoral-disproportionality-a-comparative-analysis" class="nav-link" data-scroll-target="#district-magnitude-and-electoral-disproportionality-a-comparative-analysis"><span class="header-section-number">15.25</span> District Magnitude and Electoral Disproportionality: A Comparative Analysis</a>
  <ul class="collapse">
  <li><a href="#data-generating-process" id="toc-data-generating-process" class="nav-link" data-scroll-target="#data-generating-process">Data Generating Process</a></li>
  <li><a href="#descriptive-statistics-1" id="toc-descriptive-statistics-1" class="nav-link" data-scroll-target="#descriptive-statistics-1">Descriptive Statistics</a></li>
  <li><a href="#covariance-and-correlation-2" id="toc-covariance-and-correlation-2" class="nav-link" data-scroll-target="#covariance-and-correlation-2">Covariance and Correlation</a></li>
  <li><a href="#ols-regression-haty-hatbeta_0-hatbeta_1x-2" id="toc-ols-regression-haty-hatbeta_0-hatbeta_1x-2" class="nav-link" data-scroll-target="#ols-regression-haty-hatbeta_0-hatbeta_1x-2">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></a></li>
  <li><a href="#r-squared-calculation-1" id="toc-r-squared-calculation-1" class="nav-link" data-scroll-target="#r-squared-calculation-1">R-squared Calculation</a></li>
  <li><a href="#visualization---true-vs.-estimated-parameters" id="toc-visualization---true-vs.-estimated-parameters" class="nav-link" data-scroll-target="#visualization---true-vs.-estimated-parameters">Visualization - True vs.&nbsp;Estimated Parameters</a></li>
  <li><a href="#observations-about-model-fit" id="toc-observations-about-model-fit" class="nav-link" data-scroll-target="#observations-about-model-fit">Observations about Model Fit</a></li>
  <li><a href="#interpretation-3" id="toc-interpretation-3" class="nav-link" data-scroll-target="#interpretation-3">Interpretation</a></li>
  <li><a href="#study-context" id="toc-study-context" class="nav-link" data-scroll-target="#study-context">Study Context</a></li>
  <li><a href="#limitations" id="toc-limitations" class="nav-link" data-scroll-target="#limitations">Limitations</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Introduction to Correlation and Regression Analysis</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2" data-number="15.1">
<h2 data-number="15.1" class="anchored" data-anchor-id="introduction"><span class="header-section-number">15.1</span> Introduction</h2>
<p>The distinction between correlation and causation represents a fundamental challenge in statistical analysis. While correlation measures the statistical association between variables, causation implies a direct influence of one variable on another. This chapter explores this distinction and examines common issues that lead to spurious correlations in empirical research.</p>
<p>Statistical relationships form the backbone of data-driven decision making across disciplines—from economics and public health to psychology and environmental science. Understanding when a relationship indicates mere association versus genuine causality is crucial for valid inference and effective policy recommendations.</p>
<section id="covariance" class="level3">
<h3 class="anchored" data-anchor-id="covariance">Covariance</h3>
<p>Covariance measures how two variables vary together, indicating both the direction and magnitude of their linear relationship.</p>
<p><strong>Formula:</strong> <span class="math inline">cov(X,Y) = \frac{\sum_{i=1}^n (x_i - \bar{x})(y_i - \bar{y})}{n - 1}</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">x_i</span> and <span class="math inline">y_i</span> are individual data points</li>
<li><span class="math inline">\bar{x}</span> and <span class="math inline">\bar{y}</span> are the means of variables X and Y</li>
<li><span class="math inline">n</span> is the number of observations</li>
</ul>
<p>Covariance produces positive values when variables tend to increase together, negative values when one increases as the other decreases, and values near zero when there’s little linear relationship. However, the scale-dependence of covariance makes interpretation challenging across different measurement units.</p>
<p><strong>Manual Calculation Example:</strong></p>
<p>Let’s calculate the covariance for two variables:</p>
<ul>
<li>x: 1, 2, 3, 4, 5</li>
<li>y: 2, 4, 5, 4, 5</li>
</ul>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Description</th>
<th>Calculation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Calculate means</td>
<td><span class="math inline">\bar{x} = 3, \bar{y} = 4</span></td>
</tr>
<tr class="even">
<td>2</td>
<td>Calculate <span class="math inline">(x_i - \bar{x})(y_i - \bar{y})</span> for each pair</td>
<td><span class="math inline">(-2)(-2) = 4</span></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><span class="math inline">(-1)(0) = 0</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">(0)(1) = 0</span></td>
</tr>
<tr class="odd">
<td></td>
<td></td>
<td><span class="math inline">(1)(0) = 0</span></td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td><span class="math inline">(2)(1) = 2</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Sum the results</td>
<td><span class="math inline">4 + 0 + 0 + 0 + 2 = 6</span></td>
</tr>
<tr class="even">
<td>4</td>
<td>Divide by (n-1)</td>
<td><span class="math inline">6 / 4 = 1.5</span></td>
</tr>
</tbody>
</table>
<p><strong>R calculation:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(x, y)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.5</code></pre>
</div>
</div>
<p><strong>Interpretation:</strong> - The positive covariance (1.5) indicates that x and y tend to increase together.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Provides direction of relationship (positive or negative)</li>
<li>Useful in calculating other measures like correlation</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Scale-dependent, making it difficult to compare across different variable pairs</li>
<li>Doesn’t provide information about the strength of the relationship</li>
</ul>
</section>
<section id="correlation-coefficient" class="level3">
<h3 class="anchored" data-anchor-id="correlation-coefficient">Correlation Coefficient</h3>
<p>To address the scale-dependency limitations of covariance, the correlation coefficient standardizes the measure to a range between -1 and 1.</p>
<p><strong>Pearson’s Correlation Formula:</strong> <span class="math inline">r = \frac{cov(X,Y)}{s_X s_Y} = \frac{\sum_{i=1}^n (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^n (x_i - \bar{x})^2 \sum_{i=1}^n (y_i - \bar{y})^2}}</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">s_X</span> and <span class="math inline">s_Y</span> are the standard deviations of X and Y</li>
</ul>
<p>The correlation coefficient provides a standardized measure of linear association that facilitates comparison across different variable pairs and datasets.</p>
</section>
<section id="historical-context" class="level3">
<h3 class="anchored" data-anchor-id="historical-context">Historical Context</h3>
<p>The concepts of correlation and regression were formalized in the late 19th century by Sir Francis Galton and later expanded by Karl Pearson. Their work revolutionized data analysis by providing mathematical frameworks to quantify relationships between variables. Today, these techniques remain fundamental in fields ranging from genomics to finance, forming the basis for more advanced statistical methods.</p>
<p>In the next sections, we’ll explore correlation and regression in depth, examining their assumptions, limitations, and applications to real-world data analysis challenges.</p>
</section>
</section>
<section id="types-of-correlations" class="level2" data-number="15.2">
<h2 data-number="15.2" class="anchored" data-anchor-id="types-of-correlations"><span class="header-section-number">15.2</span> Types of Correlations</h2>
<p>Correlation measures the strength and direction of the linear relationship between two variables. The Pearson correlation coefficient (r) ranges from -1 to +1:</p>
<ul>
<li>+1 indicates a perfect positive correlation</li>
<li>0 indicates no correlation</li>
<li>-1 indicates a perfect negative correlation</li>
</ul>
<p>The following visualizations demonstrate different types of relationships:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample data with different correlation patterns</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="co"># sample size</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Positive linear correlation (education and income)</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>years_education <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">14</span>, <span class="dv">3</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>annual_income <span class="ot">&lt;-</span> <span class="dv">15000</span> <span class="sc">+</span> <span class="dv">3500</span> <span class="sc">*</span> years_education <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">10000</span>)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Negative linear correlation (screen time and sleep)</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>screen_time <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>sleep_hours <span class="ot">&lt;-</span> <span class="dv">9</span> <span class="sc">-</span> <span class="fl">0.5</span> <span class="sc">*</span> screen_time <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co"># No correlation (random data)</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>x_random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">50</span>, <span class="dv">10</span>)</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>y_random <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">50</span>, <span class="dv">10</span>)</span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Non-linear correlation (quadratic relationship)</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>hours_studied <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">12</span>)</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>test_score <span class="ot">&lt;-</span> <span class="sc">-</span><span class="dv">2</span> <span class="sc">*</span> (hours_studied <span class="sc">-</span> <span class="dv">6</span>)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="dv">90</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frames</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>positive_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> years_education, <span class="at">y =</span> annual_income, </span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>                          <span class="at">label =</span> <span class="st">"Positive Linear: Education &amp; Income"</span>)</span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>negative_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> screen_time, <span class="at">y =</span> sleep_hours, </span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>                          <span class="at">label =</span> <span class="st">"Negative Linear: Screen Time &amp; Sleep"</span>)</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>no_corr_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_random, <span class="at">y =</span> y_random, </span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>                          <span class="at">label =</span> <span class="st">"No Correlation: Random Variables"</span>)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>nonlinear_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> hours_studied, <span class="at">y =</span> test_score, </span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>                          <span class="at">label =</span> <span class="st">"Non-linear: Study Hours &amp; Test Score"</span>)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine data for faceted plot</span></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>  positive_data,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  negative_data,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  no_corr_data,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>  nonlinear_data</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a><span class="co"># Create faceted plot</span></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(all_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> label, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Different Types of Correlations"</span>,</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">""</span>,</span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">""</span></span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/correlation_types-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>For the non-linear relationship, a linear model is inadequate. A quadratic model better captures the relationship:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nonlinear_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Non-linear Correlation: Study Hours &amp; Test Score"</span>,</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Linear model (red) vs. Quadratic model (green)"</span>,</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Hours Studied"</span>,</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Test Score"</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/nonlinear_correlation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="pearson-correlation" class="level3">
<h3 class="anchored" data-anchor-id="pearson-correlation">Pearson Correlation</h3>
<p>Pearson correlation measures the strength and direction of the linear relationship between two continuous variables.</p>
<p><strong>Formula:</strong> <span class="math inline">r = \frac{cov(X,Y)}{s_X s_Y} = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}}</span></p>
<p><strong>Manual Calculation Example:</strong></p>
<p>Using the same data as above:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Step</th>
<th>Description</th>
<th>Calculation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Calculate covariance</td>
<td>(From previous calculation) 1.5</td>
</tr>
<tr class="even">
<td>2</td>
<td>Calculate standard deviations</td>
<td><span class="math inline">s_X = \sqrt{\frac{10}{4}} = 1.58, s_Y = \sqrt{\frac{6}{4}} = 1.22</span></td>
</tr>
<tr class="odd">
<td>3</td>
<td>Divide covariance by product of standard deviations</td>
<td><span class="math inline">1.5 / (1.58 * 1.22) = 0.7746</span></td>
</tr>
</tbody>
</table>
<p><strong>R calculation:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7745967</code></pre>
</div>
</div>
<p><strong>Interpretation:</strong> - The correlation coefficient of 0.7746 indicates a strong positive linear relationship between x and y.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Scale-independent, always between -1 and 1</li>
<li>Widely understood and used</li>
<li>Tests for linear relationships</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Sensitive to outliers</li>
<li>Only measures linear relationships</li>
<li>Assumes normally distributed variables</li>
</ul>
</section>
<section id="spearman-correlation" class="level3">
<h3 class="anchored" data-anchor-id="spearman-correlation">Spearman Correlation</h3>
<p>Spearman correlation measures the strength and direction of the monotonic relationship between two variables, which can be continuous or ordinal.</p>
<p><strong>Formula:</strong> <span class="math inline">\rho = 1 - \frac{6 \sum d_i^2}{n(n^2 - 1)}</span>, where <span class="math inline">d_i</span> is the difference between ranks.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Ranks: Positions in an Ordered Sequence
</div>
</div>
<div class="callout-body-container callout-body">
<p>Ranks are simply position numbers in an ordered dataset:</p>
<section id="how-to-determine-ranks" class="level3">
<h3 class="anchored" data-anchor-id="how-to-determine-ranks">How to Determine Ranks?</h3>
<ol type="1">
<li><p>Order data from smallest to largest value</p></li>
<li><p>Assign consecutive natural numbers:</p>
<ul>
<li>Smallest value → rank 1</li>
<li>Subsequent values → subsequent ranks</li>
<li>Largest value → rank n (number of observations)</li>
<li>For ties → average of ranks</li>
</ul></li>
</ol>
</section>
<section id="example" class="level3">
<h3 class="anchored" data-anchor-id="example">Example</h3>
<p>We have 5 students with heights:</p>
<pre><code>Height:    165, 182, 170, 168, 175
Ranks:      1,   5,   3,   2,   4</code></pre>
<p>For data with ties (e.g., grades):</p>
<pre><code>Grades:     2,   3,   3,   4,   5
Ranks:      1,  2.5, 2.5,  4,   5</code></pre>
</section>
</div>
</div>
<p><strong>Manual Calculation Example:</strong></p>
<p>Let’s use slightly different data:</p>
<ul>
<li>x: 1, 2, 3, 4, 5</li>
<li>y: 1, 3, 2, 5, 4</li>
</ul>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Step</th>
<th>Description</th>
<th>Calculation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>Rank both variables</td>
<td>x_rank: 1, 2, 3, 4, 5</td>
</tr>
<tr class="even">
<td></td>
<td></td>
<td>y_rank: 1, 3, 2, 5, 4</td>
</tr>
<tr class="odd">
<td>2</td>
<td>Calculate differences in ranks (d)</td>
<td>0, -1, 1, -1, 1</td>
</tr>
<tr class="even">
<td>3</td>
<td>Square the differences</td>
<td>0, 1, 1, 1, 1</td>
</tr>
<tr class="odd">
<td>4</td>
<td>Sum the squared differences</td>
<td><span class="math inline">\sum d_i^2 = 4</span></td>
</tr>
<tr class="even">
<td>5</td>
<td>Apply the formula</td>
<td><span class="math inline">\rho = 1 - \frac{6(4)}{5(5^2 - 1)} = 0.8</span></td>
</tr>
</tbody>
</table>
<p><strong>R calculation:</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(x, y, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8</code></pre>
</div>
</div>
<p><strong>Interpretation:</strong> - The Spearman correlation of 0.8 indicates a strong positive monotonic relationship between x and y.</p>
<p><strong>Pros:</strong></p>
<ul>
<li>Robust to outliers</li>
<li>Can detect non-linear monotonic relationships</li>
<li>Suitable for ordinal data</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Less powerful than Pearson for detecting linear relationships in normally distributed data</li>
<li>Doesn’t provide information about the shape of the relationship beyond monotonicity</li>
</ul>
</section>
<section id="cross-tabulation" class="level3">
<h3 class="anchored" data-anchor-id="cross-tabulation">Cross-tabulation</h3>
<p>Cross-tabulation (contingency table) shows the relationship between two categorical variables.</p>
<p><strong>Example:</strong></p>
<p>Let’s create a cross-tabulation of two variables: - Education level: High School, College, Graduate - Employment status: Employed, Unemployed</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"High School"</span>, <span class="st">"College"</span>, <span class="st">"Graduate"</span>, <span class="st">"High School"</span>, <span class="st">"College"</span>, <span class="st">"Graduate"</span>, <span class="st">"High School"</span>, <span class="st">"College"</span>, <span class="st">"Graduate"</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>employment <span class="ot">&lt;-</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">"Employed"</span>, <span class="st">"Employed"</span>, <span class="st">"Employed"</span>, <span class="st">"Unemployed"</span>, <span class="st">"Employed"</span>, <span class="st">"Employed"</span>, <span class="st">"Unemployed"</span>, <span class="st">"Unemployed"</span>, <span class="st">"Employed"</span>))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(education, employment)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             employment
education     Employed Unemployed
  College            2          1
  Graduate           3          0
  High School        1          2</code></pre>
</div>
</div>
<p><strong>Interpretation:</strong></p>
<ul>
<li>This table shows the count of individuals in each combination of education level and employment status.</li>
<li>For example, we can see how many high school graduates are employed versus unemployed.</li>
</ul>
<p><strong>Pros:</strong></p>
<ul>
<li>Provides a clear visual representation of the relationship between categorical variables</li>
<li>Easy to understand and interpret</li>
<li>Basis for many statistical tests (e.g., chi-square test of independence)</li>
</ul>
<p><strong>Cons:</strong></p>
<ul>
<li>Limited to categorical data</li>
<li>Can become unwieldy with many categories</li>
<li>Doesn’t provide a single summary statistic of association strength</li>
</ul>
</section>
<section id="choosing-the-appropriate-measure" class="level3">
<h3 class="anchored" data-anchor-id="choosing-the-appropriate-measure">Choosing the Appropriate Measure</h3>
<p>When deciding which bivariate statistic to use, consider:</p>
<ol type="1">
<li><p>Data type:</p>
<ul>
<li>Continuous data: Covariance, Pearson correlation</li>
<li>Ordinal data: Spearman correlation</li>
<li>Categorical data: Cross-tabulation</li>
</ul></li>
<li><p>Relationship type:</p>
<ul>
<li>Linear: Pearson correlation</li>
<li>Monotonic but potentially non-linear: Spearman correlation</li>
</ul></li>
<li><p>Presence of outliers:</p>
<ul>
<li>If outliers are a concern, Spearman correlation is more robust</li>
</ul></li>
<li><p>Distribution:</p>
<ul>
<li>For normally distributed data, Pearson correlation is most powerful</li>
<li>For non-normal distributions, consider Spearman correlation</li>
</ul></li>
<li><p>Sample size:</p>
<ul>
<li>For very small samples, non-parametric methods like Spearman correlation might be preferred</li>
</ul></li>
</ol>
<p>Remember, it’s often valuable to use multiple measures and visualizations (like scatter plots) to get a comprehensive understanding of the relationship between variables.</p>
<hr>
</section>
</section>
<section id="an-informal-introduction-to-regression" class="level2" data-number="15.3">
<h2 data-number="15.3" class="anchored" data-anchor-id="an-informal-introduction-to-regression"><span class="header-section-number">15.3</span> An Informal Introduction to Regression</h2>
<p>Regression analysis provides a framework for modeling the relationship between a dependent variable and one or more independent variables. The Ordinary Least Squares (OLS) method minimizes the sum of squared residuals to find the line of best fit.</p>
<section id="the-linear-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="the-linear-regression-model">The Linear Regression Model</h3>
<p>The simple linear regression model can be expressed as:</p>
<p><span class="math inline">Y_i = \beta_0 + \beta_1 X_i + \varepsilon_i</span></p>
<p>Where:</p>
<ul>
<li><p><span class="math inline">Y_i</span> is the dependent variable for observation <span class="math inline">i</span></p></li>
<li><p><span class="math inline">X_i</span> is the independent variable for observation <span class="math inline">i</span></p></li>
<li><p><span class="math inline">\beta_0</span> is the intercept</p></li>
<li><p><span class="math inline">\beta_1</span> is the slope coefficient</p></li>
<li><p><span class="math inline">\varepsilon_i</span> is the error term (residuals)</p></li>
</ul>
<p>Multiple regression extends this to include several predictors:</p>
<p><span class="math display">
Y_i = \beta_0 + \beta_1 X_{1i} + \beta_2 X_{2i} + ... + \beta_k X_{ki} + \varepsilon_i
</span></p>
</section>
<section id="intuitive-understanding-of-best-fit-in-ols-regression" class="level3">
<h3 class="anchored" data-anchor-id="intuitive-understanding-of-best-fit-in-ols-regression">Intuitive Understanding of “Best Fit” in OLS Regression</h3>
<section id="what-does-best-fit-actually-mean" class="level4">
<h4 class="anchored" data-anchor-id="what-does-best-fit-actually-mean">What does “best fit” actually mean?</h4>
<p>In regression analysis, we want to find a line that best represents the relationship between our variables. But what makes a line the “best”?</p>
<p>Imagine you have a scatter plot of data points. There are infinitely many lines you could draw through these points. The <strong>line of best fit</strong> is the one that minimizes the overall distance between the line and all data points.</p>
</section>
<section id="why-do-we-use-the-sum-of-squared-errors-sse" class="level4">
<h4 class="anchored" data-anchor-id="why-do-we-use-the-sum-of-squared-errors-sse">Why do we use the sum of squared errors (SSE)?</h4>
<p>The OLS method defines “best fit” as the line that minimizes the sum of squared errors:</p>
<p><span class="math display">
SSE = \sum_{i=1}^{n} (Y_i - \hat{Y}_i)^2 = \sum_{i=1}^{n} e_i^2
</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">Y_i</span> is the actual observed value</li>
<li><span class="math inline">\hat{Y}_i</span> is the predicted value from our regression line</li>
<li><span class="math inline">e_i</span> is the residual (error) for each observation</li>
</ul>
<p>But why square the errors? There are four main reasons:</p>
<ol type="1">
<li><p><strong>Treating positive and negative errors equally</strong>: By squaring, we ensure that points above and below the line contribute equally to our measure of fit.</p></li>
<li><p><strong>Avoiding error cancellation</strong>: If we used the simple sum of errors <span class="math inline">\sum (Y_i - \hat{Y}_i)</span>, we would always get zero for an OLS regression line because positive and negative deviations cancel each other out. In fact, it can be mathematically proven that for an OLS regression line, the sum of residuals always equals zero: <span class="math inline">\sum e_i = 0</span>. Squaring prevents this cancellation effect.</p></li>
<li><p><strong>Penalizing large errors more</strong>: Squaring gives more weight to large errors, making the line more responsive to outliers.</p></li>
<li><p><strong>Mathematical advantages</strong>: The quadratic objective function has several mathematical advantages:</p>
<ul>
<li>It creates a convex function with a single global minimum</li>
<li>The derivative of a quadratic function is linear, leading to closed-form solutions</li>
<li>This allows for direct analytical derivation of regression coefficients</li>
<li>Other error measures (such as the sum of absolute deviations) don’t have these properties and often require iterative methods to find a solution</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample data</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">42</span>)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">30</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create base plot</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(x, y, <span class="at">pch=</span><span class="dv">16</span>, <span class="at">col=</span><span class="st">"darkblue"</span>, </span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>     <span class="at">main=</span><span class="st">"Visualization of Ordinary Least Squares (OLS)"</span>, </span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab=</span><span class="st">"X"</span>, <span class="at">ylab=</span><span class="st">"Y"</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add regression line</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(model, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Add residual lines</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="fu">segments</span>(x, y, x, <span class="fu">fitted</span>(model), <span class="at">col=</span><span class="st">"green"</span>, <span class="at">lwd=</span><span class="fl">1.5</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">"Data points"</span>, <span class="st">"Regression line"</span>, <span class="st">"Residuals"</span>), </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"darkblue"</span>, <span class="st">"red"</span>, <span class="st">"green"</span>), <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">16</span>, <span class="cn">NA</span>, <span class="cn">NA</span>), </span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty=</span><span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">lwd=</span><span class="fu">c</span>(<span class="cn">NA</span>, <span class="dv">2</span>, <span class="fl">1.5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/ols-visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This visualization shows how the least squares method minimizes the squares of the lengths of the green lines (residuals). The red line has been chosen so that the sum of squares of these deviations is the smallest of all possible straight lines.</p>
</section>
</section>
<section id="visualizing-the-sum-of-squared-errors-in-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-sum-of-squared-errors-in-linear-regression">Visualizing the Sum of Squared Errors in Linear Regression</h3>
<p>To understand the concept visually:</p>
<ol type="1">
<li>Imagine each error as a vertical line from the data point to the regression line</li>
<li>Each of these lines represents a residual (<span class="math inline">e_i</span>)</li>
<li>We square each residual (creating a squared area)</li>
<li>The sum of all these squared areas is what we’re trying to minimize</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggrepel)  <span class="co"># For better label placement</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(model)</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(model)</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate residuals</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> preds</span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>residuals <span class="ot">&lt;-</span> y <span class="sc">-</span> preds</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Select only a few points to label (to reduce clutter)</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>points_to_label <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">15</span>)</span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add light gray grid for better reference</span></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray85"</span>)</span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add regression line</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> coef[<span class="dv">1</span>], <span class="at">slope =</span> coef[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add residual lines with higher visibility</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">yend =</span> predicted), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.9</span>) <span class="sc">+</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add squared error visualization - clearer squares</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> x <span class="sc">-</span> <span class="fu">abs</span>(residuals)<span class="sc">/</span><span class="dv">2</span>, <span class="at">xmax =</span> x <span class="sc">+</span> <span class="fu">abs</span>(residuals)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>                <span class="at">ymin =</span> predicted, <span class="at">ymax =</span> predicted <span class="sc">+</span> <span class="fu">sign</span>(residuals) <span class="sc">*</span> <span class="fu">abs</span>(residuals)),</span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">fill =</span> <span class="st">"tomato"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add data points on top</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">"black"</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">color =</span> <span class="st">"white"</span>) <span class="sc">+</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add labels for selected residuals with better visibility</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data[points_to_label, ], </span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"ε ="</span>, <span class="fu">round</span>(residuals, <span class="dv">1</span>))),</span>
<span id="cb16-45"><a href="#cb16-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">4.5</span>,</span>
<span id="cb16-46"><a href="#cb16-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.color =</span> <span class="st">"white"</span>,</span>
<span id="cb16-47"><a href="#cb16-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.r =</span> <span class="fl">0.15</span>,</span>
<span id="cb16-48"><a href="#cb16-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-49"><a href="#cb16-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">point.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-50"><a href="#cb16-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">10</span>,</span>
<span id="cb16-51"><a href="#cb16-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkred"</span>,</span>
<span id="cb16-52"><a href="#cb16-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">min.segment.length =</span> <span class="dv">0</span></span>
<span id="cb16-53"><a href="#cb16-53" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-54"><a href="#cb16-54" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add annotation for squared errors with better visibility</span></span>
<span id="cb16-55"><a href="#cb16-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text_repel</span>(</span>
<span id="cb16-56"><a href="#cb16-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> data[points_to_label, ], </span>
<span id="cb16-57"><a href="#cb16-57" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> predicted <span class="sc">+</span> <span class="fu">sign</span>(residuals) <span class="sc">*</span> <span class="fu">abs</span>(residuals)<span class="sc">/</span><span class="dv">2</span>, </span>
<span id="cb16-58"><a href="#cb16-58" aria-hidden="true" tabindex="-1"></a>        <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"ε² ="</span>, <span class="fu">round</span>(residuals<span class="sc">^</span><span class="dv">2</span>, <span class="dv">1</span>))),</span>
<span id="cb16-59"><a href="#cb16-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="fl">4.5</span>,</span>
<span id="cb16-60"><a href="#cb16-60" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.color =</span> <span class="st">"white"</span>,</span>
<span id="cb16-61"><a href="#cb16-61" aria-hidden="true" tabindex="-1"></a>    <span class="at">bg.r =</span> <span class="fl">0.15</span>,</span>
<span id="cb16-62"><a href="#cb16-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"darkred"</span>,</span>
<span id="cb16-63"><a href="#cb16-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">box.padding =</span> <span class="fl">0.5</span>,</span>
<span id="cb16-64"><a href="#cb16-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">force =</span> <span class="dv">5</span></span>
<span id="cb16-65"><a href="#cb16-65" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb16-66"><a href="#cb16-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add prominent SSE annotation with box</span></span>
<span id="cb16-67"><a href="#cb16-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"rect"</span>, <span class="at">xmin =</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="dv">7</span>, <span class="at">xmax =</span> <span class="fu">max</span>(x), </span>
<span id="cb16-68"><a href="#cb16-68" aria-hidden="true" tabindex="-1"></a>           <span class="at">ymin =</span> <span class="fu">min</span>(y) <span class="sc">+</span> <span class="dv">3</span>, <span class="at">ymax =</span> <span class="fu">min</span>(y) <span class="sc">+</span> <span class="dv">7</span>,</span>
<span id="cb16-69"><a href="#cb16-69" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> <span class="st">"lightyellow"</span>, <span class="at">color =</span> <span class="st">"gray50"</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb16-70"><a href="#cb16-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fu">max</span>(x) <span class="sc">-</span> <span class="fl">3.5</span>, <span class="at">y =</span> <span class="fu">min</span>(y) <span class="sc">+</span> <span class="dv">5</span>, </span>
<span id="cb16-71"><a href="#cb16-71" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"SSE ="</span>, <span class="fu">round</span>(<span class="fu">sum</span>(data<span class="sc">$</span>residuals<span class="sc">^</span><span class="dv">2</span>), <span class="dv">1</span>)),</span>
<span id="cb16-72"><a href="#cb16-72" aria-hidden="true" tabindex="-1"></a>           <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"darkred"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb16-73"><a href="#cb16-73" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Improved titles</span></span>
<span id="cb16-74"><a href="#cb16-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Visualizing the Sum of Squared Errors"</span>,</span>
<span id="cb16-75"><a href="#cb16-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Red squares represent squared errors (area = ε²)"</span>,</span>
<span id="cb16-76"><a href="#cb16-76" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>) <span class="sc">+</span></span>
<span id="cb16-77"><a href="#cb16-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb16-78"><a href="#cb16-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">16</span>),</span>
<span id="cb16-79"><a href="#cb16-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb16-80"><a href="#cb16-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb16-81"><a href="#cb16-81" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>)</span>
<span id="cb16-82"><a href="#cb16-82" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/visualize-sse-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>Visualization of Sum of Squared Errors</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="visualizing-ols-through-different-lines" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-ols-through-different-lines">Visualizing OLS Through Different Lines</h3>
<p>A simple but effective way to visualize the concept of “best fit” is to compare multiple lines and their resulting SSE values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'gridExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    combine</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(model)</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Define different lines: optimal and sub-optimal with clearer differences</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">c</span>(<span class="st">"Best Fit (OLS)"</span>, <span class="st">"Line A"</span>, <span class="st">"Line B"</span>, <span class="st">"Line C"</span>),</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> <span class="fu">c</span>(coef[<span class="dv">1</span>], coef[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">8</span>, coef[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">8</span>, coef[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">4</span>),</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">slope =</span> <span class="fu">c</span>(coef[<span class="dv">2</span>], coef[<span class="dv">2</span>] <span class="sc">-</span> <span class="fl">1.2</span>, coef[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">0.8</span>, coef[<span class="dv">2</span>] <span class="sc">-</span> <span class="fl">0.7</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate SSE for each line</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>lines<span class="sc">$</span>sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lines), <span class="cf">function</span>(i) {</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> lines<span class="sc">$</span>intercept[i] <span class="sc">+</span> lines<span class="sc">$</span>slope[i] <span class="sc">*</span> x</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y <span class="sc">-</span> predicted)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Add percentage increase over optimal SSE</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>lines<span class="sc">$</span>pct_increase <span class="ot">&lt;-</span> <span class="fu">round</span>((lines<span class="sc">$</span>sse <span class="sc">/</span> lines<span class="sc">$</span>sse[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">*</span> <span class="dv">100</span>, <span class="dv">1</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>lines<span class="sc">$</span>pct_text <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(lines<span class="sc">$</span>label <span class="sc">==</span> <span class="st">"Best Fit (OLS)"</span>, </span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>                         <span class="st">"Optimal"</span>, </span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>                         <span class="fu">paste0</span>(<span class="st">"+"</span>, lines<span class="sc">$</span>pct_increase, <span class="st">"%"</span>))</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign distinct colors for better visibility</span></span>
<span id="cb21-31"><a href="#cb21-31" aria-hidden="true" tabindex="-1"></a>line_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Best Fit (OLS)"</span> <span class="ot">=</span> <span class="st">"blue"</span>, </span>
<span id="cb21-32"><a href="#cb21-32" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Line A"</span> <span class="ot">=</span> <span class="st">"red"</span>, </span>
<span id="cb21-33"><a href="#cb21-33" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Line B"</span> <span class="ot">=</span> <span class="st">"darkgreen"</span>, </span>
<span id="cb21-34"><a href="#cb21-34" aria-hidden="true" tabindex="-1"></a>                <span class="st">"Line C"</span> <span class="ot">=</span> <span class="st">"purple"</span>)</span>
<span id="cb21-35"><a href="#cb21-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-36"><a href="#cb21-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data for mini residual plots</span></span>
<span id="cb21-37"><a href="#cb21-37" aria-hidden="true" tabindex="-1"></a>mini_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>()</span>
<span id="cb21-38"><a href="#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lines)) {</span>
<span id="cb21-39"><a href="#cb21-39" aria-hidden="true" tabindex="-1"></a>  line_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-40"><a href="#cb21-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> x,</span>
<span id="cb21-41"><a href="#cb21-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> y,</span>
<span id="cb21-42"><a href="#cb21-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">predicted =</span> lines<span class="sc">$</span>intercept[i] <span class="sc">+</span> lines<span class="sc">$</span>slope[i] <span class="sc">*</span> x,</span>
<span id="cb21-43"><a href="#cb21-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">residuals =</span> y <span class="sc">-</span> (lines<span class="sc">$</span>intercept[i] <span class="sc">+</span> lines<span class="sc">$</span>slope[i] <span class="sc">*</span> x),</span>
<span id="cb21-44"><a href="#cb21-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">line =</span> lines<span class="sc">$</span>label[i]</span>
<span id="cb21-45"><a href="#cb21-45" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb21-46"><a href="#cb21-46" aria-hidden="true" tabindex="-1"></a>  mini_data <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mini_data, line_data)</span>
<span id="cb21-47"><a href="#cb21-47" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-48"><a href="#cb21-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-49"><a href="#cb21-49" aria-hidden="true" tabindex="-1"></a><span class="co"># Create main comparison plot with improved visibility</span></span>
<span id="cb21-50"><a href="#cb21-50" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb21-51"><a href="#cb21-51" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add background grid for reference</span></span>
<span id="cb21-52"><a href="#cb21-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-53"><a href="#cb21-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb21-54"><a href="#cb21-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray90"</span>),</span>
<span id="cb21-55"><a href="#cb21-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">"gray85"</span>),</span>
<span id="cb21-56"><a href="#cb21-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb21-57"><a href="#cb21-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>),</span>
<span id="cb21-58"><a href="#cb21-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">13</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb21-59"><a href="#cb21-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb21-60"><a href="#cb21-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb21-61"><a href="#cb21-61" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add data points</span></span>
<span id="cb21-62"><a href="#cb21-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb21-63"><a href="#cb21-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add lines with improved visibility</span></span>
<span id="cb21-64"><a href="#cb21-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> lines, </span>
<span id="cb21-65"><a href="#cb21-65" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> slope, </span>
<span id="cb21-66"><a href="#cb21-66" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> label, <span class="at">linetype =</span> label <span class="sc">==</span> <span class="st">"Best Fit (OLS)"</span>),</span>
<span id="cb21-67"><a href="#cb21-67" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb21-68"><a href="#cb21-68" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Use custom colors</span></span>
<span id="cb21-69"><a href="#cb21-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> line_colors) <span class="sc">+</span></span>
<span id="cb21-70"><a href="#cb21-70" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"TRUE"</span> <span class="ot">=</span> <span class="st">"solid"</span>, <span class="st">"FALSE"</span> <span class="ot">=</span> <span class="st">"dashed"</span>), <span class="at">guide =</span> <span class="st">"none"</span>) <span class="sc">+</span></span>
<span id="cb21-71"><a href="#cb21-71" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Better legends</span></span>
<span id="cb21-72"><a href="#cb21-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Comparing Different Regression Lines"</span>,</span>
<span id="cb21-73"><a href="#cb21-73" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The OLS line minimizes the sum of squared errors"</span>,</span>
<span id="cb21-74"><a href="#cb21-74" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>,</span>
<span id="cb21-75"><a href="#cb21-75" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Regression Line"</span>) <span class="sc">+</span></span>
<span id="cb21-76"><a href="#cb21-76" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">2</span>)))</span>
<span id="cb21-77"><a href="#cb21-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-78"><a href="#cb21-78" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mini residual plots with improved visibility</span></span>
<span id="cb21-79"><a href="#cb21-79" aria-hidden="true" tabindex="-1"></a>p_mini <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb21-80"><a href="#cb21-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-81"><a href="#cb21-81" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lines)) {</span>
<span id="cb21-82"><a href="#cb21-82" aria-hidden="true" tabindex="-1"></a>  line_data <span class="ot">&lt;-</span> <span class="fu">subset</span>(mini_data, line <span class="sc">==</span> lines<span class="sc">$</span>label[i])</span>
<span id="cb21-83"><a href="#cb21-83" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb21-84"><a href="#cb21-84" aria-hidden="true" tabindex="-1"></a>  p_mini[[i]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(line_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> residuals)) <span class="sc">+</span></span>
<span id="cb21-85"><a href="#cb21-85" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add reference line</span></span>
<span id="cb21-86"><a href="#cb21-86" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="fl">0.8</span>, <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb21-87"><a href="#cb21-87" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add residual points with line color</span></span>
<span id="cb21-88"><a href="#cb21-88" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> line_colors[lines<span class="sc">$</span>label[i]], <span class="at">size =</span> <span class="fl">2.5</span>) <span class="sc">+</span></span>
<span id="cb21-89"><a href="#cb21-89" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Add squares to represent squared errors</span></span>
<span id="cb21-90"><a href="#cb21-90" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> x <span class="sc">-</span> <span class="fl">0.3</span>, <span class="at">xmax =</span> x <span class="sc">+</span> <span class="fl">0.3</span>,</span>
<span id="cb21-91"><a href="#cb21-91" aria-hidden="true" tabindex="-1"></a>                  <span class="at">ymin =</span> <span class="dv">0</span>, <span class="at">ymax =</span> residuals),</span>
<span id="cb21-92"><a href="#cb21-92" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> line_colors[lines<span class="sc">$</span>label[i]], <span class="at">alpha =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb21-93"><a href="#cb21-93" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Improved titles</span></span>
<span id="cb21-94"><a href="#cb21-94" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> lines<span class="sc">$</span>label[i],</span>
<span id="cb21-95"><a href="#cb21-95" aria-hidden="true" tabindex="-1"></a>         <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"SSE ="</span>, <span class="fu">round</span>(lines<span class="sc">$</span>sse[i], <span class="dv">1</span>), </span>
<span id="cb21-96"><a href="#cb21-96" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">ifelse</span>(i <span class="sc">==</span> <span class="dv">1</span>, <span class="st">" (Optimal)"</span>, </span>
<span id="cb21-97"><a href="#cb21-97" aria-hidden="true" tabindex="-1"></a>                                 <span class="fu">paste0</span>(<span class="st">" (+"</span>, lines<span class="sc">$</span>pct_increase[i], <span class="st">"%)"</span>))),</span>
<span id="cb21-98"><a href="#cb21-98" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb21-99"><a href="#cb21-99" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-100"><a href="#cb21-100" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb21-101"><a href="#cb21-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">color =</span> line_colors[lines<span class="sc">$</span>label[i]]),</span>
<span id="cb21-102"><a href="#cb21-102" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb21-103"><a href="#cb21-103" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb21-104"><a href="#cb21-104" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb21-105"><a href="#cb21-105" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb21-106"><a href="#cb21-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-107"><a href="#cb21-107" aria-hidden="true" tabindex="-1"></a><span class="co"># Create SSE comparison table with better visibility</span></span>
<span id="cb21-108"><a href="#cb21-108" aria-hidden="true" tabindex="-1"></a>sse_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-109"><a href="#cb21-109" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(lines)),</span>
<span id="cb21-110"><a href="#cb21-110" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">nrow</span>(lines)<span class="sc">:</span><span class="dv">1</span>,</span>
<span id="cb21-111"><a href="#cb21-111" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="fu">paste0</span>(lines<span class="sc">$</span>label, <span class="st">": SSE = "</span>, <span class="fu">round</span>(lines<span class="sc">$</span>sse, <span class="dv">1</span>), <span class="st">" ("</span>, lines<span class="sc">$</span>pct_text, <span class="st">")"</span>),</span>
<span id="cb21-112"><a href="#cb21-112" aria-hidden="true" tabindex="-1"></a>  <span class="at">color =</span> line_colors[lines<span class="sc">$</span>label]</span>
<span id="cb21-113"><a href="#cb21-113" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-114"><a href="#cb21-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-115"><a href="#cb21-115" aria-hidden="true" tabindex="-1"></a>sse_table <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(sse_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">label =</span> label, <span class="at">color =</span> color)) <span class="sc">+</span></span>
<span id="cb21-116"><a href="#cb21-116" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">5</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb21-117"><a href="#cb21-117" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_identity</span>() <span class="sc">+</span></span>
<span id="cb21-118"><a href="#cb21-118" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb21-119"><a href="#cb21-119" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="dv">1</span>, <span class="dv">10</span>) <span class="sc">+</span></span>
<span id="cb21-120"><a href="#cb21-120" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylim</span>(<span class="fl">0.5</span>, <span class="fu">nrow</span>(lines) <span class="sc">+</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-121"><a href="#cb21-121" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sum of Squared Errors (SSE) Comparison"</span>) <span class="sc">+</span></span>
<span id="cb21-122"><a href="#cb21-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">size =</span> <span class="dv">14</span>))</span>
<span id="cb21-123"><a href="#cb21-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-124"><a href="#cb21-124" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange the plots with better spacing</span></span>
<span id="cb21-125"><a href="#cb21-125" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(</span>
<span id="cb21-126"><a href="#cb21-126" aria-hidden="true" tabindex="-1"></a>  p1, </span>
<span id="cb21-127"><a href="#cb21-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrangeGrob</span>(p_mini[[<span class="dv">1</span>]], p_mini[[<span class="dv">2</span>]], p_mini[[<span class="dv">3</span>]], p_mini[[<span class="dv">4</span>]], </span>
<span id="cb21-128"><a href="#cb21-128" aria-hidden="true" tabindex="-1"></a>              <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">padding =</span> <span class="fu">unit</span>(<span class="dv">1</span>, <span class="st">"cm"</span>)),</span>
<span id="cb21-129"><a href="#cb21-129" aria-hidden="true" tabindex="-1"></a>  sse_table, </span>
<span id="cb21-130"><a href="#cb21-130" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">1</span>, </span>
<span id="cb21-131"><a href="#cb21-131" aria-hidden="true" tabindex="-1"></a>  <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">3</span>, <span class="dv">1</span>)</span>
<span id="cb21-132"><a href="#cb21-132" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/compare-lines-1.png" class="img-fluid figure-img" width="960"></p>
<figcaption>Comparing different regression lines</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="key-learning-points" class="level3">
<h3 class="anchored" data-anchor-id="key-learning-points">Key Learning Points</h3>
<ul>
<li>The Sum of Squared Errors (SSE) is what Ordinary Least Squares (OLS) regression minimizes</li>
<li>Each residual contributes its squared value to the total SSE</li>
<li>The OLS line has a lower SSE than any other possible line</li>
<li>Large residuals contribute disproportionately to the SSE due to the squaring operation</li>
<li>This is why outliers can have such a strong influence on regression lines</li>
</ul>
<section id="step-by-step-sse-minimization" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-sse-minimization">Step-by-Step SSE Minimization</h4>
<p>To illustrate the process of finding the minimum SSE, we can create a sequence that passes through the optimal point, showing how the SSE first decreases to a minimum and then increases again:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>coef <span class="ot">&lt;-</span> <span class="fu">coefficients</span>(model)</span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a sequence of steps that passes through the optimal OLS line</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>steps <span class="ot">&lt;-</span> <span class="dv">9</span>  <span class="co"># Use odd number to have a middle point at the optimum</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>step_seq <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">step =</span> <span class="dv">1</span><span class="sc">:</span>steps,</span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> <span class="fu">seq</span>(coef[<span class="dv">1</span>] <span class="sc">-</span> <span class="dv">8</span>, coef[<span class="dv">1</span>] <span class="sc">+</span> <span class="dv">8</span>, <span class="at">length.out =</span> steps),</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">slope =</span> <span class="fu">seq</span>(coef[<span class="dv">2</span>] <span class="sc">-</span> <span class="fl">1.5</span>, coef[<span class="dv">2</span>] <span class="sc">+</span> <span class="fl">1.5</span>, <span class="at">length.out =</span> steps)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Mark the middle step (optimal OLS solution)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>optimal_step <span class="ot">&lt;-</span> <span class="fu">ceiling</span>(steps<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate SSE for each step</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>step_seq<span class="sc">$</span>sse <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(step_seq), <span class="cf">function</span>(i) {</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>  predicted <span class="ot">&lt;-</span> step_seq<span class="sc">$</span>intercept[i] <span class="sc">+</span> step_seq<span class="sc">$</span>slope[i] <span class="sc">*</span> x</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">sum</span>((y <span class="sc">-</span> predicted)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a "journey through the SSE valley" plot</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> step_seq, </span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> slope, </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> sse, <span class="at">group =</span> step),</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Highlight the optimal line</span></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> step_seq<span class="sc">$</span>intercept[optimal_step], </span>
<span id="cb22-37"><a href="#cb22-37" aria-hidden="true" tabindex="-1"></a>              <span class="at">slope =</span> step_seq<span class="sc">$</span>slope[optimal_step],</span>
<span id="cb22-38"><a href="#cb22-38" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb22-39"><a href="#cb22-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-40"><a href="#cb22-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Journey Through the SSE Valley"</span>,</span>
<span id="cb22-41"><a href="#cb22-41" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The green line represents the OLS solution with minimum SSE"</span>,</span>
<span id="cb22-42"><a href="#cb22-42" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"SSE Value"</span>) <span class="sc">+</span></span>
<span id="cb22-43"><a href="#cb22-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb22-44"><a href="#cb22-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-45"><a href="#cb22-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Create an SSE valley plot</span></span>
<span id="cb22-46"><a href="#cb22-46" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(step_seq, <span class="fu">aes</span>(<span class="at">x =</span> step, <span class="at">y =</span> sse)) <span class="sc">+</span></span>
<span id="cb22-47"><a href="#cb22-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb22-48"><a href="#cb22-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="fu">aes</span>(<span class="at">color =</span> sse)) <span class="sc">+</span></span>
<span id="cb22-49"><a href="#cb22-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_gradient</span>(<span class="at">low =</span> <span class="st">"blue"</span>, <span class="at">high =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb22-50"><a href="#cb22-50" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Highlight the optimal point</span></span>
<span id="cb22-51"><a href="#cb22-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> step_seq[optimal_step, ], <span class="fu">aes</span>(<span class="at">x =</span> step, <span class="at">y =</span> sse), </span>
<span id="cb22-52"><a href="#cb22-52" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">5</span>, <span class="at">color =</span> <span class="st">"green"</span>) <span class="sc">+</span></span>
<span id="cb22-53"><a href="#cb22-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add annotation</span></span>
<span id="cb22-54"><a href="#cb22-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> optimal_step, <span class="at">y =</span> step_seq<span class="sc">$</span>sse[optimal_step] <span class="sc">*</span> <span class="fl">1.1</span>, </span>
<span id="cb22-55"><a href="#cb22-55" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Minimum SSE"</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb22-56"><a href="#cb22-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"The SSE Valley: Decreasing Then Increasing"</span>,</span>
<span id="cb22-57"><a href="#cb22-57" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"The SSE reaches its minimum at the OLS solution"</span>,</span>
<span id="cb22-58"><a href="#cb22-58" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Step"</span>,</span>
<span id="cb22-59"><a href="#cb22-59" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Sum of Squared Errors"</span>) <span class="sc">+</span></span>
<span id="cb22-60"><a href="#cb22-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-61"><a href="#cb22-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"none"</span>)</span>
<span id="cb22-62"><a href="#cb22-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-63"><a href="#cb22-63" aria-hidden="true" tabindex="-1"></a><span class="co"># Display both plots</span></span>
<span id="cb22-64"><a href="#cb22-64" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p2, p3, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/sse-valley-1.png" class="img-fluid figure-img" width="768"></p>
<figcaption>SSE minimization visualization</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-ols-estimator" class="level3">
<h3 class="anchored" data-anchor-id="the-ols-estimator">The OLS Estimator</h3>
<p>The OLS estimator for the coefficients minimizes:</p>
<p><span class="math display">
\sum_{i=1}^{n} (Y_i - \hat{Y}_i)^2
</span></p>
<p>Where <span class="math inline">\hat{Y}_i</span> is the predicted value for observation <span class="math inline">i</span>.</p>
<p>For OLS to produce unbiased estimates, several assumptions must hold:</p>
<ol type="1">
<li><p><strong>Linearity</strong>: The relationship between X and Y is linear</p></li>
<li><p><strong>Independence</strong>: Observations are independent of each other</p></li>
<li><p><strong>Homoscedasticity</strong>: Error variance is constant across all levels of X</p></li>
<li><p><strong>Normality</strong>: Errors are normally distributed</p></li>
<li><p><strong>No multicollinearity</strong>: Predictors are not perfectly correlated</p></li>
<li><p><strong>Exogeneity</strong>: The error term is uncorrelated with the predictors</p></li>
</ol>
<p>The last assumption is particularly important for our discussion of spurious correlations. Violations of the exogeneity assumption lead to endogeneity problems, which we will discuss later.</p>
<p>In R, the <code>lm()</code> function fits linear regression models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_frame)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="model-interpretation-a-beginners-guide" class="level3">
<h3 class="anchored" data-anchor-id="model-interpretation-a-beginners-guide">Model Interpretation: A Beginner’s Guide</h3>
<p>Let’s create a simple dataset to understand regression output better. Imagine we’re studying how years of education affect annual income:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a simple dataset - this is our Data Generating Process (DGP)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>) <span class="co"># For reproducibility</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>education_years <span class="ot">&lt;-</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>  <span class="co"># Education from 10 to 20 years</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">length</span>(education_years)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="co"># True parameters in our model - using more realistic values for Poland</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>true_intercept <span class="ot">&lt;-</span> <span class="dv">3000</span>   <span class="co"># Base monthly income with no education (in PLN)</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>true_slope <span class="ot">&lt;-</span> <span class="dv">250</span>        <span class="co"># Each year of education increases monthly income by 250 PLN</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate monthly incomes with some random noise</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> true_intercept <span class="sc">+</span> true_slope <span class="sc">*</span> education_years <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">mean=</span><span class="dv">0</span>, <span class="at">sd=</span><span class="dv">300</span>)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create our dataset</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>education_income <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> education_years,</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> income</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Let's visualize our data</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(education_income, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> income)) <span class="sc">+</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">8500</span>), </span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">5000</span>, <span class="dv">8500</span>, <span class="at">by =</span> <span class="dv">500</span>),</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relationship between Education and Income in Poland"</span>,</span>
<span id="cb24-30"><a href="#cb24-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Years of Education"</span>,</span>
<span id="cb24-31"><a href="#cb24-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Monthly Income (PLN)"</span>,</span>
<span id="cb24-32"><a href="#cb24-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red line shows the estimated linear relationship"</span></span>
<span id="cb24-33"><a href="#cb24-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-34"><a href="#cb24-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb24-35"><a href="#cb24-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb24-36"><a href="#cb24-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb24-37"><a href="#cb24-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb24-38"><a href="#cb24-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb24-39"><a href="#cb24-39" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-40"><a href="#cb24-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">11</span>, <span class="at">y =</span> <span class="dv">8000</span>, </span>
<span id="cb24-41"><a href="#cb24-41" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Each point represents</span><span class="sc">\n</span><span class="st">one person's data"</span>, </span>
<span id="cb24-42"><a href="#cb24-42" aria-hidden="true" tabindex="-1"></a>           <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/create-example-data-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="fitting-the-model" class="level4">
<h4 class="anchored" data-anchor-id="fitting-the-model">Fitting the Model</h4>
<p>Now let’s fit a linear regression model to this data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit a simple regression model</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>edu_income_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> education, <span class="at">data =</span> education_income)</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the results</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>model_summary <span class="ot">&lt;-</span> <span class="fu">summary</span>(edu_income_model)</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>model_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ education, data = education_income)

Residuals:
    Min      1Q  Median      3Q     Max 
-427.72 -206.04  -38.12  207.32  460.78 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   3095.3      447.6   6.915 6.95e-05 ***
education      247.2       29.2   8.467 1.40e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 306.3 on 9 degrees of freedom
Multiple R-squared:  0.8885,    Adjusted R-squared:  0.8761 
F-statistic: 71.69 on 1 and 9 DF,  p-value: 1.403e-05</code></pre>
</div>
</div>
</section>
<section id="understanding-the-regression-output-step-by-step" class="level4">
<h4 class="anchored" data-anchor-id="understanding-the-regression-output-step-by-step">Understanding the Regression Output Step by Step</h4>
<p>Let’s break down what each part of this output means in simple terms:</p>
<section id="the-formula" class="level5">
<h5 class="anchored" data-anchor-id="the-formula">1. The Formula</h5>
<p>At the top, you see <code>income ~ education</code>, which means we’re predicting income based on education.</p>
</section>
<section id="residuals" class="level5">
<h5 class="anchored" data-anchor-id="residuals">2. Residuals</h5>
<p>These show how far our predictions are from the actual values. Ideally, they should be centered around zero.</p>
</section>
<section id="coefficients-table" class="level5">
<h5 class="anchored" data-anchor-id="coefficients-table">3. Coefficients Table</h5>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Coefficient Estimates</caption>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: right;">Estimate</th>
<th style="text-align: right;">Std. Error</th>
<th style="text-align: right;">t value</th>
<th style="text-align: right;">Pr(&gt;|t|)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">3095.27</td>
<td style="text-align: right;">447.63</td>
<td style="text-align: right;">6.91</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: left;">education</td>
<td style="text-align: right;">247.23</td>
<td style="text-align: right;">29.20</td>
<td style="text-align: right;">8.47</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>Intercept</strong> (<span class="math inline">\beta_0</span>):</p>
<ul>
<li><p>Value: Approximately 3095</p></li>
<li><p>Interpretation: This is the predicted monthly income for someone with 0 years of education</p></li>
<li><p>Note: Sometimes the intercept isn’t meaningful in real-world terms, especially if x=0 is outside your data range</p></li>
</ul>
<p><strong>Education</strong> (<span class="math inline">\beta_1</span>):</p>
<ul>
<li><p>Value: Approximately 247</p></li>
<li><p>Interpretation: For each additional year of education, we expect monthly income to increase by this amount in PLN</p></li>
<li><p>This is our main coefficient of interest!</p></li>
</ul>
<p><strong>Standard Error</strong>:</p>
<ul>
<li><p>Measures how precise our estimates are</p></li>
<li><p>Smaller standard errors mean more precise estimates</p></li>
<li><p>Think of it as “give or take how much” for our coefficients</p></li>
</ul>
<p><strong>t value</strong>:</p>
<ul>
<li><p>This is the coefficient divided by its standard error</p></li>
<li><p>It tells us how many standard errors away from zero our coefficient is</p></li>
<li><p>Larger absolute t values (above 2) suggest the effect is statistically significant</p></li>
</ul>
<p><strong>p-value</strong>:</p>
<ul>
<li><p>The probability of seeing our result (or something more extreme) if there was actually no relationship</p></li>
<li><p>Typically, p &lt; 0.05 is considered statistically significant</p></li>
<li><p>For education, p = 1.4e-05, which is significant!</p></li>
</ul>
</section>
<section id="model-fit-statistics" class="level5">
<h5 class="anchored" data-anchor-id="model-fit-statistics">4. Model Fit Statistics</h5>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Fit Statistics</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Statistic</th>
<th style="text-align: right;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">R-squared</td>
<td style="text-align: right;">0.888</td>
</tr>
<tr class="even">
<td style="text-align: left;">Adjusted R-squared</td>
<td style="text-align: right;">0.876</td>
</tr>
<tr class="odd">
<td style="text-align: left;">F-statistic</td>
<td style="text-align: right;">71.686</td>
</tr>
<tr class="even">
<td style="text-align: left;">p-value</td>
<td style="text-align: right;">0.000</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><strong>R-squared</strong>:</p>
<ul>
<li><p>Value: 0.888</p></li>
<li><p>Interpretation: 89% of the variation in income is explained by education</p></li>
<li><p>Higher is better, but be cautious of very high values (could indicate overfitting)</p></li>
</ul>
<p><strong>F-statistic</strong>:</p>
<ul>
<li><p>Tests whether the model as a whole is statistically significant</p></li>
<li><p>A high F-statistic with a low p-value indicates a significant model</p></li>
</ul>
</section>
</section>
<section id="visualizing-the-model-results" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-the-model-results">Visualizing the Model Results</h4>
<p>Let’s visualize what our model actually tells us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>education_income<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(edu_income_model)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>education_income<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(edu_income_model)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a more informative plot</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(education_income, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> income)) <span class="sc">+</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Actual data points</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Regression line</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> predicted), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Residual lines</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> education, <span class="at">yend =</span> predicted), </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"darkgray"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set proper scales</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">8500</span>), </span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">5000</span>, <span class="dv">8500</span>, <span class="at">by =</span> <span class="dv">500</span>),</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">10</span><span class="sc">:</span><span class="dv">20</span>) <span class="sc">+</span></span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Annotations</span></span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">19</span>, <span class="at">y =</span> <span class="dv">7850</span>, </span>
<span id="cb28-25"><a href="#cb28-25" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Slope ="</span>, <span class="fu">round</span>(<span class="fu">coef</span>(edu_income_model)[<span class="dv">2</span>]), <span class="st">"PLN per year"</span>),</span>
<span id="cb28-26"><a href="#cb28-26" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">hjust =</span> <span class="dv">1</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb28-27"><a href="#cb28-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-28"><a href="#cb28-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">10.5</span>, <span class="at">y =</span> <span class="dv">5500</span>, </span>
<span id="cb28-29"><a href="#cb28-29" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Intercept ="</span>, <span class="fu">round</span>(<span class="fu">coef</span>(edu_income_model)[<span class="dv">1</span>]), <span class="st">"PLN"</span>),</span>
<span id="cb28-30"><a href="#cb28-30" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb28-31"><a href="#cb28-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-32"><a href="#cb28-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">14</span>, <span class="at">y =</span> <span class="dv">8200</span>, </span>
<span id="cb28-33"><a href="#cb28-33" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"R² ="</span>, <span class="fu">round</span>(model_summary<span class="sc">$</span>r.squared, <span class="dv">2</span>)),</span>
<span id="cb28-34"><a href="#cb28-34" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">fontface =</span> <span class="st">"bold"</span>) <span class="sc">+</span></span>
<span id="cb28-35"><a href="#cb28-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-36"><a href="#cb28-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Labels</span></span>
<span id="cb28-37"><a href="#cb28-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb28-38"><a href="#cb28-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Interpreting the Education-Income Regression Model"</span>,</span>
<span id="cb28-39"><a href="#cb28-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red line shows predicted income for each education level"</span>,</span>
<span id="cb28-40"><a href="#cb28-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Years of Education"</span>,</span>
<span id="cb28-41"><a href="#cb28-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Monthly Income (PLN)"</span>,</span>
<span id="cb28-42"><a href="#cb28-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Gray dashed lines represent residuals (prediction errors)"</span></span>
<span id="cb28-43"><a href="#cb28-43" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb28-44"><a href="#cb28-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">12</span>) <span class="sc">+</span></span>
<span id="cb28-45"><a href="#cb28-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb28-46"><a href="#cb28-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb28-47"><a href="#cb28-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb28-48"><a href="#cb28-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb28-49"><a href="#cb28-49" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/visualize-model-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="real-world-interpretation" class="level4">
<h4 class="anchored" data-anchor-id="real-world-interpretation">Real-World Interpretation</h4>
<ul>
<li><p>A person with 16 years of education (college graduate) would be predicted to earn about: <span class="math inline">\hat{Y} = 3095 + 247 \times 16 = 7051 \text{ PLN monthly}</span></p></li>
<li><p>The model suggests that each additional year of education is associated with a 247 PLN increase in monthly income.</p></li>
<li><p>Our model explains approximately 89% of the variation in income in our sample.</p></li>
<li><p>The relationship is statistically significant (p &lt; 0.001), meaning it’s very unlikely to observe this relationship if education truly had no effect on income.</p></li>
</ul>
</section>
<section id="important-cautions-for-beginners" class="level4">
<h4 class="anchored" data-anchor-id="important-cautions-for-beginners">Important Cautions for Beginners</h4>
<ol type="1">
<li><p><strong>Correlation ≠ Causation</strong>: Our model shows association, not necessarily causation</p></li>
<li><p><strong>Omitted Variables</strong>: Other factors might influence both education and income</p></li>
<li><p><strong>Extrapolation</strong>: Be careful predicting outside the range of your data</p></li>
<li><p><strong>Linear Relationship</strong>: We’ve assumed the relationship is linear, which may not always be true</p></li>
</ol>
</section>
<section id="next-steps-in-your-analysis" class="level4">
<h4 class="anchored" data-anchor-id="next-steps-in-your-analysis">Next Steps in Your Analysis</h4>
<ul>
<li><p>Check model assumptions (linearity, normality of residuals, etc.)</p></li>
<li><p>Consider adding more variables (multiple regression)</p></li>
<li><p>Try transformations if relationships aren’t linear</p></li>
<li><p>Explore interaction effects</p></li>
</ul>
<hr>
</section>
</section>
</section>
<section id="spurious-correlation-causes-and-examples" class="level2" data-number="15.4">
<h2 data-number="15.4" class="anchored" data-anchor-id="spurious-correlation-causes-and-examples"><span class="header-section-number">15.4</span> Spurious Correlation: Causes and Examples</h2>
<p>Spurious correlation occurs when variables appear related but the relationship is not causal. These misleading correlations arise from several sources:</p>
<ul>
<li>Random coincidence (chance)</li>
<li>Confounding variables (hidden third factors)</li>
<li>Selection biases</li>
<li>Improper statistical analysis</li>
<li>Reverse causality</li>
<li>Endogeneity problems (including simultaneity)</li>
</ul>
<section id="random-coincidence-chance" class="level3">
<h3 class="anchored" data-anchor-id="random-coincidence-chance">Random Coincidence (Chance)</h3>
<p>With sufficient data mining or small sample sizes, seemingly meaningful correlations can emerge purely by chance. This is especially problematic when researchers conduct multiple analyses without appropriate corrections for multiple comparisons, a practice known as “p-hacking.”</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a realistic example of spurious correlation based on actual country data</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Using country data on chocolate consumption and Nobel prize winners</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="co"># This example is inspired by a published correlation (Messerli, 2012)</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>countries <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Switzerland"</span>, <span class="st">"Sweden"</span>, <span class="st">"Denmark"</span>, <span class="st">"Belgium"</span>, <span class="st">"Austria"</span>, </span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>               <span class="st">"Norway"</span>, <span class="st">"Germany"</span>, <span class="st">"Netherlands"</span>, <span class="st">"United Kingdom"</span>, <span class="st">"Finland"</span>, </span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>               <span class="st">"France"</span>, <span class="st">"Italy"</span>, <span class="st">"Spain"</span>, <span class="st">"Poland"</span>, <span class="st">"Greece"</span>, <span class="st">"Portugal"</span>)</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create realistic data: Chocolate consumption correlates with GDP per capita</span></span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Higher GDP countries tend to consume more chocolate and have better research funding</span></span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>gdp_per_capita <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">87097</span>, <span class="dv">58977</span>, <span class="dv">67218</span>, <span class="dv">51096</span>, <span class="dv">53879</span>, <span class="dv">89154</span>, <span class="dv">51860</span>, <span class="dv">57534</span>, </span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>                    <span class="dv">46510</span>, <span class="dv">53982</span>, <span class="dv">43659</span>, <span class="dv">35551</span>, <span class="dv">30416</span>, <span class="dv">17841</span>, <span class="dv">20192</span>, <span class="dv">24567</span>)</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalize GDP values to make them more manageable</span></span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a>gdp_normalized <span class="ot">&lt;-</span> (gdp_per_capita <span class="sc">-</span> <span class="fu">min</span>(gdp_per_capita)) <span class="sc">/</span> </span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>                 (<span class="fu">max</span>(gdp_per_capita) <span class="sc">-</span> <span class="fu">min</span>(gdp_per_capita))</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a><span class="co"># More realistic chocolate consumption - loosely based on real consumption patterns</span></span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plus some randomness, but influenced by GDP</span></span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>chocolate_consumption <span class="ot">&lt;-</span> <span class="dv">4</span> <span class="sc">+</span> <span class="dv">8</span> <span class="sc">*</span> gdp_normalized <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">16</span>, <span class="dv">0</span>, <span class="fl">0.8</span>)</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Nobel prizes - also influenced by GDP (research funding) with noise</span></span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a><span class="co"># The relationship is non-linear, but will show up as correlated</span></span>
<span id="cb29-24"><a href="#cb29-24" aria-hidden="true" tabindex="-1"></a>nobel_prizes <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">12</span> <span class="sc">*</span> gdp_normalized<span class="sc">^</span><span class="fl">1.2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">16</span>, <span class="dv">0</span>, <span class="fl">1.5</span>)</span>
<span id="cb29-25"><a href="#cb29-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-26"><a href="#cb29-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create dataframe</span></span>
<span id="cb29-27"><a href="#cb29-27" aria-hidden="true" tabindex="-1"></a>country_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb29-28"><a href="#cb29-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">country =</span> countries,</span>
<span id="cb29-29"><a href="#cb29-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">chocolate =</span> <span class="fu">round</span>(chocolate_consumption, <span class="dv">1</span>),</span>
<span id="cb29-30"><a href="#cb29-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">nobel =</span> <span class="fu">round</span>(nobel_prizes, <span class="dv">1</span>),</span>
<span id="cb29-31"><a href="#cb29-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">gdp =</span> gdp_per_capita</span>
<span id="cb29-32"><a href="#cb29-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb29-33"><a href="#cb29-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-34"><a href="#cb29-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit regression model - chocolate vs nobel without controlling for GDP</span></span>
<span id="cb29-35"><a href="#cb29-35" aria-hidden="true" tabindex="-1"></a>chocolate_nobel_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(nobel <span class="sc">~</span> chocolate, <span class="at">data =</span> country_data)</span>
<span id="cb29-36"><a href="#cb29-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-37"><a href="#cb29-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Better model that reveals the confounding</span></span>
<span id="cb29-38"><a href="#cb29-38" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(nobel <span class="sc">~</span> chocolate <span class="sc">+</span> gdp, <span class="at">data =</span> country_data)</span>
<span id="cb29-39"><a href="#cb29-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-40"><a href="#cb29-40" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the apparent relationship</span></span>
<span id="cb29-41"><a href="#cb29-41" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(country_data, <span class="fu">aes</span>(<span class="at">x =</span> chocolate, <span class="at">y =</span> nobel)) <span class="sc">+</span></span>
<span id="cb29-42"><a href="#cb29-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"darkblue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb29-43"><a href="#cb29-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> country), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>, <span class="at">vjust =</span> <span class="dv">0</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb29-44"><a href="#cb29-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb29-45"><a href="#cb29-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb29-46"><a href="#cb29-46" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Apparent Correlation: Chocolate Consumption vs. Nobel Prizes"</span>,</span>
<span id="cb29-47"><a href="#cb29-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Demonstrates how confounding variables create spurious correlations"</span>,</span>
<span id="cb29-48"><a href="#cb29-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Chocolate Consumption (kg per capita)"</span>,</span>
<span id="cb29-49"><a href="#cb29-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Nobel Prizes per 10M Population"</span></span>
<span id="cb29-50"><a href="#cb29-50" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb29-51"><a href="#cb29-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/random_correlation-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Show regression results</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(chocolate_nobel_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = nobel ~ chocolate, data = country_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.9080 -1.4228  0.0294  0.5962  3.2977 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  -4.0518     1.3633  -2.972   0.0101 *  
chocolate     1.3322     0.1682   7.921 1.54e-06 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.626 on 14 degrees of freedom
Multiple R-squared:  0.8176,    Adjusted R-squared:  0.8045 
F-statistic: 62.75 on 1 and 14 DF,  p-value: 1.536e-06</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Demonstrate multiple testing problem</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>p_values <span class="ot">&lt;-</span> <span class="fu">numeric</span>(<span class="dv">100</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Generate two completely random variables with n=20</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">20</span>)</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  y <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">20</span>)</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Test for correlation and store p-value</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  p_values[i] <span class="ot">&lt;-</span> <span class="fu">cor.test</span>(x, y)<span class="sc">$</span>p.value</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a><span class="co"># How many "significant" results at alpha = 0.05?</span></span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(p_values <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize the multiple testing phenomenon</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(p_values, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">main =</span> <span class="st">"P-values from 100 Tests of Random Data"</span>,</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>     <span class="at">xlab =</span> <span class="st">"P-value"</span>, <span class="at">col =</span> <span class="st">"lightblue"</span>, <span class="at">border =</span> <span class="st">"white"</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fl">0.05</span>, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="fu">text</span>(<span class="fl">0.15</span>, <span class="dv">20</span>, <span class="fu">paste</span>(<span class="st">"Approximately"</span>, <span class="fu">sum</span>(p_values <span class="sc">&lt;</span> <span class="fl">0.05</span>),</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"tests are 'significant'</span><span class="sc">\n</span><span class="st">by random chance alone!"</span>), </span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">col =</span> <span class="st">"darkred"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/random_correlation-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This example demonstrates how seemingly compelling correlations can emerge between unrelated variables due to confounding factors and chance. The correlation between chocolate consumption and Nobel prizes appears significant (p &lt; 0.05) when analyzed directly, even though it’s explained by a third variable - national wealth (GDP per capita).</p>
<p>Wealthier countries typically consume more chocolate and simultaneously invest more in education and research, leading to more Nobel prizes. Without controlling for this confounding factor, we would mistakenly conclude a direct relationship between chocolate and Nobel prizes.</p>
<p>The multiple testing demonstration further illustrates why spurious correlations appear so frequently in research. When conducting 100 statistical tests on completely random data, we expect approximately 5 “significant” results at α = 0.05 purely by chance. In real research settings where hundreds of variables might be analyzed, the probability of finding false positive correlations increases dramatically.</p>
<p>This example underscores three critical points:</p>
<ol type="1">
<li>Small sample sizes (16 countries) are particularly vulnerable to chance correlations</li>
<li>Confounding variables can create strong apparent associations between unrelated factors</li>
<li>Multiple testing without appropriate corrections virtually guarantees finding “significant” but meaningless patterns</li>
</ol>
<p>Such findings explain why replication is essential in research and why most initial “discoveries” fail to hold up in subsequent studies.</p>
</section>
<section id="confounding-variables-hidden-third-factors" class="level3">
<h3 class="anchored" data-anchor-id="confounding-variables-hidden-third-factors">Confounding Variables (Hidden Third Factors)</h3>
<p>Confounding occurs when an external variable influences both the predictor and outcome variables, creating an apparent relationship that may disappear when the confounder is accounted for.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>ability <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">15</span>)                       <span class="co"># Natural ability </span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>education <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> ability <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">2</span>)  <span class="co"># Education affected by ability</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="dv">10000</span> <span class="sc">+</span> <span class="dv">2000</span> <span class="sc">*</span> education <span class="sc">+</span> <span class="dv">100</span> <span class="sc">*</span> ability <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5000</span>)  <span class="co"># Income affected by both</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>omitted_var_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">ability =</span> ability,</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">education =</span> education,</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">income =</span> income</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Model without accounting for ability</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>model_naive <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> education, <span class="at">data =</span> omitted_var_data)</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Model accounting for ability</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> education <span class="sc">+</span> ability, <span class="at">data =</span> omitted_var_data)</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_naive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ education, data = omitted_var_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-14422.9  -3362.1    142.7   3647.7  14229.6 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  18982.0     2410.5   7.875 2.21e-13 ***
education     2050.9      158.7  12.926  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5066 on 198 degrees of freedom
Multiple R-squared:  0.4576,    Adjusted R-squared:  0.4549 
F-statistic: 167.1 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = income ~ education + ability, data = omitted_var_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-12739.9  -3388.7    -41.1   3572.1  14976.8 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 13203.84    3018.85   4.374 1.98e-05 ***
education    1871.43     166.03  11.272  &lt; 2e-16 ***
ability        85.60      27.87   3.071  0.00243 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 4961 on 197 degrees of freedom
Multiple R-squared:  0.4824,    Adjusted R-squared:  0.4772 
F-statistic: 91.81 on 2 and 197 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization with ability shown through color</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(omitted_var_data, <span class="fu">aes</span>(<span class="at">x =</span> education, <span class="at">y =</span> income, <span class="at">color =</span> ability)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"Ability Score"</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Income vs. Education, Colored by Ability"</span>,</span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Visualizing the confounding variable"</span>,</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Years of Education"</span>,</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Annual Income (PLN)"</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/confounding_vis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This example illustrates omitted variable bias: without accounting for ability, the estimated effect of education on income is exaggerated (2,423 PLN per year vs.&nbsp;1,962 PLN per year). The confounding occurs because ability influences both education and income, creating a spurious component in the observed correlation.</p>
<section id="classic-example-ice-cream-and-drownings" class="level4">
<h4 class="anchored" data-anchor-id="classic-example-ice-cream-and-drownings">Classic Example: Ice Cream and Drownings</h4>
<p>A classic example of confounding involves the correlation between ice cream sales and drowning incidents, both influenced by temperature:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>temperature <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">5</span>, <span class="dv">35</span>)  <span class="co"># Temperature in Celsius</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Both ice cream sales and drownings are influenced by temperature</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>ice_cream_sales <span class="ot">&lt;-</span> <span class="dv">100</span> <span class="sc">+</span> <span class="dv">10</span> <span class="sc">*</span> temperature <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">20</span>)</span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>drownings <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.3</span> <span class="sc">*</span> temperature <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>confounding_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">temperature =</span> temperature,</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">ice_cream_sales =</span> ice_cream_sales,</span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">drownings =</span> drownings</span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Model without controlling for temperature</span></span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>model_naive <span class="ot">&lt;-</span> <span class="fu">lm</span>(drownings <span class="sc">~</span> ice_cream_sales, <span class="at">data =</span> confounding_data)</span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Model controlling for temperature</span></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(drownings <span class="sc">~</span> ice_cream_sales <span class="sc">+</span> temperature, <span class="at">data =</span> confounding_data)</span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_naive)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = drownings ~ ice_cream_sales, data = confounding_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-3.8163 -0.7597  0.0118  0.7846  2.5797 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     -1.503063   0.370590  -4.056    1e-04 ***
ice_cream_sales  0.028074   0.001205  23.305   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.088 on 98 degrees of freedom
Multiple R-squared:  0.8471,    Adjusted R-squared:  0.8456 
F-statistic: 543.1 on 1 and 98 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = drownings ~ ice_cream_sales + temperature, data = confounding_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.85074 -0.61169  0.01186  0.60556  2.01776 

Coefficients:
                 Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)      1.243785   0.530123   2.346    0.021 *  
ice_cream_sales -0.002262   0.004839  -0.467    0.641    
temperature      0.317442   0.049515   6.411 5.24e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9169 on 97 degrees of freedom
Multiple R-squared:  0.8926,    Adjusted R-squared:  0.8904 
F-statistic: 403.2 on 2 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(confounding_data, <span class="fu">aes</span>(<span class="at">x =</span> ice_cream_sales, <span class="at">y =</span> drownings, <span class="at">color =</span> temperature)) <span class="sc">+</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.8</span>) <span class="sc">+</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_c</span>(<span class="at">name =</span> <span class="st">"Temperature (°C)"</span>) <span class="sc">+</span></span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"The Ice Cream and Drownings Correlation"</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Temperature as a confounding variable"</span>,</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Ice Cream Sales"</span>,</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Drowning Incidents"</span></span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb46-12"><a href="#cb46-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/ice_cream_drownings-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The naive model shows a statistically significant relationship between ice cream sales and drownings. However, once temperature is included in the model, the coefficient for ice cream sales decreases substantially and becomes statistically insignificant. This demonstrates how failing to account for confounding variables can lead to spurious correlations.</p>
</section>
</section>
<section id="reverse-causality" class="level3">
<h3 class="anchored" data-anchor-id="reverse-causality">Reverse Causality</h3>
<p>Reverse causality occurs when the assumed direction of causation is incorrect. Consider this example of anxiety and relaxation techniques:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">200</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>anxiety_level <span class="ot">&lt;-</span> <span class="fu">runif</span>(n, <span class="dv">1</span>, <span class="dv">10</span>)  <span class="co"># Anxiety level (1-10)</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co"># People with higher anxiety tend to use more relaxation techniques</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>relaxation_techniques <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="fl">0.7</span> <span class="sc">*</span> anxiety_level <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>reverse_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">anxiety =</span> anxiety_level,</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">relaxation =</span> relaxation_techniques</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models in both directions</span></span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>model_incorrect <span class="ot">&lt;-</span> <span class="fu">lm</span>(anxiety <span class="sc">~</span> relaxation, <span class="at">data =</span> reverse_data)</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>model_correct <span class="ot">&lt;-</span> <span class="fu">lm</span>(relaxation <span class="sc">~</span> anxiety, <span class="at">data =</span> reverse_data)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Show regression results</span></span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_incorrect)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = anxiety ~ relaxation, data = reverse_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-2.9651 -0.7285 -0.0923  0.7247  3.7996 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.09482    0.21973  -0.432    0.667    
relaxation   1.15419    0.04105  28.114   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.182 on 198 degrees of freedom
Multiple R-squared:  0.7997,    Adjusted R-squared:  0.7987 
F-statistic: 790.4 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_correct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = relaxation ~ anxiety, data = reverse_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.15178 -0.51571 -0.00222  0.55513  2.04334 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.05726    0.15286   6.917 6.24e-11 ***
anxiety      0.69284    0.02464  28.114  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9161 on 198 degrees of freedom
Multiple R-squared:  0.7997,    Adjusted R-squared:  0.7987 
F-statistic: 790.4 on 1 and 198 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(reverse_data, <span class="fu">aes</span>(<span class="at">x =</span> relaxation, <span class="at">y =</span> anxiety)) <span class="sc">+</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Anxiety and Relaxation Techniques"</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Example of reverse causality"</span>,</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Use of Relaxation Techniques (frequency/week)"</span>,</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Anxiety Level (1-10 scale)"</span></span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/reverse_causality-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Both regression models show statistically significant relationships, but they imply different causal mechanisms. The incorrect model suggests that relaxation techniques increase anxiety, while the correct model reflects the true data generating process: anxiety drives the use of relaxation techniques.</p>
</section>
<section id="collider-bias-selection-bias" class="level3">
<h3 class="anchored" data-anchor-id="collider-bias-selection-bias">Collider Bias (Selection Bias)</h3>
<p>Collider bias occurs when conditioning on a variable that is affected by both the independent and dependent variables of interest, creating an artificial relationship between variables that are actually independent.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate two independent variables (no relationship between them)</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>intelligence <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">100</span>, <span class="dv">15</span>)  <span class="co"># IQ score</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>family_wealth <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">50</span>, <span class="dv">15</span>)  <span class="co"># Wealth score (independent from intelligence)</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a><span class="co"># True data-generating process: admission depends on both intelligence and wealth</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>admission_score <span class="ot">&lt;-</span> <span class="fl">0.4</span> <span class="sc">*</span> intelligence <span class="sc">+</span> <span class="fl">0.4</span> <span class="sc">*</span> family_wealth <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">10</span>)</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a>admitted <span class="ot">&lt;-</span> admission_score <span class="sc">&gt;</span> <span class="fu">median</span>(admission_score)  <span class="co"># Binary admission variable</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Create full dataset</span></span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>full_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">intelligence =</span> intelligence,</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">wealth =</span> family_wealth,</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">admission_score =</span> admission_score,</span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">admitted =</span> admitted</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression in full population (true model)</span></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>full_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(intelligence <span class="sc">~</span> wealth, <span class="at">data =</span> full_data)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(full_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = intelligence ~ wealth, data = full_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-49.608 -10.115   0.119  10.832  55.581 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 101.42330    1.73139   58.58   &lt;2e-16 ***
wealth       -0.02701    0.03334   -0.81    0.418    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 15.41 on 998 degrees of freedom
Multiple R-squared:  0.0006569, Adjusted R-squared:  -0.0003444 
F-statistic: 0.656 on 1 and 998 DF,  p-value: 0.4182</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get just the admitted students</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>admitted_only <span class="ot">&lt;-</span> full_data[full_data<span class="sc">$</span>admitted, ]</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Regression in admitted students (conditioning on the collider)</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>admitted_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(intelligence <span class="sc">~</span> wealth, <span class="at">data =</span> admitted_only)</span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(admitted_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = intelligence ~ wealth, data = admitted_only)

Residuals:
    Min      1Q  Median      3Q     Max 
-38.511  -9.064   0.721   8.965  48.267 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 115.4750     2.6165  44.133  &lt; 2e-16 ***
wealth       -0.1704     0.0462  -3.689  0.00025 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.91 on 498 degrees of freedom
Multiple R-squared:  0.0266,    Adjusted R-squared:  0.02464 
F-statistic: 13.61 on 1 and 498 DF,  p-value: 0.0002501</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Additional analysis - regression with the collider as a control variable</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This demonstrates how controlling for a collider introduces bias</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>collider_control_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(intelligence <span class="sc">~</span> wealth <span class="sc">+</span> admitted, <span class="at">data =</span> full_data)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(collider_control_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = intelligence ~ wealth + admitted, data = full_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-44.729  -8.871   0.700   8.974  48.044 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  102.90069    1.56858  65.601  &lt; 2e-16 ***
wealth        -0.19813    0.03224  -6.145 1.16e-09 ***
admittedTRUE  14.09944    0.94256  14.959  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 13.93 on 997 degrees of freedom
Multiple R-squared:  0.1838,    Adjusted R-squared:  0.1822 
F-statistic: 112.3 on 2 and 997 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for full population</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(full_data, <span class="fu">aes</span>(<span class="at">x =</span> wealth, <span class="at">y =</span> intelligence)) <span class="sc">+</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Full Population"</span>,</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Correlation:"</span>, <span class="fu">round</span>(<span class="fu">cor</span>(full_data<span class="sc">$</span>intelligence, full_data<span class="sc">$</span>wealth), <span class="dv">3</span>)),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Family Wealth Score"</span>,</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Intelligence Score"</span></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot for admitted students</span></span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(admitted_only, <span class="fu">aes</span>(<span class="at">x =</span> wealth, <span class="at">y =</span> intelligence)) <span class="sc">+</span></span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>, <span class="at">color =</span> <span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Admitted Students Only"</span>,</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Correlation:"</span>, <span class="fu">round</span>(<span class="fu">cor</span>(admitted_only<span class="sc">$</span>intelligence, admitted_only<span class="sc">$</span>wealth), <span class="dv">3</span>)),</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Family Wealth Score"</span>,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Intelligence Score"</span></span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Display plots side by side</span></span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/collider_visualization-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This example demonstrates collider bias in three ways:</p>
<ol type="1">
<li>In the full population, intelligence and wealth have no relationship (coefficient near zero, p-value = 0.87)</li>
<li>Among admitted students (conditioning on the collider), a significant negative relationship appears (coefficient = -0.39, p-value &lt; 0.001)</li>
<li>When controlling for admission status in a regression, a spurious relationship is introduced (coefficient = -0.16, p-value &lt; 0.001)</li>
</ol>
<p>The collider bias creates relationships between variables that are truly independent. This can be represented in a directed acyclic graph (DAG):</p>
<p><span class="math display">\text{Intelligence} \rightarrow \text{Admission} \leftarrow \text{Wealth}</span></p>
<p>When we condition on admission (the collider), we create a spurious association between intelligence and wealth.</p>
</section>
<section id="improper-analysis" class="level3">
<h3 class="anchored" data-anchor-id="improper-analysis">Improper Analysis</h3>
<p>Inappropriate statistical methods can produce spurious correlations. Common issues include using linear models for non-linear relationships, ignoring data clustering, or mishandling time series data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with a true non-linear relationship</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> n)</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)  <span class="co"># Quadratic relationship</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>improper_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit incorrect linear model</span></span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>wrong_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> improper_data)</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit correct quadratic model</span></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>correct_model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> improper_data)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(wrong_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = improper_data)

Residuals:
    Min      1Q  Median      3Q     Max 
-4.2176 -2.1477 -0.6468  2.4365  7.3457 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.14689    0.28951  10.870   &lt;2e-16 ***
x            0.08123    0.16548   0.491    0.625    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.895 on 98 degrees of freedom
Multiple R-squared:  0.002453,  Adjusted R-squared:  -0.007726 
F-statistic: 0.2409 on 1 and 98 DF,  p-value: 0.6246</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(correct_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x + I(x^2), data = improper_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.81022 -0.65587  0.01935  0.61168  2.68894 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.12407    0.14498   0.856    0.394    
x            0.08123    0.05524   1.470    0.145    
I(x^2)       0.98766    0.03531  27.972   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9664 on 97 degrees of freedom
Multiple R-squared:   0.89, Adjusted R-squared:  0.8877 
F-statistic: 392.3 on 2 and 97 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(improper_data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">formula =</span> y <span class="sc">~</span> x <span class="sc">+</span> <span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Improper Analysis Example"</span>,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Linear model (red) vs. Quadratic model (green)"</span>,</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Variable X"</span>,</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Variable Y"</span></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/improper_analysis-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The linear model incorrectly suggests no relationship between x and y (coefficient near zero, p-value = 0.847), while the quadratic model reveals the true relationship (<span class="math inline">R^2 = 0.90</span>). This demonstrates how model misspecification can create spurious non-correlations, masking real relationships that exist in different forms.</p>
</section>
<section id="endogeneity-and-its-sources" class="level3">
<h3 class="anchored" data-anchor-id="endogeneity-and-its-sources">Endogeneity and Its Sources</h3>
<p>Endogeneity occurs when an explanatory variable is correlated with the error term in a regression model. This violates the exogeneity assumption of OLS regression and leads to biased estimates. There are several sources of endogeneity:</p>
<section id="omitted-variable-bias" class="level4">
<h4 class="anchored" data-anchor-id="omitted-variable-bias">Omitted Variable Bias</h4>
<p>As shown in the education-income example, when important variables are omitted from the model, their effects are absorbed into the error term, which becomes correlated with included variables.</p>
</section>
<section id="measurement-error" class="level4">
<h4 class="anchored" data-anchor-id="measurement-error">Measurement Error</h4>
<p>When variables are measured with error, the observed values differ from true values, creating correlation between the error term and the predictors.</p>
</section>
<section id="simultaneity-bidirectional-causality" class="level4">
<h4 class="anchored" data-anchor-id="simultaneity-bidirectional-causality">Simultaneity (Bidirectional Causality)</h4>
<p>When the dependent variable also affects the independent variable, creating a feedback loop. Let’s demonstrate this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data with mutual influence</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Initialize variables</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>economic_growth <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">2</span>, <span class="dv">1</span>)</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>employment_rate <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="dv">60</span>, <span class="dv">5</span>)</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create mutual influence through iterations</span></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) {</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>  economic_growth <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.05</span> <span class="sc">*</span> employment_rate <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  employment_rate <span class="ot">&lt;-</span> <span class="dv">50</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">*</span> economic_growth <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-14"><a href="#cb68-14" aria-hidden="true" tabindex="-1"></a>simultaneity_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb68-15"><a href="#cb68-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">growth =</span> economic_growth,</span>
<span id="cb68-16"><a href="#cb68-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">employment =</span> employment_rate</span>
<span id="cb68-17"><a href="#cb68-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb68-18"><a href="#cb68-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-19"><a href="#cb68-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Model estimating effect of growth on employment</span></span>
<span id="cb68-20"><a href="#cb68-20" aria-hidden="true" tabindex="-1"></a>model_growth_on_emp <span class="ot">&lt;-</span> <span class="fu">lm</span>(employment <span class="sc">~</span> growth, <span class="at">data =</span> simultaneity_data)</span>
<span id="cb68-21"><a href="#cb68-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-22"><a href="#cb68-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Model estimating effect of employment on growth</span></span>
<span id="cb68-23"><a href="#cb68-23" aria-hidden="true" tabindex="-1"></a>model_emp_on_growth <span class="ot">&lt;-</span> <span class="fu">lm</span>(growth <span class="sc">~</span> employment, <span class="at">data =</span> simultaneity_data)</span>
<span id="cb68-24"><a href="#cb68-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-25"><a href="#cb68-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Show results</span></span>
<span id="cb68-26"><a href="#cb68-26" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_growth_on_emp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = employment ~ growth, data = simultaneity_data)

Residuals:
   Min     1Q Median     3Q    Max 
-3.603 -1.500 -0.099  1.387  5.673 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  49.9665     2.0717   24.12   &lt;2e-16 ***
growth        5.0151     0.3528   14.22   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 2.045 on 98 degrees of freedom
Multiple R-squared:  0.6734,    Adjusted R-squared:  0.6701 
F-statistic: 202.1 on 1 and 98 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_emp_on_growth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = growth ~ employment, data = simultaneity_data)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.11417 -0.20626 -0.02185  0.22646  0.72941 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -4.801257   0.749557  -6.405 5.23e-09 ***
employment   0.134283   0.009446  14.216  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3346 on 98 degrees of freedom
Multiple R-squared:  0.6734,    Adjusted R-squared:  0.6701 
F-statistic: 202.1 on 1 and 98 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(simultaneity_data, <span class="fu">aes</span>(<span class="at">x =</span> growth, <span class="at">y =</span> employment)) <span class="sc">+</span></span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"darkblue"</span>) <span class="sc">+</span></span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Simultaneity Between Economic Growth and Employment"</span>,</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Economic Growth (%)"</span>,</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Employment Rate (%)"</span></span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb72-10"><a href="#cb72-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/simultaneity-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The true data generating process is a system of simultaneous equations:</p>
<p><span class="math display">\text{Growth}_i = \alpha_0 + \alpha_1 \text{Employment}_i + u_i</span> <span class="math display">\text{Employment}_i = \beta_0 + \beta_1 \text{Growth}_i + v_i</span></p>
<p>Standard OLS regression cannot consistently estimate either equation because each explanatory variable is correlated with the error term in its respective equation.</p>
</section>
<section id="selection-bias" class="level4">
<h4 class="anchored" data-anchor-id="selection-bias">Selection Bias</h4>
<p>When the sample is not randomly selected from the population, the selection process can introduce correlation between the error term and the predictors. The collider bias example demonstrates a form of selection bias.</p>
<p>The consequences of endogeneity include: - Biased coefficient estimates - Incorrect standard errors - Invalid hypothesis tests - Misleading causal interpretations</p>
<p>Addressing endogeneity requires specialized methods such as instrumental variables, system estimation, panel data methods, or experimental designs.</p>
</section>
</section>
</section>
<section id="methods-for-addressing-spurious-correlations" class="level2" data-number="15.5">
<h2 data-number="15.5" class="anchored" data-anchor-id="methods-for-addressing-spurious-correlations"><span class="header-section-number">15.5</span> Methods for Addressing Spurious Correlations</h2>
<p>Several approaches can mitigate the risk of spurious correlations:</p>
<ol type="1">
<li><p><strong>Controlling for confounding variables</strong>: Include potential confounders in regression models</p></li>
<li><p><strong>Randomized experiments</strong>: Random assignment eliminates selection bias and many confounding effects</p></li>
<li><p><strong>Instrumental variables</strong>: Variables that affect the predictor but not the outcome directly</p></li>
<li><p><strong>Fixed effects models</strong>: Control for time-invariant confounders in panel data</p></li>
<li><p><strong>Difference-in-differences</strong>: Exploit natural experiments</p></li>
<li><p><strong>Regression discontinuity</strong>: Use arbitrary cutoffs to create quasi-random assignment</p></li>
<li><p><strong>Cross-validation</strong>: Test relationships in separate samples to avoid chance findings</p></li>
<li><p><strong>Theoretical plausibility</strong>: Assess whether relationships make theoretical sense</p></li>
</ol>
</section>
<section id="conclusion" class="level2" data-number="15.6">
<h2 data-number="15.6" class="anchored" data-anchor-id="conclusion"><span class="header-section-number">15.6</span> Conclusion</h2>
<p>Understanding the distinction between correlation and causation is essential for sound statistical inference. Spurious correlations can arise from various sources:</p>
<ol type="1">
<li>Random coincidence (chance)</li>
<li>Confounding variables (hidden third factors)</li>
<li>Reverse causality</li>
<li>Selection biases (including collider bias)</li>
<li>Improper statistical analysis</li>
<li>Endogeneity problems (including omitted variables, measurement error, simultaneity, and selection bias)</li>
</ol>
<p>Regression analysis provides tools for quantifying relationships and controlling for confounding variables, but establishing causality requires careful research design and appropriate statistical methods. When interpreting correlations, researchers should systematically consider alternative explanations and potential sources of bias.</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ lubridate 1.9.3     ✔ tibble    3.2.1
✔ purrr     1.0.2     ✔ tidyr     1.3.1
✔ readr     2.1.5     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ gridExtra::combine() masks dplyr::combine()
✖ dplyr::filter()      masks stats::filter()
✖ dplyr::lag()         masks stats::lag()
✖ car::recode()        masks dplyr::recode()
✖ purrr::some()        masks car::some()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="regression-analysis" class="level2" data-number="15.7">
<h2 data-number="15.7" class="anchored" data-anchor-id="regression-analysis"><span class="header-section-number">15.7</span> Regression Analysis</h2>
<p>Regression analysis is a fundamental statistical method that examines and models the relationship between variables to understand how changes in one or more independent variables influence a dependent variable.</p>
<p><strong>The Core Concept</strong></p>
<p>At its heart, regression analysis helps us answer questions about cause and effect, prediction, and forecasting. For example, a business might use regression analysis to understand how advertising spending affects sales, or how employee training hours impact productivity.</p>
<p><strong>How Regression Analysis Works</strong></p>
<p>The process begins by collecting data about the variables of interest. The analysis then fits a mathematical model—typically a line or curve—that best represents the relationship between these variables. This model allows us to:</p>
<ul>
<li>Identify the strength and direction of relationships between variables</li>
<li>Make predictions about future outcomes</li>
<li>Understand which factors have the most significant impact on our results</li>
</ul>
<section id="regression-as-a-stochastic-model" class="level3">
<h3 class="anchored" data-anchor-id="regression-as-a-stochastic-model">Regression as a Stochastic Model</h3>
<p>In mathematical modeling, we encounter two fundamental approaches to describing relationships between variables:</p>
<ul>
<li>deterministic models,</li>
<li>stochastic models.</li>
</ul>
<section id="deterministic-vs.-stochastic-models" class="level4">
<h4 class="anchored" data-anchor-id="deterministic-vs.-stochastic-models">Deterministic vs.&nbsp;Stochastic Models</h4>
<p>A deterministic model assumes a precise, fixed relationship between inputs and outputs. In such models, if we know the inputs, we can calculate the exact output with certainty. Consider the classic physics equation for distance:</p>
<p><span class="math display">\text{Distance} = \text{Speed} × \text{Time}</span></p>
<p>Given specific values for speed and time, this equation will always yield the same distance. There is no room for variation in the outcome.</p>
<p>In contrast, regression analysis embraces the presence of natural variation in data. The fundamental structure of a regression model is:</p>
<p><span class="math display">Y = f(X) + \epsilon</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">Y</span> represents the outcome we wish to predict</li>
<li><span class="math inline">f(X)</span> represents the systematic relationship between our predictors (X) and the outcome</li>
<li><span class="math inline">\epsilon</span> represents the random variation that naturally occurs in real-world data</li>
</ul>
</section>
<section id="the-nature-of-stochastic-models-in-regression" class="level4">
<h4 class="anchored" data-anchor-id="the-nature-of-stochastic-models-in-regression">The Nature of Stochastic Models in Regression</h4>
<p>The inclusion of the error term <span class="math inline">\epsilon</span> acknowledges that real relationships between variables are rarely perfect. For example, when studying how study time affects test scores, many factors contribute to the final outcome:</p>
<p>The systematic part <span class="math inline">f(X)</span> captures the general trend: more study time tends to lead to higher scores.</p>
<p>The error term <span class="math inline">\epsilon</span> accounts for all other influences:</p>
<ul>
<li>Different learning styles</li>
<li>Study environment</li>
<li>Physical and mental state during the test</li>
<li>Quality of study materials</li>
</ul>
</section>
<section id="mathematical-framework" class="level4">
<h4 class="anchored" data-anchor-id="mathematical-framework">Mathematical Framework</h4>
<p>In its simplest form, linear regression can be expressed as:</p>
<p><span class="math display">Y = \beta_0 + \beta_1X + \epsilon</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\beta_0</span> represents the baseline value (when X = 0)</li>
<li><span class="math inline">\beta_1</span> represents the change in Y for each unit increase in X</li>
<li><span class="math inline">\epsilon</span> represents the natural variation around this relationship</li>
</ul>
</section>
<section id="practical-implications" class="level4">
<h4 class="anchored" data-anchor-id="practical-implications">Practical Implications</h4>
<p>Understanding regression as a stochastic model has important practical implications:</p>
<ol type="1">
<li><p>Predictions: We recognize that our predictions will have some natural variation around them. Rather than claiming an exact outcome, we acknowledge a range of plausible values.</p></li>
<li><p>Model Evaluation: We assess models by how well they capture both the general trend and the typical amount of variation in the data.</p></li>
<li><p>Decision Making: Understanding the natural variation in our predictions helps us make more realistic plans and decisions.</p></li>
</ol>
<p><strong>Real-World Applications</strong></p>
<p>Consider predicting house prices based on square footage. A deterministic model might say: “A 2000 sq ft house will sell for exactly $300,000”</p>
<p>A regression model instead recognizes that:</p>
<ul>
<li>There’s a general relationship between size and price</li>
<li>But many other factors affect the final price</li>
<li>Similar houses might sell for somewhat different prices</li>
<li>Our predictions should reflect this natural variation</li>
</ul>
<p><strong>Conclusion</strong></p>
<p>The stochastic nature of regression analysis provides a more realistic framework for understanding real-world relationships between variables. By explicitly accounting for natural variation, regression analysis helps us:</p>
<ul>
<li>Make more realistic predictions</li>
<li>Better understand the limitations of our models</li>
<li>Make more informed decisions</li>
</ul>
</section>
</section>
<section id="why-study-regression" class="level3">
<h3 class="anchored" data-anchor-id="why-study-regression">Why Study Regression?</h3>
<p>Regression analysis is a fundamental statistical tool that helps us understand relationships between variables. Before diving into formulas and technical details, let’s understand what questions regression can help us answer:</p>
<ul>
<li>How much does each additional year of education affect someone’s salary?</li>
<li>What is the relationship between advertising spending and sales?</li>
<li>How does temperature affect energy consumption?</li>
<li>Do study hours predict exam scores?</li>
</ul>
<p>These questions share a common structure: they all explore how changes in one variable relate to changes in another.</p>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Linear Regression (OLS): Quickstart guide
</div>
</div>
<div class="callout-body-container callout-body">
<section id="the-model-concept" class="level3">
<h3 class="anchored" data-anchor-id="the-model-concept">The Model Concept</h3>
<p>OLS regression is a statistical model that describes the relationship between variables. Two key assumptions define this model:</p>
<ol type="1">
<li>The relationship can be described by a straight line (linearity)</li>
<li>The errors in our predictions are not systematically related to our x-variable (strict exogeneity)</li>
</ol>
</section>
<section id="example-education-and-wages" class="level3">
<h3 class="anchored" data-anchor-id="example-education-and-wages">Example: Education and Wages</h3>
<p>Consider studying the effect of education (x) on wages (y). Let’s say we estimate:</p>
<p><span class="math display">wages = \beta_0 + \beta_1 \cdot education + \epsilon</span></p>
<p>The error term <span class="math inline">\epsilon</span> contains all other factors affecting wages. Strict exogeneity is violated if we omit an important variable like “ability” that affects both education and wages. Why? Because more able people tend to get more education AND higher wages, making our estimate of education’s effect biased upward.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample data</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">20</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> n)</span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">1.5</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="fl">1.5</span>)</span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-11"><a href="#cb77-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate OLS parameters</span></span>
<span id="cb77-12"><a href="#cb77-12" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fu">cov</span>(x, y) <span class="sc">/</span> <span class="fu">var</span>(x)</span>
<span id="cb77-13"><a href="#cb77-13" aria-hidden="true" tabindex="-1"></a>beta0 <span class="ot">&lt;-</span> <span class="fu">mean</span>(y) <span class="sc">-</span> beta1 <span class="sc">*</span> <span class="fu">mean</span>(x)</span>
<span id="cb77-14"><a href="#cb77-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-15"><a href="#cb77-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Create alternative lines</span></span>
<span id="cb77-16"><a href="#cb77-16" aria-hidden="true" tabindex="-1"></a>lines_data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb77-17"><a href="#cb77-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">intercept =</span> <span class="fu">c</span>(beta0, beta0 <span class="sc">+</span> <span class="dv">1</span>, beta0 <span class="sc">-</span> <span class="dv">1</span>),</span>
<span id="cb77-18"><a href="#cb77-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">slope =</span> <span class="fu">c</span>(beta1, beta1 <span class="sc">+</span> <span class="fl">0.3</span>, beta1 <span class="sc">-</span> <span class="fl">0.3</span>),</span>
<span id="cb77-19"><a href="#cb77-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">line_type =</span> <span class="fu">c</span>(<span class="st">"Best fit (OLS)"</span>, <span class="st">"Suboptimal 1"</span>, <span class="st">"Suboptimal 2"</span>)</span>
<span id="cb77-20"><a href="#cb77-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb77-21"><a href="#cb77-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-22"><a href="#cb77-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb77-23"><a href="#cb77-23" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb77-24"><a href="#cb77-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb77-25"><a href="#cb77-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> lines_data,</span>
<span id="cb77-26"><a href="#cb77-26" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept, </span>
<span id="cb77-27"><a href="#cb77-27" aria-hidden="true" tabindex="-1"></a>                  <span class="at">slope =</span> slope,</span>
<span id="cb77-28"><a href="#cb77-28" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> line_type,</span>
<span id="cb77-29"><a href="#cb77-29" aria-hidden="true" tabindex="-1"></a>                  <span class="at">linetype =</span> line_type),</span>
<span id="cb77-30"><a href="#cb77-30" aria-hidden="true" tabindex="-1"></a>              <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb77-31"><a href="#cb77-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"Best fit (OLS)"</span> <span class="ot">=</span> <span class="st">"#FF4500"</span>,</span>
<span id="cb77-32"><a href="#cb77-32" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Suboptimal 1"</span> <span class="ot">=</span> <span class="st">"#4169E1"</span>,</span>
<span id="cb77-33"><a href="#cb77-33" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Suboptimal 2"</span> <span class="ot">=</span> <span class="st">"#228B22"</span>)) <span class="sc">+</span></span>
<span id="cb77-34"><a href="#cb77-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Finding the Best-Fitting Line"</span>,</span>
<span id="cb77-35"><a href="#cb77-35" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Orange line minimizes the sum of squared errors"</span>,</span>
<span id="cb77-36"><a href="#cb77-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"X Variable"</span>,</span>
<span id="cb77-37"><a href="#cb77-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Y Variable"</span>,</span>
<span id="cb77-38"><a href="#cb77-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Line Type"</span>,</span>
<span id="cb77-39"><a href="#cb77-39" aria-hidden="true" tabindex="-1"></a>       <span class="at">linetype =</span> <span class="st">"Line Type"</span>) <span class="sc">+</span></span>
<span id="cb77-40"><a href="#cb77-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb77-41"><a href="#cb77-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb77-42"><a href="#cb77-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb77-43"><a href="#cb77-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb77-44"><a href="#cb77-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb77-45"><a href="#cb77-45" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>()</span>
<span id="cb77-46"><a href="#cb77-46" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-optimization-problem-understanding-ols" class="level3">
<h3 class="anchored" data-anchor-id="the-optimization-problem-understanding-ols">The Optimization Problem: Understanding OLS</h3>
<p>When we analyze relationships between variables like education and wages, we need a systematic method to find the line that best represents this relationship in our data. Ordinary Least Squares (OLS) provides this method through a clear mathematical approach.</p>
<p>Consider our plot of education levels and wages. Each point represents actual data - one person’s years of education and their corresponding wage. Our goal is to find a single line that most accurately captures the underlying relationship between these variables.</p>
<p>For any given observation <span class="math inline">i</span>, we can express this relationship as: <span class="math display">y_i = \beta_0 + \beta_1x_i + \epsilon_i</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">y_i</span> is the actual observed wage</li>
<li><span class="math inline">\hat{y_i} = \beta_0 + \beta_1x_i</span> is our predicted wage</li>
<li><span class="math inline">\epsilon_i = y_i - \hat{y_i}</span> is the error term (or residual)</li>
</ul>
<p>OLS finds the optimal values for <span class="math inline">\hat{\beta}_0</span> and <span class="math inline">\hat{\beta}_1</span> by minimizing the sum of squared errors:</p>
<p><span class="math display">\min_{\hat{\beta}_0, \hat{\beta}_1} \sum \epsilon_i^2 = \min_{\hat{\beta}_0, \hat{\beta}_1} \sum(y_i - \hat{y_i})^2 = \min_{\hat{\beta}_0, \hat{\beta}_1} \sum(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></p>
<p>Looking at our visualization:</p>
<ul>
<li>The scattered points show our actual observations <span class="math inline">(x_i, y_i)</span></li>
<li>The red line represents our fitted values <span class="math inline">\hat{y_i}</span> that minimize <span class="math inline">\sum \epsilon_i^2</span></li>
<li>The blue and green lines represent alternative fits with larger total squared errors</li>
<li>The vertical distances from each point to these lines represent the errors <span class="math inline">\epsilon_i</span></li>
</ul>
<p>The OLS solution provides us with parameter estimates <span class="math inline">\hat{\beta_0}</span> and <span class="math inline">\hat{\beta_1}</span> that minimize the total squared error, giving us the most accurate linear representation of the relationship between education and wages based on our available data.</p>
</section>
<section id="finding-the-best-line" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-best-line">Finding the Best Line</h3>
<p>The solution to this minimization gives us:</p>
<p><span class="math display">\hat{\beta}_1 = \frac{\sum(x_i - \bar{x})(y_i - \bar{y})}{\sum(x_i - \bar{x})^2} = \frac{cov(X, Y)}{var(X)}</span></p>
<p><span class="math display">\hat{\beta}_0 = \bar{y} - \hat{\beta}_1\bar{x}</span></p>
</section>
<section id="key-points" class="level3">
<h3 class="anchored" data-anchor-id="key-points">Key Points</h3>
<ol type="1">
<li>OLS finds the line that minimizes squared prediction errors</li>
<li>This line is “best” in terms of fit, but might not capture true relationships if important variables are omitted</li>
<li>In the education-wages example, omitting ability means we attribute all the wage increase to education alone</li>
</ol>
</section>
</div>
</div>
</section>
<section id="basic-concepts-and-terminology" class="level3">
<h3 class="anchored" data-anchor-id="basic-concepts-and-terminology">Basic Concepts and Terminology</h3>
<p>Let’s establish our key terms:</p>
<ul>
<li><strong>Dependent Variable (Y)</strong>:
<ul>
<li>The outcome we want to understand or predict</li>
<li>Also called: response variable, target variable</li>
<li>Examples: salary, sales, exam scores</li>
</ul></li>
<li><strong>Independent Variable (X)</strong>:
<ul>
<li>The variable we think influences Y</li>
<li>Also called: predictor, explanatory variable, regressor</li>
<li>Examples: years of education, advertising budget, study hours</li>
</ul></li>
<li><strong>Population Parameters (</strong><span class="math inline">\beta</span>):
<ul>
<li>The true underlying relationships we want to understand</li>
<li>Usually unknown in practice</li>
<li>Examples: <span class="math inline">\beta_0</span> (true intercept), <span class="math inline">\beta_1</span> (true slope)</li>
</ul></li>
<li><strong>Parameter Estimates (</strong><span class="math inline">\hat{\beta}</span>):
<ul>
<li>Our best guesses of the true parameters based on data</li>
<li>Calculated from sample data</li>
<li>Examples: <span class="math inline">\hat{\beta}_0</span> (estimated intercept), <span class="math inline">\hat{\beta}_1</span> (estimated slope)</li>
</ul></li>
</ul>
</section>
<section id="the-core-idea" class="level3">
<h3 class="anchored" data-anchor-id="the-core-idea">The Core Idea</h3>
<p>Let’s visualize what regression does with a simple example:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate some example data</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.5</span>)</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb78-9"><a href="#cb78-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb78-10"><a href="#cb78-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb78-11"><a href="#cb78-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb78-12"><a href="#cb78-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb78-13"><a href="#cb78-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb78-14"><a href="#cb78-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb78-15"><a href="#cb78-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Simple Linear Regression Example"</span>,</span>
<span id="cb78-16"><a href="#cb78-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Points represent data, red line shows regression fit"</span>,</span>
<span id="cb78-17"><a href="#cb78-17" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Independent Variable (X)"</span>,</span>
<span id="cb78-18"><a href="#cb78-18" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Dependent Variable (Y)"</span>) <span class="sc">+</span></span>
<span id="cb78-19"><a href="#cb78-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">"bold"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-basic-idea" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-basic-idea-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="correg_en_files/figure-html/fig-basic-idea-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-basic-idea-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15.1: Basic Idea of Regression: Fitting a Line to Data
</figcaption>
</figure>
</div>
</div>
</div>
<p>This plot shows the essence of regression:</p>
<ul>
<li>Each point represents an observation (X, Y)</li>
<li>The line represents our best guess at the relationship</li>
<li>The spread of points around the line shows the uncertainty</li>
</ul>
</section>
</section>
<section id="the-linear-regression-model-1" class="level2" data-number="15.8">
<h2 data-number="15.8" class="anchored" data-anchor-id="the-linear-regression-model-1"><span class="header-section-number">15.8</span> The Linear Regression Model</h2>
<section id="population-model-vs.-sample-estimates" class="level3">
<h3 class="anchored" data-anchor-id="population-model-vs.-sample-estimates">Population Model vs.&nbsp;Sample Estimates</h3>
<p>In theory, there exists a true population relationship:</p>
<p><span class="math display">Y = \beta_0 + \beta_1X + \varepsilon</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">\beta_0</span> is the true population intercept</li>
<li><span class="math inline">\beta_1</span> is the true population slope</li>
<li><span class="math inline">\varepsilon</span> is the random error term</li>
</ul>
<p>In practice, we work with sample data to estimate this relationship:</p>
<p><span class="math display">\hat{Y} = \hat{\beta}_0 + \hat{\beta}_1X</span></p>
<p>Let’s visualize the difference between population and sample relationships:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate population data</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">456</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>x_pop <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>true_relationship <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x_pop  <span class="co"># True β₀=2, β₁=3</span></span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>y_pop <span class="ot">&lt;-</span> true_relationship <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x_pop), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create several samples</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>sample_size <span class="ot">&lt;-</span> <span class="dv">30</span></span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(<span class="fu">sample</span>(x_pop, sample_size), <span class="dv">3</span>),</span>
<span id="cb80-11"><a href="#cb80-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">sample =</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">each =</span> sample_size)</span>
<span id="cb80-12"><a href="#cb80-12" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb80-13"><a href="#cb80-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-14"><a href="#cb80-14" aria-hidden="true" tabindex="-1"></a>samples<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>samples<span class="sc">$</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">nrow</span>(samples), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb80-15"><a href="#cb80-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-16"><a href="#cb80-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models to each sample</span></span>
<span id="cb80-17"><a href="#cb80-17" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> samples <span class="sc">%&gt;%</span></span>
<span id="cb80-18"><a href="#cb80-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sample) <span class="sc">%&gt;%</span></span>
<span id="cb80-19"><a href="#cb80-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb80-20"><a href="#cb80-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">intercept =</span> <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))[<span class="dv">1</span>],</span>
<span id="cb80-21"><a href="#cb80-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">slope =</span> <span class="fu">coef</span>(<span class="fu">lm</span>(y <span class="sc">~</span> x))[<span class="dv">2</span>]</span>
<span id="cb80-22"><a href="#cb80-22" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb80-23"><a href="#cb80-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-24"><a href="#cb80-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb80-25"><a href="#cb80-25" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb80-26"><a href="#cb80-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> samples, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">color =</span> <span class="fu">factor</span>(sample)), </span>
<span id="cb80-27"><a href="#cb80-27" aria-hidden="true" tabindex="-1"></a>             <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb80-28"><a href="#cb80-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">data =</span> models, </span>
<span id="cb80-29"><a href="#cb80-29" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">intercept =</span> intercept, <span class="at">slope =</span> slope, </span>
<span id="cb80-30"><a href="#cb80-30" aria-hidden="true" tabindex="-1"></a>                  <span class="at">color =</span> <span class="fu">factor</span>(sample)),</span>
<span id="cb80-31"><a href="#cb80-31" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb80-32"><a href="#cb80-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> x_pop, <span class="at">y =</span> true_relationship), </span>
<span id="cb80-33"><a href="#cb80-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"black"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb80-34"><a href="#cb80-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb80-35"><a href="#cb80-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Population vs. Sample Regression Lines"</span>,</span>
<span id="cb80-36"><a href="#cb80-36" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Black line: true population relationship</span><span class="sc">\n</span><span class="st">Dashed lines: sample estimates"</span>,</span>
<span id="cb80-37"><a href="#cb80-37" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"X"</span>, <span class="at">y =</span> <span class="st">"Y"</span>,</span>
<span id="cb80-38"><a href="#cb80-38" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Sample"</span>) <span class="sc">+</span></span>
<span id="cb80-39"><a href="#cb80-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-pop-vs-sample" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-pop-vs-sample-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="correg_en_files/figure-html/fig-pop-vs-sample-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-pop-vs-sample-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15.2: Population vs.&nbsp;Sample Regression Lines
</figcaption>
</figure>
</div>
</div>
</div>
<p>This visualization shows:</p>
<ul>
<li>The true population line (black) we’re trying to discover</li>
<li>Different sample estimates (dashed lines) based on different samples</li>
<li>How sample estimates vary around the true relationship</li>
</ul>
</section>
</section>
<section id="key-assumptions-of-linear-regression" class="level2" data-number="15.9">
<h2 data-number="15.9" class="anchored" data-anchor-id="key-assumptions-of-linear-regression"><span class="header-section-number">15.9</span> Key Assumptions of Linear Regression</h2>
<section id="strict-exogeneity-the-fundamental-assumption" class="level3">
<h3 class="anchored" data-anchor-id="strict-exogeneity-the-fundamental-assumption">Strict Exogeneity: The Fundamental Assumption</h3>
<p>The most crucial assumption in regression is strict exogeneity:</p>
<p><span class="math display">E[\varepsilon|X] = 0</span></p>
<p>This means:</p>
<ol type="1">
<li>The error term has zero mean conditional on X</li>
<li>X contains no information about the average error</li>
<li>There are no systematic patterns in how our predictions are wrong</li>
</ol>
<p>Let’s visualize when this assumption holds and when it doesn’t:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">789</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Case 1: Exogenous errors</span></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>y_exog <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Case 2: Non-exogenous errors (error variance increases with x)</span></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>y_nonexog <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">*</span><span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create datasets</span></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>data_exog <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb81-14"><a href="#cb81-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_exog,</span>
<span id="cb81-15"><a href="#cb81-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Exogenous Errors</span><span class="sc">\n</span><span class="st">(Assumption Satisfied)"</span></span>
<span id="cb81-16"><a href="#cb81-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-17"><a href="#cb81-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-18"><a href="#cb81-18" aria-hidden="true" tabindex="-1"></a>data_nonexog <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb81-19"><a href="#cb81-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb81-20"><a href="#cb81-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y_nonexog,</span>
<span id="cb81-21"><a href="#cb81-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">"Non-Exogenous Errors</span><span class="sc">\n</span><span class="st">(Assumption Violated)"</span></span>
<span id="cb81-22"><a href="#cb81-22" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb81-23"><a href="#cb81-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-24"><a href="#cb81-24" aria-hidden="true" tabindex="-1"></a>data_combined <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_exog, data_nonexog)</span>
<span id="cb81-25"><a href="#cb81-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-26"><a href="#cb81-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots with residuals</span></span>
<span id="cb81-27"><a href="#cb81-27" aria-hidden="true" tabindex="-1"></a>plot_residuals <span class="ot">&lt;-</span> <span class="cf">function</span>(data, title) {</span>
<span id="cb81-28"><a href="#cb81-28" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb81-29"><a href="#cb81-29" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model)</span>
<span id="cb81-30"><a href="#cb81-30" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>residuals <span class="ot">&lt;-</span> <span class="fu">residuals</span>(model)</span>
<span id="cb81-31"><a href="#cb81-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-32"><a href="#cb81-32" aria-hidden="true" tabindex="-1"></a>  p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb81-33"><a href="#cb81-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-34"><a href="#cb81-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb81-35"><a href="#cb81-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-36"><a href="#cb81-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> title)</span>
<span id="cb81-37"><a href="#cb81-37" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-38"><a href="#cb81-38" aria-hidden="true" tabindex="-1"></a>  p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> residuals)) <span class="sc">+</span></span>
<span id="cb81-39"><a href="#cb81-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb81-40"><a href="#cb81-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb81-41"><a href="#cb81-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb81-42"><a href="#cb81-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb81-43"><a href="#cb81-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb81-44"><a href="#cb81-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(p1, p2)</span>
<span id="cb81-45"><a href="#cb81-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb81-46"><a href="#cb81-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-47"><a href="#cb81-47" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate plots</span></span>
<span id="cb81-48"><a href="#cb81-48" aria-hidden="true" tabindex="-1"></a>plots_exog <span class="ot">&lt;-</span> <span class="fu">plot_residuals</span>(data_exog, <span class="st">"Exogenous Errors"</span>)</span>
<span id="cb81-49"><a href="#cb81-49" aria-hidden="true" tabindex="-1"></a>plots_nonexog <span class="ot">&lt;-</span> <span class="fu">plot_residuals</span>(data_nonexog, <span class="st">"Non-Exogenous Errors"</span>)</span>
<span id="cb81-50"><a href="#cb81-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-51"><a href="#cb81-51" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange plots</span></span>
<span id="cb81-52"><a href="#cb81-52" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(</span>
<span id="cb81-53"><a href="#cb81-53" aria-hidden="true" tabindex="-1"></a>  plots_exog[[<span class="dv">1</span>]], plots_exog[[<span class="dv">2</span>]],</span>
<span id="cb81-54"><a href="#cb81-54" aria-hidden="true" tabindex="-1"></a>  plots_nonexog[[<span class="dv">1</span>]], plots_nonexog[[<span class="dv">2</span>]],</span>
<span id="cb81-55"><a href="#cb81-55" aria-hidden="true" tabindex="-1"></a>  <span class="at">ncol =</span> <span class="dv">2</span></span>
<span id="cb81-56"><a href="#cb81-56" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-exogeneity" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-exogeneity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="correg_en_files/figure-html/fig-exogeneity-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-exogeneity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15.3: Exogeneity vs.&nbsp;Non-Exogeneity Examples
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="linearity-the-form-assumption" class="level3">
<h3 class="anchored" data-anchor-id="linearity-the-form-assumption">Linearity: The Form Assumption</h3>
<p>The relationship between X and Y should be linear in parameters:</p>
<p><span class="math display">E[Y|X] = \beta_0 + \beta_1X</span></p>
<p>Note that this doesn’t mean X and Y must have a straight-line relationship - we can transform variables. Let’s see different types of relationships:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">101</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.1</span>)</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Different relationships</span></span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>data_relationships <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">rep</span>(x, <span class="dv">3</span>),</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Linear</span></span>
<span id="cb83-10"><a href="#cb83-10" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb83-11"><a href="#cb83-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Quadratic</span></span>
<span id="cb83-12"><a href="#cb83-12" aria-hidden="true" tabindex="-1"></a>    <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>x<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>),</span>
<span id="cb83-13"><a href="#cb83-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Exponential</span></span>
<span id="cb83-14"><a href="#cb83-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">exp</span>(<span class="fl">0.3</span><span class="sc">*</span>x) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb83-15"><a href="#cb83-15" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb83-16"><a href="#cb83-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Quadratic"</span>, <span class="st">"Exponential"</span>), <span class="at">each =</span> <span class="fu">length</span>(x))</span>
<span id="cb83-17"><a href="#cb83-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb83-18"><a href="#cb83-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-19"><a href="#cb83-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb83-20"><a href="#cb83-20" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_relationships, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb83-21"><a href="#cb83-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb83-22"><a href="#cb83-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb83-23"><a href="#cb83-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb83-24"><a href="#cb83-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>type, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span></span>
<span id="cb83-25"><a href="#cb83-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb83-26"><a href="#cb83-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="st">"Red: linear fit, Blue: true relationship"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using method = 'loess' and formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-linearity" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-linearity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="correg_en_files/figure-html/fig-linearity-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-linearity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15.4: Linear and Nonlinear Relationships
</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="understanding-violations-and-solutions" class="level3">
<h3 class="anchored" data-anchor-id="understanding-violations-and-solutions">Understanding Violations and Solutions</h3>
<p>When linearity is violated:</p>
<ol type="1">
<li>Transform variables:
<ul>
<li>Log transformation: for exponential relationships</li>
<li>Square root: for moderate nonlinearity</li>
<li>Power transformations: for more complex relationships</li>
</ul></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate exponential data</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">102</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.2</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">exp</span>(<span class="fl">0.3</span><span class="sc">*</span>x) <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(x), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create datasets</span></span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>data_trans <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> x,</span>
<span id="cb85-9"><a href="#cb85-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> y,</span>
<span id="cb85-10"><a href="#cb85-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">log_y =</span> <span class="fu">log</span>(y)</span>
<span id="cb85-11"><a href="#cb85-11" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in log(y): NaNs produced</code></pre>
</div>
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Original scale plot</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_trans, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Original Scale"</span>)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Log scale plot</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_trans, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> log_y)) <span class="sc">+</span></span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb87-13"><a href="#cb87-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log-Transformed Y"</span>)</span>
<span id="cb87-14"><a href="#cb87-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-15"><a href="#cb87-15" aria-hidden="true" tabindex="-1"></a>gridExtra<span class="sc">::</span><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing non-finite outside the scale range
(`stat_smooth()`).</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Removed 1 row containing missing values or values outside the scale range
(`geom_point()`).</code></pre>
</div>
<div class="cell-output-display">
<div id="fig-transformations" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-transformations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="correg_en_files/figure-html/fig-transformations-1.png" class="img-fluid figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-transformations-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15.5: Effect of Variable Transformations
</figcaption>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Ordinary Least Squares (OLS) Intuitively
</div>
</div>
<div class="callout-body-container callout-body">
<section id="the-basic-problem" class="level3">
<h3 class="anchored" data-anchor-id="the-basic-problem">The Basic Problem</h3>
<p>Let’s start with a real-world scenario: understanding how study time affects exam performance. We collect data from your class where:</p>
<ul>
<li>Each student records their study hours (<span class="math inline">x</span>), and their final exam score (<span class="math inline">y</span>)</li>
<li>So student 1 might have studied <span class="math inline">x_1 = 3</span> hours and scored <span class="math inline">y_1 = 75</span> points</li>
<li>Student 2 might have studied <span class="math inline">x_2 = 5</span> hours and scored <span class="math inline">y_2 = 82</span> points</li>
<li>And so on for all <span class="math inline">n</span> students in the class</li>
</ul>
<p>Our goal is to find a straight line that best describes this relationship. We’re trying to estimate the true relationship (which we never know exactly) using our sample of data. Let’s explore this step by step.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a>study_hours <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>exam_scores <span class="ot">&lt;-</span> <span class="dv">60</span> <span class="sc">+</span> <span class="dv">5</span> <span class="sc">*</span> study_hours <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(study_hours, exam_scores)</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-9"><a href="#cb91-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Basic scatter plot with multiple lines</span></span>
<span id="cb91-10"><a href="#cb91-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> study_hours, <span class="at">y =</span> exam_scores)) <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb91-12"><a href="#cb91-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Study Hours"</span>, <span class="at">y =</span> <span class="st">"Exam Scores"</span>,</span>
<span id="cb91-13"><a href="#cb91-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Your Class Data: Study Hours vs. Exam Scores"</span>) <span class="sc">+</span></span>
<span id="cb91-14"><a href="#cb91-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb91-15"><a href="#cb91-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-makes-a-line-good" class="level3">
<h3 class="anchored" data-anchor-id="what-makes-a-line-good">What Makes a Line “Good”?</h3>
<p>Any straight line can be written in the form:</p>
<p><span class="math inline">y = \hat{\beta}_0 + \hat{\beta}_1x</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">\hat{\beta}_0</span> is our estimate of the y-intercept (the predicted score for zero study hours)</li>
<li><span class="math inline">\hat{\beta}_1</span> is our estimate of the slope (how many points you gain per extra hour of study)</li>
<li>The hats (^) indicate these are our estimates of the true (unknown) parameters <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span></li>
</ul>
<p>Let’s look at three possible lines through our data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> study_hours, <span class="at">y =</span> exam_scores)) <span class="sc">+</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">50</span>, <span class="at">slope =</span> <span class="dv">8</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">70</span>, <span class="at">slope =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Study Hours"</span>, <span class="at">y =</span> <span class="st">"Exam Scores"</span>,</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Three Different Lines: Which is Best?"</span>) <span class="sc">+</span></span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="dv">120</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">label =</span> <span class="st">"Line A: Too Steep"</span>) <span class="sc">+</span></span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="dv">85</span>, <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">label =</span> <span class="st">"Line B: Too Flat"</span>) <span class="sc">+</span></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="fl">7.5</span>, <span class="at">y =</span> <span class="dv">100</span>, <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">label =</span> <span class="st">"Line C: Just Right"</span>) <span class="sc">+</span></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb92-12"><a href="#cb92-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="understanding-prediction-errors-residuals" class="level3">
<h3 class="anchored" data-anchor-id="understanding-prediction-errors-residuals">Understanding Prediction Errors (Residuals)</h3>
<p>Here’s where the magic of OLS begins. For each student in our data:</p>
<ol type="1">
<li>We look at their actual exam score (<span class="math inline">y_i</span>)</li>
<li>We calculate their predicted score using our line (<span class="math inline">\hat{y}_i = \hat{\beta}_0 + \hat{\beta}_1x_i</span>)</li>
<li>The difference between these is called a residual:</li>
</ol>
<p><span class="math inline">\text{residual}_i = y_i - \hat{y}_i = y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i)</span></p>
<p>Let’s visualize these residuals for one line:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit the model and show residuals</span></span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(exam_scores <span class="sc">~</span> study_hours, <span class="at">data =</span> data)</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> study_hours, <span class="at">y =</span> exam_scores)) <span class="sc">+</span></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> study_hours, </span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">yend =</span> <span class="fu">predict</span>(model, data)),</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"orange"</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Study Hours"</span>, <span class="at">y =</span> <span class="st">"Exam Scores"</span>,</span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Understanding Residuals: The Gaps Between Predictions and Reality"</span>) <span class="sc">+</span></span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The orange vertical lines show how far off our predictions are for each student. Some predictions are too high (positive residuals), others too low (negative residuals).</p>
</section>
<section id="why-do-we-square-the-residuals" class="level3">
<h3 class="anchored" data-anchor-id="why-do-we-square-the-residuals">Why Do We Square the Residuals?</h3>
<p>This is a crucial concept! Let’s walk through it with a simple example:</p>
<p>Imagine we have just two students:</p>
<ol type="1">
<li>Alice: Predicted 80, actual score 85 (residual = +5)</li>
<li>Bob: Predicted 90, actual score 85 (residual = -5)</li>
</ol>
<p>If we just add these residuals: <span class="math inline">(+5) + (-5) = 0</span></p>
<p>This would suggest our line is perfect (total error = 0), but we know it’s not! Both predictions were off by 5 points.</p>
<p>Solution: Square the residuals before adding them:</p>
<ul>
<li>Alice’s squared residual: <span class="math inline">(+5)^2 = 25</span></li>
<li>Bob’s squared residual: <span class="math inline">(-5)^2 = 25</span></li>
<li>Total squared error: <span class="math inline">25 + 25 = 50</span></li>
</ul>
<p>This gives us a much better measure of how wrong our predictions are!</p>
</section>
<section id="sum-of-squared-errors-sse" class="level3">
<h3 class="anchored" data-anchor-id="sum-of-squared-errors-sse">Sum of Squared Errors (SSE)</h3>
<p>The Sum of Squared Errors (SSE) represents a fundamental measure of fit in linear regression modeling. We can express it mathematically as:</p>
<p><span class="math display">SSE = \sum_{i=1}^n (y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></p>
<p>where:</p>
<ul>
<li><span class="math inline">y_i</span> represents the actual value of the dependent variable for the i-th observation</li>
<li><span class="math inline">\hat{\beta}_0</span> represents the estimated intercept (Y-axis intersection point)</li>
<li><span class="math inline">\hat{\beta}_1</span> represents the estimated slope coefficient</li>
<li><span class="math inline">x_i</span> represents the value of the independent variable for the i-th observation</li>
</ul>
<p>The process of calculating SSE follows these methodical steps:</p>
<ol type="1">
<li><p>For each observation, we calculate the difference between the actual value (<span class="math inline">y_i</span>) and the value predicted by our model (<span class="math inline">\hat{\beta}_0 + \hat{\beta}_1x_i</span>). This difference is termed the residual.</p></li>
<li><p>We square each residual, which produces several important effects:</p></li>
</ol>
<ul>
<li>All values become positive, eliminating the possibility of negative and positive errors canceling each other out</li>
<li>Larger errors receive proportionally greater weight than smaller ones</li>
<li>The units of measurement become squared</li>
</ul>
<ol start="3" type="1">
<li>We sum all these squared residuals, producing a single number that represents the model’s total error.</li>
</ol>
<p><strong>The interpretation of SSE is straightforward: a smaller SSE indicates better model fit to the empirical data.</strong></p>
<p>An SSE value of 0 would indicate perfect fit, where all points lie exactly on the regression line. However, in practice, such perfect fit rarely occurs and might actually indicate a problematic overfit of the model.</p>
<p>SSE serves as the foundation for calculating other important measures of model fit quality, such as the coefficient of determination (R²) and the standard error of estimate. It provides a quantitative basis for comparing different models and assessing the accuracy of our predictions.</p>
<p>Understanding SSE is crucial for model evaluation and refinement, as it helps identify how well our model captures the underlying patterns in our data while avoiding the pitfalls of both underfitting and overfitting.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare good vs bad fit</span></span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>bad_predictions <span class="ot">&lt;-</span> <span class="dv">70</span> <span class="sc">+</span> <span class="dv">2</span> <span class="sc">*</span> data<span class="sc">$</span>study_hours</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>good_predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, data)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>bad_sse <span class="ot">&lt;-</span> <span class="fu">sum</span>((data<span class="sc">$</span>exam_scores <span class="sc">-</span> bad_predictions)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a>good_sse <span class="ot">&lt;-</span> <span class="fu">sum</span>((data<span class="sc">$</span>exam_scores <span class="sc">-</span> good_predictions)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-8"><a href="#cb96-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> study_hours, <span class="at">y =</span> exam_scores)) <span class="sc">+</span></span>
<span id="cb96-9"><a href="#cb96-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb96-10"><a href="#cb96-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">70</span>, <span class="at">slope =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"red"</span>, </span>
<span id="cb96-11"><a href="#cb96-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb96-12"><a href="#cb96-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb96-13"><a href="#cb96-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">95</span>, </span>
<span id="cb96-14"><a href="#cb96-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Red Line: Total Error ="</span>, <span class="fu">round</span>(bad_sse)), </span>
<span id="cb96-15"><a href="#cb96-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb96-16"><a href="#cb96-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">90</span>, </span>
<span id="cb96-17"><a href="#cb96-17" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="fu">paste</span>(<span class="st">"Purple Line: Total Error ="</span>, <span class="fu">round</span>(good_sse)), </span>
<span id="cb96-18"><a href="#cb96-18" aria-hidden="true" tabindex="-1"></a>           <span class="at">color =</span> <span class="st">"purple"</span>) <span class="sc">+</span></span>
<span id="cb96-19"><a href="#cb96-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"Study Hours"</span>, <span class="at">y =</span> <span class="st">"Exam Scores"</span>,</span>
<span id="cb96-20"><a href="#cb96-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Comparing Total Prediction Errors"</span>) <span class="sc">+</span></span>
<span id="cb96-21"><a href="#cb96-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb96-22"><a href="#cb96-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="why-is-this-method-ordinary-least-squares" class="level3">
<h3 class="anchored" data-anchor-id="why-is-this-method-ordinary-least-squares">Why Is This Method “Ordinary Least Squares”?</h3>
<p>Let’s break down the name:</p>
<ul>
<li>“Squares”: We square the residuals</li>
<li>“Least”: We want the smallest possible total</li>
<li>“Ordinary”: This is the basic version (there are fancier versions!)</li>
</ul>
<p>The OLS line has some nice properties:</p>
<ol type="1">
<li>The mean of all residuals equals zero</li>
<li>The line always passes through the point (<span class="math inline">\bar{x}</span>, <span class="math inline">\bar{y}</span>) - the average study hours and average score</li>
<li>Small changes in the data lead to small changes in the line (it’s “stable”)</li>
<li>Our estimates <span class="math inline">\hat{\beta}_0</span> and <span class="math inline">\hat{\beta}_1</span> are the best possible estimates of the true parameters <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span></li>
</ol>
</section>
<section id="important-notes" class="level3">
<h3 class="anchored" data-anchor-id="important-notes">Important Notes</h3>
<ol type="1">
<li><p>The hat notation (<span class="math inline">\hat{\beta}_0</span>, <span class="math inline">\hat{\beta}_1</span>) reminds us that we’re estimating the true relationship from our sample. We never know the true <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span> - we can only estimate them from our data.</p></li>
<li><p>OLS gives us the best possible estimates when certain conditions are met (like having randomly sampled data and a truly linear relationship).</p></li>
</ol>
</section>
</div>
</div>
</section>
</section>
<section id="assessing-model-fit" class="level2" data-number="15.10">
<h2 data-number="15.10" class="anchored" data-anchor-id="assessing-model-fit"><span class="header-section-number">15.10</span> Assessing Model Fit</h2>
<section id="decomposition-of-variance" class="level3">
<h3 class="anchored" data-anchor-id="decomposition-of-variance">Decomposition of Variance</h3>
<p>The total variability in Y can be broken down into explained and unexplained components:</p>
<p><span class="math display">\underbrace{\sum_{i=1}^n (Y_i - \bar{Y})^2}_{SST} = \underbrace{\sum_{i=1}^n (\hat{Y}_i - \bar{Y})^2}_{SSR} + \underbrace{\sum_{i=1}^n (Y_i - \hat{Y}_i)^2}_{SSE}</span></p>
<p>where:</p>
<ul>
<li>SST (Total Sum of Squares): Total variation in Y</li>
<li>SSR (Regression Sum of Squares): Variation explained by regression</li>
<li>SSE (Error Sum of Squares): Unexplained variation</li>
</ul>
</section>
<section id="understanding-the-three-types-of-variation" class="level3">
<h3 class="anchored" data-anchor-id="understanding-the-three-types-of-variation">Understanding the Three Types of Variation</h3>
<ol type="1">
<li><strong>Total Variation (SST)</strong>
<ul>
<li>Question: “How much do observations vary from the mean?”</li>
<li>Formula: <span class="math inline">SST = \sum(y_i - \bar{y})^2</span></li>
<li>Intuition: The “spread” of our data around its average</li>
</ul></li>
<li><strong>Explained Variation (SSR)</strong>
<ul>
<li>Question: “How much of the variation did our model explain?”</li>
<li>Formula: <span class="math inline">SSR = \sum(\hat{y}_i - \bar{y})^2</span></li>
<li>Intuition: The improvement we gained by using X</li>
</ul></li>
<li><strong>Unexplained Variation (SSE)</strong>
<ul>
<li>Question: “What variation remains unexplained?”</li>
<li>Formula: <span class="math inline">SSE = \sum(y_i - \hat{y}_i)^2</span></li>
<li>Intuition: The errors that remain after using X</li>
</ul></li>
</ol>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Variance Decomposition in Linear Regression
</div>
</div>
<div class="callout-body-container callout-body">
<section id="why-it-matters-understanding-prediction-improvement-through-additional-variables" class="level3">
<h3 class="anchored" data-anchor-id="why-it-matters-understanding-prediction-improvement-through-additional-variables">Why It Matters: Understanding Prediction Improvement Through Additional Variables</h3>
<p>In statistical analysis and modeling, we frequently encounter situations where we must assess the value of incorporating additional predictor variables. Consider the domain of real estate valuation: While one could estimate property values using the market-wide average price, incorporating specific property characteristics, such as square footage, can substantially enhance prediction accuracy. <strong>Variance decomposition</strong> provides a rigorous framework for quantifying the incremental improvement in predictive accuracy when we incorporate such additional variables.</p>
</section>
<section id="the-analytical-process-from-baseline-to-enhanced-predictions" class="level3">
<h3 class="anchored" data-anchor-id="the-analytical-process-from-baseline-to-enhanced-predictions">The Analytical Process: From Baseline to Enhanced Predictions</h3>
<section id="initial-estimation-the-unconditional-mean" class="level4">
<h4 class="anchored" data-anchor-id="initial-estimation-the-unconditional-mean">Initial Estimation: The Unconditional Mean</h4>
<p>The analytical process begins with the simplest possible predictor: the mean of all observed values (<span class="math inline">\bar{y}</span>). This represents our initial estimation in the absence of any predictor variables. When we employ this method, we assign the same value—the overall mean—to each observation, resulting in what we term <strong>baseline deviations</strong>.</p>
</section>
<section id="enhanced-prediction-incorporating-predictor-variables" class="level4">
<h4 class="anchored" data-anchor-id="enhanced-prediction-incorporating-predictor-variables">Enhanced Prediction: Incorporating Predictor Variables</h4>
<p>By introducing predictor variables (denoted as <span class="math inline">X</span> in our figure), we refine our initial estimates. This enhancement enables us to generate distinct predictions for each observation, typically resulting in substantially reduced prediction errors, as illustrated in the figure below.</p>
</section>
</section>
<section id="components-of-statistical-variation" class="level3">
<h3 class="anchored" data-anchor-id="components-of-statistical-variation">Components of Statistical Variation</h3>
<p>Our figure illustrates three fundamental components of variation:</p>
<ol type="1">
<li><p><strong>Total Sum of Squares (SST)</strong></p>
<ul>
<li><strong>Statistical Inquiry:</strong> What is the aggregate deviation of observations from their mean?</li>
<li><strong>Mathematical Expression:</strong> <span class="math inline">SST = \sum(y_i - \bar{y})^2</span></li>
<li><strong>Graphical Representation:</strong> Depicted by the purple vertical lines in the figure</li>
<li><strong>Statistical Interpretation:</strong> Represents the total variability present in the observed data prior to any modeling</li>
</ul></li>
<li><p><strong>Regression Sum of Squares (SSR)</strong></p>
<ul>
<li><strong>Statistical Inquiry:</strong> What proportion of variation does our model successfully capture?</li>
<li><strong>Mathematical Expression:</strong> <span class="math inline">SSR = \sum(\hat{y}_i - \bar{y})^2</span></li>
<li><strong>Graphical Representation:</strong> Illustrated by the green dashed lines in the figure</li>
<li><strong>Statistical Interpretation:</strong> Quantifies the reduction in uncertainty achieved through the incorporation of predictor variables</li>
</ul></li>
<li><p><strong>Error Sum of Squares (SSE)</strong></p>
<ul>
<li><strong>Statistical Inquiry:</strong> What residual variation persists after model implementation?</li>
<li><strong>Mathematical Expression:</strong> <span class="math inline">SSE = \sum(y_i - \hat{y}_i)^2</span></li>
<li><strong>Graphical Representation:</strong> Shown by the orange dashed lines in the figure</li>
<li><strong>Statistical Interpretation:</strong> Represents the remaining unexplained variation after accounting for all predictor variables</li>
</ul></li>
</ol>
<p>This decomposition provides a formal framework for assessing the effectiveness of our predictive model and the value of including additional variables.</p>
<section id="visualizing-variance-decomposition" class="level4">
<h4 class="anchored" data-anchor-id="visualizing-variance-decomposition">Visualizing Variance Decomposition</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with clearer pattern</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="at">length.out =</span> <span class="dv">50</span>)</span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">sd =</span> <span class="fl">0.8</span>)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-11"><a href="#cb98-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Model and calculations</span></span>
<span id="cb98-12"><a href="#cb98-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, data)</span>
<span id="cb98-13"><a href="#cb98-13" aria-hidden="true" tabindex="-1"></a>mean_y <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb98-14"><a href="#cb98-14" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model)</span>
<span id="cb98-15"><a href="#cb98-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-16"><a href="#cb98-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Select specific points for demonstration that are well-spaced</span></span>
<span id="cb98-17"><a href="#cb98-17" aria-hidden="true" tabindex="-1"></a>demonstration_points <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">25</span>, <span class="dv">42</span>)  <span class="co"># Changed points for better spacing</span></span>
<span id="cb98-18"><a href="#cb98-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-19"><a href="#cb98-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Create main plot with improved aesthetics</span></span>
<span id="cb98-20"><a href="#cb98-20" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb98-21"><a href="#cb98-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add background grid for better readability</span></span>
<span id="cb98-22"><a href="#cb98-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">8</span>, <span class="at">by =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-23"><a href="#cb98-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">10</span>, <span class="at">by =</span> <span class="fl">0.5</span>), <span class="at">color =</span> <span class="st">"gray90"</span>, <span class="at">linewidth =</span> <span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-24"><a href="#cb98-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-25"><a href="#cb98-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add regression line and mean line</span></span>
<span id="cb98-26"><a href="#cb98-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"#E41A1C"</span>, <span class="at">linewidth =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb98-27"><a href="#cb98-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> mean_y, <span class="at">linetype =</span> <span class="st">"longdash"</span>, <span class="at">color =</span> <span class="st">"#377EB8"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb98-28"><a href="#cb98-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-29"><a href="#cb98-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add data points</span></span>
<span id="cb98-30"><a href="#cb98-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>, <span class="at">color =</span> <span class="st">"#4A4A4A"</span>) <span class="sc">+</span></span>
<span id="cb98-31"><a href="#cb98-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-32"><a href="#cb98-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add decomposition segments with improved colors and positioning</span></span>
<span id="cb98-33"><a href="#cb98-33" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Total deviation (purple)</span></span>
<span id="cb98-34"><a href="#cb98-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data[demonstration_points,],</span>
<span id="cb98-35"><a href="#cb98-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x, <span class="at">y =</span> y, <span class="at">yend =</span> mean_y),</span>
<span id="cb98-36"><a href="#cb98-36" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#984EA3"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="fl">1.8</span>) <span class="sc">+</span></span>
<span id="cb98-37"><a href="#cb98-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Explained component (green)</span></span>
<span id="cb98-38"><a href="#cb98-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data[demonstration_points,],</span>
<span id="cb98-39"><a href="#cb98-39" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x, <span class="at">y =</span> mean_y, <span class="at">yend =</span> predicted),</span>
<span id="cb98-40"><a href="#cb98-40" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#4DAF4A"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb98-41"><a href="#cb98-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Unexplained component (orange)</span></span>
<span id="cb98-42"><a href="#cb98-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data =</span> data[demonstration_points,],</span>
<span id="cb98-43"><a href="#cb98-43" aria-hidden="true" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">xend =</span> x, <span class="at">y =</span> predicted, <span class="at">yend =</span> y),</span>
<span id="cb98-44"><a href="#cb98-44" aria-hidden="true" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">"#FF7F00"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb98-45"><a href="#cb98-45" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-46"><a href="#cb98-46" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add annotations for better understanding</span></span>
<span id="cb98-47"><a href="#cb98-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> data<span class="sc">$</span>x[demonstration_points[<span class="dv">2</span>]], <span class="at">y =</span> mean_y <span class="sc">-</span> <span class="fl">0.2</span>,</span>
<span id="cb98-48"><a href="#cb98-48" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Mean"</span>, <span class="at">color =</span> <span class="st">"#377EB8"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-49"><a href="#cb98-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> data<span class="sc">$</span>x[demonstration_points[<span class="dv">2</span>]], </span>
<span id="cb98-50"><a href="#cb98-50" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> data<span class="sc">$</span>predicted[demonstration_points[<span class="dv">2</span>]] <span class="sc">+</span> <span class="fl">0.2</span>,</span>
<span id="cb98-51"><a href="#cb98-51" aria-hidden="true" tabindex="-1"></a>           <span class="at">label =</span> <span class="st">"Regression Line"</span>, <span class="at">color =</span> <span class="st">"#E41A1C"</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb98-52"><a href="#cb98-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb98-53"><a href="#cb98-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Improve theme and labels</span></span>
<span id="cb98-54"><a href="#cb98-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb98-55"><a href="#cb98-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb98-56"><a href="#cb98-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb98-57"><a href="#cb98-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb98-58"><a href="#cb98-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb98-59"><a href="#cb98-59" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span></span>
<span id="cb98-60"><a href="#cb98-60" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-61"><a href="#cb98-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb98-62"><a href="#cb98-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Variance Decomposition in Linear Regression"</span>,</span>
<span id="cb98-63"><a href="#cb98-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Decomposing total variance into explained and unexplained components"</span>,</span>
<span id="cb98-64"><a href="#cb98-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predictor (X)"</span>,</span>
<span id="cb98-65"><a href="#cb98-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Response (Y)"</span></span>
<span id="cb98-66"><a href="#cb98-66" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-67"><a href="#cb98-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-68"><a href="#cb98-68" aria-hidden="true" tabindex="-1"></a><span class="co"># Create error distribution plot with improved aesthetics</span></span>
<span id="cb98-69"><a href="#cb98-69" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>mean_error <span class="ot">&lt;-</span> y <span class="sc">-</span> mean_y</span>
<span id="cb98-70"><a href="#cb98-70" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>regression_error <span class="ot">&lt;-</span> y <span class="sc">-</span> data<span class="sc">$</span>predicted</span>
<span id="cb98-71"><a href="#cb98-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-72"><a href="#cb98-72" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data) <span class="sc">+</span></span>
<span id="cb98-73"><a href="#cb98-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> mean_error, <span class="at">fill =</span> <span class="st">"Deviation from Mean"</span>), </span>
<span id="cb98-74"><a href="#cb98-74" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb98-75"><a href="#cb98-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="fu">aes</span>(<span class="at">x =</span> regression_error, <span class="at">fill =</span> <span class="st">"Regression Residuals"</span>), </span>
<span id="cb98-76"><a href="#cb98-76" aria-hidden="true" tabindex="-1"></a>               <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb98-77"><a href="#cb98-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>(<span class="at">base_size =</span> <span class="dv">14</span>) <span class="sc">+</span></span>
<span id="cb98-78"><a href="#cb98-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb98-79"><a href="#cb98-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb98-80"><a href="#cb98-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_blank</span>()</span>
<span id="cb98-81"><a href="#cb98-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-82"><a href="#cb98-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb98-83"><a href="#cb98-83" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Error Distribution Comparison"</span>,</span>
<span id="cb98-84"><a href="#cb98-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Error Magnitude"</span>,</span>
<span id="cb98-85"><a href="#cb98-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Density"</span></span>
<span id="cb98-86"><a href="#cb98-86" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-87"><a href="#cb98-87" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(</span>
<span id="cb98-88"><a href="#cb98-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#377EB8"</span>, <span class="st">"#E41A1C"</span>)</span>
<span id="cb98-89"><a href="#cb98-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-90"><a href="#cb98-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-91"><a href="#cb98-91" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend explaining the decomposition components</span></span>
<span id="cb98-92"><a href="#cb98-92" aria-hidden="true" tabindex="-1"></a>legend_plot <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb98-93"><a href="#cb98-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb98-94"><a href="#cb98-94" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb98-95"><a href="#cb98-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb98-96"><a href="#cb98-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.box =</span> <span class="st">"horizontal"</span></span>
<span id="cb98-97"><a href="#cb98-97" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb98-98"><a href="#cb98-98" aria-hidden="true" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">"text"</span>, <span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> <span class="dv">0</span>, <span class="at">label =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb98-99"><a href="#cb98-99" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(</span>
<span id="cb98-100"><a href="#cb98-100" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="st">"Variance Components"</span>,</span>
<span id="cb98-101"><a href="#cb98-101" aria-hidden="true" tabindex="-1"></a>    <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"#984EA3"</span>, <span class="st">"#4DAF4A"</span>, <span class="st">"#FF7F00"</span>),</span>
<span id="cb98-102"><a href="#cb98-102" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Total Deviation"</span>, <span class="st">"Explained Variance"</span>, <span class="st">"Unexplained Variance"</span>)</span>
<span id="cb98-103"><a href="#cb98-103" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb98-104"><a href="#cb98-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-105"><a href="#cb98-105" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine plots with adjusted heights</span></span>
<span id="cb98-106"><a href="#cb98-106" aria-hidden="true" tabindex="-1"></a>combined_plot <span class="ot">&lt;-</span> (p1 <span class="sc">/</span> p2) <span class="sc">+</span></span>
<span id="cb98-107"><a href="#cb98-107" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">heights =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>))</span>
<span id="cb98-108"><a href="#cb98-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-109"><a href="#cb98-109" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the combined plot</span></span>
<span id="cb98-110"><a href="#cb98-110" aria-hidden="true" tabindex="-1"></a>combined_plot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="what-is-r²" class="level3">
<h3 class="anchored" data-anchor-id="what-is-r²">What is R²?</h3>
<p><span class="math inline">R^2 = \frac{SSR}{SST} = 1 - \frac{SSE}{SST}</span></p>
<p>Think of <span class="math inline">R^2</span> as answering: “What percentage of the original variation in the data can we explain using our model?”</p>
<section id="examples-of-r2-values" class="level4">
<h4 class="anchored" data-anchor-id="examples-of-r2-values">Examples of <span class="math inline">R^2</span> Values:</h4>
<ul>
<li><span class="math inline">R^2 = 0.80</span>: Our model explains 80% of the variation in house prices.</li>
<li><span class="math inline">R^2 = 0.25</span>: Our model explains 25% of the variation (a weaker model).</li>
<li><span class="math inline">R^2 = 0.00</span>: Our model explains none of the variation (not helpful).</li>
</ul>
</section>
</section>
<section id="important-things-to-remember-about-r²" class="level3">
<h3 class="anchored" data-anchor-id="important-things-to-remember-about-r²">Important Things to Remember About R²</h3>
<ol type="1">
<li><strong>High</strong> <span class="math inline">R^2</span> Isn’t Always Good
<ul>
<li>A very high <span class="math inline">R^2</span> could suggest <strong>overfitting</strong>. Your model might be too complex, capturing noise rather than real patterns.</li>
<li>Always <strong>interpret</strong> <span class="math inline">R^2</span> in the context of your data.</li>
</ul></li>
<li><strong>Low</strong> <span class="math inline">R^2</span> Isn’t Always Bad
<ul>
<li>In some fields (like social sciences), a low <span class="math inline">R^2</span> can still be useful.</li>
<li>Focus on <strong>practical significance</strong>, not just the <span class="math inline">R^2</span> value.</li>
</ul></li>
<li><strong>Consider Sample Size</strong>
<ul>
<li>For multiple regression models, use <strong>adjusted</strong> <span class="math inline">R^2</span> to account for the number of predictors.</li>
<li>Formula: <span class="math inline">R^2_{adj} = 1 - \frac{SSE/(n-p)}{SST/(n-1)}</span></li>
</ul></li>
</ol>
</section>
<section id="tips-for-effective-analysis" class="level3">
<h3 class="anchored" data-anchor-id="tips-for-effective-analysis">Tips for Effective Analysis</h3>
<ol type="1">
<li><strong>Visualize the Data</strong>
<ul>
<li>Plot your data and residuals to spot patterns.</li>
<li><strong>Check for influential points</strong> that could skew your results.</li>
</ul></li>
<li><strong>Understand Your Field’s Context</strong>
<ul>
<li>What’s considered a good <span class="math inline">R^2</span> value in your field?</li>
<li>What’s the <strong>practical impact</strong> of the errors you’re seeing?</li>
</ul></li>
<li><strong>Run Diagnostics</strong>
<ul>
<li>Check residuals for normality.</li>
<li>Look for <strong>heteroscedasticity</strong> (changing variability of errors).</li>
<li>Watch for <strong>influential data points</strong> that affect the model’s accuracy.</li>
</ul></li>
</ol>
</section>
</div>
</div>
</section>
<section id="r²-demystified" class="level3">
<h3 class="anchored" data-anchor-id="r²-demystified">R² Demystified</h3>
<p><span class="math display">R^2 = \frac{SSR}{SST} = 1 - \frac{SSE}{SST}</span></p>
<p>Think of R² as answering the question: “What percentage of the original variation in Y can we explain using X?”</p>
<section id="intuitive-examples" class="level4">
<h4 class="anchored" data-anchor-id="intuitive-examples">Intuitive Examples:</h4>
<ul>
<li>R² = 0.80: Using X eliminated 80% of our prediction errors</li>
<li>R² = 0.25: Using X eliminated 25% of our prediction errors</li>
<li>R² = 0.00: Using X didn’t help at all</li>
</ul>
</section>
</section>
<section id="when-to-be-cautious" class="level3">
<h3 class="anchored" data-anchor-id="when-to-be-cautious">When to Be Cautious</h3>
<ol type="1">
<li><strong>High R² Isn’t Everything</strong>
<ul>
<li>A high R² might indicate overfitting</li>
<li>Always check if your model makes practical sense</li>
<li>Consider the context of your field</li>
</ul></li>
<li><strong>Low R² Isn’t Always Bad</strong>
<ul>
<li>In some fields, R² = 0.30 might be impressive</li>
<li>Social sciences often have lower R² values</li>
<li>Focus on practical significance</li>
</ul></li>
</ol>
</section>
<section id="practical-tips-for-analysis" class="level3">
<h3 class="anchored" data-anchor-id="practical-tips-for-analysis">Practical Tips for Analysis</h3>
<ol type="1">
<li><strong>Visual Inspection</strong>
<ul>
<li>Always plot your data</li>
<li>Look for patterns in residuals</li>
<li>Check for influential points</li>
</ul></li>
<li><strong>Context Consideration</strong>
<ul>
<li>What’s a “good” R² in your field?</li>
<li>What’s the practical impact of your errors?</li>
<li>Are your predictors meaningful?</li>
</ul></li>
<li><strong>Model Diagnostics</strong>
<ul>
<li>Check residual normality</li>
<li>Look for heteroscedasticity</li>
<li>Examine influential points</li>
</ul></li>
</ol>
</section>
<section id="key-takeaways" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways">Key Takeaways</h3>
<ol type="1">
<li>Variance decomposition helps us understand prediction improvement</li>
<li>R² quantifies the proportion of variance explained</li>
<li>Visual understanding is crucial for interpretation</li>
<li>Context matters more than absolute R² values</li>
<li>Always combine R² with other diagnostic tools</li>
</ol>
</section>
<section id="measures-of-fit" class="level3">
<h3 class="anchored" data-anchor-id="measures-of-fit">Measures of Fit</h3>
<ol type="1">
<li><p><strong>R-squared (</strong><span class="math inline">R^2</span>): <span class="math display">R^2 = \frac{SSR}{SST} = 1 - \frac{SSE}{SST}</span></p></li>
<li><p><strong>Root Mean Square Error (RMSE)</strong>: <span class="math display">RMSE = \sqrt{\frac{SSE}{n}}</span></p></li>
<li><p><strong>Mean Absolute Error (MAE)</strong>: <span class="math display">MAE = \frac{1}{n}\sum_{i=1}^n |Y_i - \hat{Y}_i|</span></p></li>
</ol>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Formal Derivation of OLS Estimators: Step-by-Step Approach
</div>
</div>
<div class="callout-body-container callout-body">
<section id="initial-setup" class="level3">
<h3 class="anchored" data-anchor-id="initial-setup">Initial Setup</h3>
<p>We seek to minimize the sum of squared residuals (errors):</p>
<p><span class="math inline">SSE = \sum_{i=1}^n (y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></p>
<p>Let’s break this into manageable pieces:</p>
<ol type="1">
<li>Each residual is: <span class="math inline">e_i = y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i)</span></li>
<li>We square each residual: <span class="math inline">e_i^2 = (y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></li>
<li>Sum them all: <span class="math inline">SSE = \sum_{i=1}^n e_i^2</span></li>
</ol>
</section>
<section id="chain-rule-review" class="level3">
<h3 class="anchored" data-anchor-id="chain-rule-review">Chain Rule Review</h3>
<p>Before proceeding, let’s recall the chain rule. For a composite function <span class="math inline">f(g(x))</span>:</p>
<p><span class="math inline">\frac{d}{dx}[f(g(x))] = f'(g(x)) \cdot g'(x)</span></p>
<p>In our case, we’re dealing with the square function <span class="math inline">f(u) = u^2</span>, where:</p>
<ul>
<li><span class="math inline">f'(u) = 2u</span></li>
<li><span class="math inline">u = y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i)</span></li>
</ul>
</section>
<section id="step-1-finding-hatbeta_0-using-first-derivative" class="level3">
<h3 class="anchored" data-anchor-id="step-1-finding-hatbeta_0-using-first-derivative">Step 1: Finding <span class="math inline">\hat{\beta}_0</span> Using First Derivative</h3>
<p>Let’s take the partial derivative with respect to <span class="math inline">\hat{\beta}_0</span> step by step:</p>
<ol type="1">
<li><p>Start with one term of the sum:</p>
<p><span class="math inline">\frac{\partial}{\partial \hat{\beta}_0}(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></p></li>
<li><p>Apply chain rule:</p>
<ul>
<li>Outer function: <span class="math inline">f(u) = u^2</span>, so <span class="math inline">f'(u) = 2u</span></li>
<li>Inner function: <span class="math inline">g(\hat{\beta}_0) = y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i)</span></li>
<li>Inner derivative: <span class="math inline">g'(\hat{\beta}_0) = -1</span></li>
</ul></li>
<li><p>Therefore, for each term: <span class="math inline">\frac{\partial}{\partial \hat{\beta}_0}(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2 = 2(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))(-1)</span></p></li>
<li><p>Now sum all terms and set to zero: <span class="math inline">\sum_{i=1}^n 2(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))(-1) = 0</span></p></li>
<li><p>Simplify: <span class="math inline">-2\sum_{i=1}^n (y_i - \hat{\beta}_0 - \hat{\beta}_1x_i) = 0</span></p></li>
<li><p>Remove the -2: <span class="math inline">\sum_{i=1}^n (y_i - \hat{\beta}_0 - \hat{\beta}_1x_i) = 0</span></p></li>
<li><p>Expand the sum: <span class="math inline">\sum_{i=1}^n y_i - n\hat{\beta}_0 - \hat{\beta}_1\sum_{i=1}^n x_i = 0</span></p></li>
<li><p>Solve for <span class="math inline">\hat{\beta}_0</span>: <span class="math inline">n\hat{\beta}_0 = \sum_{i=1}^n y_i - \hat{\beta}_1\sum_{i=1}^n x_i</span></p>
<p><span class="math inline">\hat{\beta}_0 = \frac{\sum_{i=1}^n y_i}{n} - \hat{\beta}_1\frac{\sum_{i=1}^n x_i}{n}</span></p>
<p><span class="math inline">\hat{\beta}_0 = \bar{y} - \hat{\beta}_1\bar{x}</span></p></li>
</ol>
</section>
<section id="step-2-finding-hatbeta_1-using-first-derivative" class="level3">
<h3 class="anchored" data-anchor-id="step-2-finding-hatbeta_1-using-first-derivative">Step 2: Finding <span class="math inline">\hat{\beta}_1</span> Using First Derivative</h3>
<p>Now let’s find <span class="math inline">\hat{\beta}_1</span> with the same careful approach:</p>
<ol type="1">
<li><p>For one term: <span class="math inline">\frac{\partial}{\partial \hat{\beta}_1}(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2</span></p></li>
<li><p>Apply chain rule:</p>
<ul>
<li>Outer function: <span class="math inline">f(u) = u^2</span>, so <span class="math inline">f'(u) = 2u</span></li>
<li>Inner function: <span class="math inline">g(\hat{\beta}_1) = y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i)</span></li>
<li>Inner derivative: <span class="math inline">g'(\hat{\beta}_1) = -x_i</span></li>
</ul></li>
<li><p>Therefore: <span class="math inline">\frac{\partial}{\partial \hat{\beta}_1}(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))^2 = 2(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))(-x_i)</span></p></li>
<li><p>Sum all terms and set to zero: <span class="math inline">\sum_{i=1}^n 2(y_i - (\hat{\beta}_0 + \hat{\beta}_1x_i))(-x_i) = 0</span></p></li>
<li><p>Simplify: <span class="math inline">-2\sum_{i=1}^n x_i(y_i - \hat{\beta}_0 - \hat{\beta}_1x_i) = 0</span></p></li>
<li><p>Substitute <span class="math inline">\hat{\beta}_0 = \bar{y} - \hat{\beta}_1\bar{x}</span>: <span class="math inline">-2\sum_{i=1}^n x_i(y_i - (\bar{y} - \hat{\beta}_1\bar{x}) - \hat{\beta}_1x_i) = 0</span></p></li>
<li><p>Expand: <span class="math inline">-2\sum_{i=1}^n x_i(y_i - \bar{y} + \hat{\beta}_1\bar{x} - \hat{\beta}_1x_i) = 0</span></p></li>
<li><p>Distribute <span class="math inline">x_i</span>: <span class="math inline">-2\sum_{i=1}^n (x_iy_i - x_i\bar{y} + x_i\hat{\beta}_1\bar{x} - x_i^2\hat{\beta}_1) = 0</span></p></li>
<li><p>Collect terms with <span class="math inline">\hat{\beta}_1</span>: <span class="math inline">\sum_{i=1}^n (x_i^2\hat{\beta}_1 - x_i\hat{\beta}_1\bar{x}) = \sum_{i=1}^n (x_iy_i - x_i\bar{y})</span></p></li>
<li><p>Factor out <span class="math inline">\hat{\beta}_1</span>: <span class="math inline">\hat{\beta}_1\sum_{i=1}^n (x_i^2 - x_i\bar{x}) = \sum_{i=1}^n (x_iy_i - x_i\bar{y})</span></p></li>
<li><p>Final form: <span class="math inline">\hat{\beta}_1 = \frac{\sum_{i=1}^n (x_i - \bar{x})(y_i - \bar{y})}{\sum_{i=1}^n (x_i - \bar{x})^2}</span></p></li>
</ol>
</section>
<section id="step-3-verifying-we-have-a-minimum" class="level3">
<h3 class="anchored" data-anchor-id="step-3-verifying-we-have-a-minimum">Step 3: Verifying We Have a Minimum</h3>
<p>To confirm these critical points are minima, we check the second derivatives:</p>
<ol type="1">
<li><p>Second derivative with respect to <span class="math inline">\hat{\beta}_0</span>: <span class="math inline">\frac{\partial^2 SSE}{\partial \hat{\beta}_0^2} = \frac{\partial}{\partial \hat{\beta}_0}(-2\sum_{i=1}^n (y_i - \hat{\beta}_0 - \hat{\beta}_1x_i)) = 2n &gt; 0</span></p></li>
<li><p>Second derivative with respect to <span class="math inline">\hat{\beta}_1</span>: <span class="math inline">\frac{\partial^2 SSE}{\partial \hat{\beta}_1^2} = \frac{\partial}{\partial \hat{\beta}_1}(-2\sum_{i=1}^n x_i(y_i - \hat{\beta}_0 - \hat{\beta}_1x_i)) = 2\sum_{i=1}^n x_i^2 &gt; 0</span></p></li>
<li><p>Cross partial derivatives: <span class="math inline">\frac{\partial^2 SSE}{\partial \hat{\beta}_0\partial \hat{\beta}_1} = \frac{\partial^2 SSE}{\partial \hat{\beta}_1\partial \hat{\beta}_0} = 2\sum_{i=1}^n x_i</span></p></li>
<li><p>The Hessian matrix is positive definite: <span class="math inline">\mathbf{H} = \begin{bmatrix} 2n &amp; 2\sum x_i \\ 2\sum x_i &amp; 2\sum x_i^2 \end{bmatrix}</span></p></li>
</ol>
<p>This confirms we have found a minimum.</p>
</section>
<section id="visualizing-the-process" class="level3">
<h3 class="anchored" data-anchor-id="visualizing-the-process">Visualizing the Process</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sample data</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">runif</span>(<span class="dv">20</span>, <span class="dv">1</span>, <span class="dv">8</span>)</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span> <span class="sc">*</span> x <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate means</span></span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>x_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(x)</span>
<span id="cb100-11"><a href="#cb100-11" aria-hidden="true" tabindex="-1"></a>y_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(y)</span>
<span id="cb100-12"><a href="#cb100-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-13"><a href="#cb100-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb100-14"><a href="#cb100-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb100-15"><a href="#cb100-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb100-16"><a href="#cb100-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb100-17"><a href="#cb100-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> y_mean, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb100-18"><a href="#cb100-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> x_mean, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"gray"</span>) <span class="sc">+</span></span>
<span id="cb100-19"><a href="#cb100-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">xend =</span> x, <span class="at">yend =</span> y_mean), <span class="at">color =</span> <span class="st">"green"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb100-20"><a href="#cb100-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">yend =</span> y, <span class="at">xend =</span> x_mean), <span class="at">color =</span> <span class="st">"purple"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb100-21"><a href="#cb100-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Understanding the OLS Derivation"</span>,</span>
<span id="cb100-22"><a href="#cb100-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Green: y deviations, Purple: x deviations</span><span class="sc">\n</span><span class="st">Their product forms the numerator of β̂₁"</span>,</span>
<span id="cb100-23"><a href="#cb100-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">y =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb100-24"><a href="#cb100-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="key-insights" class="level3">
<h3 class="anchored" data-anchor-id="key-insights">Key Insights</h3>
<ol type="1">
<li>The chain rule is crucial in deriving both estimators</li>
<li><span class="math inline">\hat{\beta}_0</span> ensures the line goes through <span class="math inline">(\bar{x}, \bar{y})</span></li>
<li><span class="math inline">\hat{\beta}_1</span> is a ratio of covariance to variance</li>
<li>The second derivatives confirm we’ve found a minimum</li>
<li>The entire process relies on calculus to find the optimal values that minimize the sum of squared residuals</li>
</ol>
</section>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Endogeneity in Regression
</div>
</div>
<div class="callout-body-container callout-body">
<p>Endogeneity is a critical concept in statistical analysis that occurs when an explanatory variable in a regression model is correlated with the error term. This creates challenges for accurately understanding cause-and-effect relationships in research. Let’s examine the three main types of endogeneity and how they affect research outcomes.</p>
<section id="omitted-variable-bias-ovb" class="level3">
<h3 class="anchored" data-anchor-id="omitted-variable-bias-ovb">Omitted Variable Bias (OVB)</h3>
<p>Omitted Variable Bias occurs when an important variable that affects both the dependent and independent variables is left out of the analysis. This omission leads to incorrect conclusions about the relationship between the variables we’re studying.</p>
<p>Consider a study examining the relationship between education and income:</p>
<p><strong>Example: Education and Income</strong> The observed relationship shows that more education correlates with higher income. However, an individual’s inherent abilities affect both their educational attainment and their earning potential. Without accounting for ability, we may overestimate education’s direct effect on income.</p>
<p>The statistical representation shows why this matters:</p>
<p><span class="math inline">y_i = \beta_0 + \beta_1x_i + \beta_2z_i + \epsilon_i</span> (Complete model)</p>
<p><span class="math inline">y_i = \beta_0 + \beta_1x_i + u_i</span> (Incomplete model)</p>
<p>When we omit an important variable, our estimates of the remaining relationships become biased and unreliable.</p>
</section>
<section id="simultaneity" class="level3">
<h3 class="anchored" data-anchor-id="simultaneity">Simultaneity</h3>
<p>Simultaneity occurs when two variables simultaneously influence each other, making it difficult to determine the direction of causation. This creates a feedback loop that complicates statistical analysis.</p>
<p><strong>Common Examples of Simultaneity:</strong></p>
<p>Academic Performance and Study Habits represent a clear case of simultaneity. Academic performance influences how much time students dedicate to studying, while study time affects academic performance. This two-way relationship makes it challenging to measure the isolated effect of either variable.</p>
<p>Market Dynamics provide another example. Prices influence demand, while demand influences prices. This concurrent relationship requires special analytical approaches to understand the true relationships.</p>
</section>
<section id="measurement-error-1" class="level3">
<h3 class="anchored" data-anchor-id="measurement-error-1">Measurement Error</h3>
<p>Measurement error occurs when we cannot accurately measure our variables of interest. This imprecision can significantly impact our analysis and conclusions.</p>
<p><strong>Common Sources of Measurement Error:</strong></p>
<p>Self-Reported Data presents a significant challenge. When participants report their own behaviors or characteristics, such as study time, the reported values often differ from actual values. This discrepancy affects our ability to measure true relationships.</p>
<p>Technical Limitations also contribute to measurement error through imprecise measuring tools, inconsistent measurement conditions, and recording or data entry errors.</p>
</section>
<section id="addressing-endogeneity-in-research" class="level3">
<h3 class="anchored" data-anchor-id="addressing-endogeneity-in-research">Addressing Endogeneity in Research</h3>
<section id="identification-strategies" class="level4">
<h4 class="anchored" data-anchor-id="identification-strategies">Identification Strategies</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example of controlling for omitted variables</span></span>
<span id="cb101-2"><a href="#cb101-2" aria-hidden="true" tabindex="-1"></a>model_simple <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> education, <span class="at">data =</span> df)</span>
<span id="cb101-3"><a href="#cb101-3" aria-hidden="true" tabindex="-1"></a>model_full <span class="ot">&lt;-</span> <span class="fu">lm</span>(income <span class="sc">~</span> education <span class="sc">+</span> ability <span class="sc">+</span> experience <span class="sc">+</span> region, <span class="at">data =</span> df)</span>
<span id="cb101-4"><a href="#cb101-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb101-5"><a href="#cb101-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare coefficients</span></span>
<span id="cb101-6"><a href="#cb101-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_simple)</span>
<span id="cb101-7"><a href="#cb101-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_full)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ol type="1">
<li><p>Include Additional Variables: Collect data on potentially important omitted variables and include relevant control variables in your analysis. For example, including measures of ability when studying education’s effect on income.</p></li>
<li><p>Use Panel Data: Collect data across multiple time periods to control for unobserved fixed characteristics and analyze changes over time.</p></li>
<li><p>Instrumental Variables: Find variables that affect your independent variable but not your dependent variable to isolate the relationship of interest.</p></li>
</ol>
</section>
<section id="improving-measurement" class="level4">
<h4 class="anchored" data-anchor-id="improving-measurement">Improving Measurement</h4>
<ol type="1">
<li><p>Multiple Measurements: Take several measurements of key variables, use averaging to reduce random error, and compare different measurement methods.</p></li>
<li><p>Better Data Collection: Use validated measurement instruments, implement quality control procedures, and document potential sources of error.</p></li>
</ol>
</section>
</section>
<section id="best-practices-for-researchers" class="level3">
<h3 class="anchored" data-anchor-id="best-practices-for-researchers">Best Practices for Researchers</h3>
<p>Research Design fundamentally shapes your ability to address endogeneity. Plan for potential endogeneity issues before collecting data, include measures for potentially important control variables, and consider using multiple measurement approaches.</p>
<p>Analysis should include testing for endogeneity when possible, using appropriate statistical methods for your specific situation, and documenting assumptions and limitations.</p>
<p>Reporting must clearly describe potential endogeneity concerns, explain how you addressed these issues, and discuss implications for your conclusions.</p>
</section>
</div>
</div>
</section>
</section>
<section id="multiple-regression" class="level2" data-number="15.11">
<h2 data-number="15.11" class="anchored" data-anchor-id="multiple-regression"><span class="header-section-number">15.11</span> Multiple Regression (*)</h2>
<section id="extending-to-multiple-predictors" class="level3">
<h3 class="anchored" data-anchor-id="extending-to-multiple-predictors">Extending to Multiple Predictors</h3>
<p>The multiple regression model extends our simple model to include several predictors:</p>
<p>Population Model: <span class="math display">Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + ... + \beta_kX_k + \varepsilon</span></p>
<p>Sample Estimation: <span class="math display">\hat{Y} = \hat{\beta}_0 + \hat{\beta}_1X_1 + \hat{\beta}_2X_2 + ... + \hat{\beta}_kX_k</span></p>
<p>Let’s create an example with multiple predictors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate sample data with two predictors</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">105</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>X1 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>X2 <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">5</span>)</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>Y <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>X1 <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>X2 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>data_multiple <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> Y, <span class="at">X1 =</span> X1, <span class="at">X2 =</span> X2)</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit multiple regression model</span></span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>model_multiple <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">data =</span> data_multiple)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create 3D visualization using scatter plots</span></span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_multiple, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Y vs X1"</span>)</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_multiple, <span class="fu">aes</span>(<span class="at">x =</span> X2, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Y vs X2"</span>)</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/multiple-regression-example-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Multiple Regression Example</figcaption>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary</span></span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_multiple)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Y ~ X1 + X2, data = data_multiple)

Residuals:
     Min       1Q   Median       3Q      Max 
-10.8598  -3.6005   0.1166   3.0892  14.6102 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 11.77567    4.01351   2.934  0.00418 ** 
X1           0.45849    0.05992   7.651 1.47e-11 ***
X2           0.81639    0.11370   7.180 1.42e-10 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 5.122 on 97 degrees of freedom
Multiple R-squared:  0.5062,    Adjusted R-squared:  0.4961 
F-statistic: 49.72 on 2 and 97 DF,  p-value: 1.367e-15</code></pre>
</div>
</div>
</section>
<section id="interpretation-of-coefficients" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-coefficients">Interpretation of Coefficients</h3>
<p>In multiple regression, each <span class="math inline">\hat{\beta}_k</span> represents the expected change in Y for a one-unit increase in <span class="math inline">X_k</span>, holding all other variables constant.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction grid for X1 (holding X2 at its mean)</span></span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>X1_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(X1), <span class="fu">max</span>(X1), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>pred_data_X1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1_grid,</span>
<span id="cb106-5"><a href="#cb106-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> <span class="fu">mean</span>(X2)</span>
<span id="cb106-6"><a href="#cb106-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-7"><a href="#cb106-7" aria-hidden="true" tabindex="-1"></a>pred_data_X1<span class="sc">$</span>Y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_multiple, <span class="at">newdata =</span> pred_data_X1)</span>
<span id="cb106-8"><a href="#cb106-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-9"><a href="#cb106-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction grid for X2 (holding X1 at its mean)</span></span>
<span id="cb106-10"><a href="#cb106-10" aria-hidden="true" tabindex="-1"></a>X2_grid <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(X2), <span class="fu">max</span>(X2), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb106-11"><a href="#cb106-11" aria-hidden="true" tabindex="-1"></a>pred_data_X2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb106-12"><a href="#cb106-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">mean</span>(X1),</span>
<span id="cb106-13"><a href="#cb106-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2_grid</span>
<span id="cb106-14"><a href="#cb106-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-15"><a href="#cb106-15" aria-hidden="true" tabindex="-1"></a>pred_data_X2<span class="sc">$</span>Y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_multiple, <span class="at">newdata =</span> pred_data_X2)</span>
<span id="cb106-16"><a href="#cb106-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-17"><a href="#cb106-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot partial effects</span></span>
<span id="cb106-18"><a href="#cb106-18" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-19"><a href="#cb106-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_multiple, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb106-20"><a href="#cb106-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data_X1, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> Y_pred), </span>
<span id="cb106-21"><a href="#cb106-21" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-22"><a href="#cb106-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb106-23"><a href="#cb106-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Partial Effect of X1"</span>,</span>
<span id="cb106-24"><a href="#cb106-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"(X2 held at mean ="</span>, <span class="fu">round</span>(<span class="fu">mean</span>(X2), <span class="dv">2</span>), <span class="st">")"</span>))</span>
<span id="cb106-25"><a href="#cb106-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-26"><a href="#cb106-26" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-27"><a href="#cb106-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_multiple, <span class="fu">aes</span>(<span class="at">x =</span> X2, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb106-28"><a href="#cb106-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> pred_data_X2, <span class="fu">aes</span>(<span class="at">x =</span> X2, <span class="at">y =</span> Y_pred), </span>
<span id="cb106-29"><a href="#cb106-29" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb106-30"><a href="#cb106-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb106-31"><a href="#cb106-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Partial Effect of X2"</span>,</span>
<span id="cb106-32"><a href="#cb106-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"(X1 held at mean ="</span>, <span class="fu">round</span>(<span class="fu">mean</span>(X1), <span class="dv">2</span>), <span class="st">")"</span>))</span>
<span id="cb106-33"><a href="#cb106-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb106-34"><a href="#cb106-34" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/coefficient-interpretation-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Partial Effects in Multiple Regression</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="multicollinearity" class="level3">
<h3 class="anchored" data-anchor-id="multicollinearity">Multicollinearity</h3>
<p>Multicollinearity occurs when predictors are highly correlated. Let’s demonstrate its effects:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with multicollinearity</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">106</span>)</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>X1_new <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>)</span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>X2_new <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>X1_new <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)  <span class="co"># X2 highly correlated with X1</span></span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>Y_new <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>X1_new <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>X2_new <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>data_collinear <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Y =</span> Y_new, <span class="at">X1 =</span> X1_new, <span class="at">X2 =</span> X2_new)</span>
<span id="cb107-8"><a href="#cb107-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-9"><a href="#cb107-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model with multicollinearity</span></span>
<span id="cb107-10"><a href="#cb107-10" aria-hidden="true" tabindex="-1"></a>model_collinear <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">+</span> X2, <span class="at">data =</span> data_collinear)</span>
<span id="cb107-11"><a href="#cb107-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-12"><a href="#cb107-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate VIF</span></span>
<span id="cb107-13"><a href="#cb107-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb107-14"><a href="#cb107-14" aria-hidden="true" tabindex="-1"></a>vif_results <span class="ot">&lt;-</span> <span class="fu">vif</span>(model_collinear)</span>
<span id="cb107-15"><a href="#cb107-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb107-16"><a href="#cb107-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot correlation</span></span>
<span id="cb107-17"><a href="#cb107-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_collinear, <span class="fu">aes</span>(<span class="at">x =</span> X1, <span class="at">y =</span> X2)) <span class="sc">+</span></span>
<span id="cb107-18"><a href="#cb107-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb107-19"><a href="#cb107-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb107-20"><a href="#cb107-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Correlation between Predictors"</span>,</span>
<span id="cb107-22"><a href="#cb107-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Correlation ="</span>, </span>
<span id="cb107-23"><a href="#cb107-23" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">round</span>(<span class="fu">cor</span>(X1_new, X2_new), <span class="dv">3</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/multicollinearity-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Effects of Multicollinearity</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="advanced-topics" class="level2" data-number="15.12">
<h2 data-number="15.12" class="anchored" data-anchor-id="advanced-topics"><span class="header-section-number">15.12</span> Advanced Topics</h2>
<section id="interaction-terms" class="level3">
<h3 class="anchored" data-anchor-id="interaction-terms">Interaction Terms</h3>
<p>Interaction terms allow the effect of one predictor to depend on another:</p>
<p><span class="math display">Y = \beta_0 + \beta_1X_1 + \beta_2X_2 + \beta_3(X_1 \times X_2) + \varepsilon</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with interaction</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">107</span>)</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>X1_int <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>X2_int <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>Y_int <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">+</span> <span class="dv">2</span><span class="sc">*</span>X1_int <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>X2_int <span class="sc">+</span> <span class="dv">4</span><span class="sc">*</span>X1_int<span class="sc">*</span>X2_int <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-7"><a href="#cb109-7" aria-hidden="true" tabindex="-1"></a>data_int <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X1 =</span> X1_int, <span class="at">X2 =</span> X2_int, <span class="at">Y =</span> Y_int)</span>
<span id="cb109-8"><a href="#cb109-8" aria-hidden="true" tabindex="-1"></a>model_int <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X1 <span class="sc">*</span> X2, <span class="at">data =</span> data_int)</span>
<span id="cb109-9"><a href="#cb109-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-10"><a href="#cb109-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create interaction plot</span></span>
<span id="cb109-11"><a href="#cb109-11" aria-hidden="true" tabindex="-1"></a>X1_levels <span class="ot">&lt;-</span> <span class="fu">quantile</span>(X1_int, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>))</span>
<span id="cb109-12"><a href="#cb109-12" aria-hidden="true" tabindex="-1"></a>X2_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(X2_int), <span class="fu">max</span>(X2_int), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb109-13"><a href="#cb109-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-14"><a href="#cb109-14" aria-hidden="true" tabindex="-1"></a>pred_data <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb109-15"><a href="#cb109-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> X1_levels,</span>
<span id="cb109-16"><a href="#cb109-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> X2_seq</span>
<span id="cb109-17"><a href="#cb109-17" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb109-18"><a href="#cb109-18" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>Y_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_int, <span class="at">newdata =</span> pred_data)</span>
<span id="cb109-19"><a href="#cb109-19" aria-hidden="true" tabindex="-1"></a>pred_data<span class="sc">$</span>X1_level <span class="ot">&lt;-</span> <span class="fu">factor</span>(pred_data<span class="sc">$</span>X1, </span>
<span id="cb109-20"><a href="#cb109-20" aria-hidden="true" tabindex="-1"></a>                            <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low X1"</span>, <span class="st">"High X1"</span>))</span>
<span id="cb109-21"><a href="#cb109-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb109-22"><a href="#cb109-22" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(pred_data, <span class="fu">aes</span>(<span class="at">x =</span> X2, <span class="at">y =</span> Y_pred, <span class="at">color =</span> X1_level)) <span class="sc">+</span></span>
<span id="cb109-23"><a href="#cb109-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb109-24"><a href="#cb109-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb109-25"><a href="#cb109-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Interaction Effect"</span>,</span>
<span id="cb109-26"><a href="#cb109-26" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Effect of X2 depends on level of X1"</span>,</span>
<span id="cb109-27"><a href="#cb109-27" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"X1 Level"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/interactions-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Visualization of Interaction Effects</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="polynomial-terms" class="level3">
<h3 class="anchored" data-anchor-id="polynomial-terms">Polynomial Terms</h3>
<p>When relationships are non-linear, we can add polynomial terms:</p>
<p><span class="math display">Y = \beta_0 + \beta_1X + \beta_2X^2 + \varepsilon</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate data with quadratic relationship</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">108</span>)</span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>X_poly <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>Y_poly <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">-</span> <span class="dv">2</span><span class="sc">*</span>X_poly <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>X_poly<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="fu">length</span>(X_poly), <span class="dv">0</span>, <span class="dv">2</span>)</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a>data_poly <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">X =</span> X_poly, <span class="at">Y =</span> Y_poly)</span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear and quadratic models</span></span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>model_linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X, <span class="at">data =</span> data_poly)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a>model_quad <span class="ot">&lt;-</span> <span class="fu">lm</span>(Y <span class="sc">~</span> X <span class="sc">+</span> <span class="fu">I</span>(X<span class="sc">^</span><span class="dv">2</span>), <span class="at">data =</span> data_poly)</span>
<span id="cb110-10"><a href="#cb110-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-11"><a href="#cb110-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Add predictions</span></span>
<span id="cb110-12"><a href="#cb110-12" aria-hidden="true" tabindex="-1"></a>data_poly<span class="sc">$</span>pred_linear <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_linear)</span>
<span id="cb110-13"><a href="#cb110-13" aria-hidden="true" tabindex="-1"></a>data_poly<span class="sc">$</span>pred_quad <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_quad)</span>
<span id="cb110-14"><a href="#cb110-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-15"><a href="#cb110-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb110-16"><a href="#cb110-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_poly, <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y)) <span class="sc">+</span></span>
<span id="cb110-17"><a href="#cb110-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb110-18"><a href="#cb110-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_linear, <span class="at">color =</span> <span class="st">"Linear"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb110-19"><a href="#cb110-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y =</span> pred_quad, <span class="at">color =</span> <span class="st">"Quadratic"</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb110-20"><a href="#cb110-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb110-21"><a href="#cb110-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb110-22"><a href="#cb110-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear vs. Quadratic Fit"</span>,</span>
<span id="cb110-23"><a href="#cb110-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Model Type"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/polynomial-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Polynomial Regression Example</figcaption>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="practical-guidelines-for-regression-analysis" class="level2" data-number="15.13">
<h2 data-number="15.13" class="anchored" data-anchor-id="practical-guidelines-for-regression-analysis"><span class="header-section-number">15.13</span> Practical Guidelines for Regression Analysis</h2>
<section id="model-building-process" class="level3">
<h3 class="anchored" data-anchor-id="model-building-process">Model Building Process</h3>
<ol type="1">
<li><strong>Data Exploration</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate example dataset</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">109</span>)</span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>data_example <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">x1 =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">50</span>, <span class="at">sd =</span> <span class="dv">10</span>),</span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">x2 =</span> <span class="fu">rnorm</span>(n, <span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">x3 =</span> <span class="fu">runif</span>(n, <span class="dv">0</span>, <span class="dv">100</span>)</span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>data_example<span class="sc">$</span>y <span class="ot">&lt;-</span> <span class="dv">10</span> <span class="sc">+</span> <span class="fl">0.5</span><span class="sc">*</span>data_example<span class="sc">$</span>x1 <span class="sc">+</span> <span class="fl">0.8</span><span class="sc">*</span>data_example<span class="sc">$</span>x2 <span class="sc">-</span> </span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>                 <span class="fl">0.3</span><span class="sc">*</span>data_example<span class="sc">$</span>x3 <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="dv">0</span>, <span class="dv">5</span>)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Correlation matrix plot</span></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(GGally)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Registered S3 method overwritten by 'GGally':
  method from   
  +.gg   ggplot2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggpairs</span>(data_example) <span class="sc">+</span></span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb113-3"><a href="#cb113-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Exploratory Data Analysis"</span>,</span>
<span id="cb113-4"><a href="#cb113-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Correlation matrix and distributions"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/data-exploration-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Data Exploration Example</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><strong>Variable Selection</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models with different variables</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a>model1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1, <span class="at">data =</span> data_example)</span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2, <span class="at">data =</span> data_example)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>model3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data =</span> data_example)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare models</span></span>
<span id="cb114-7"><a href="#cb114-7" aria-hidden="true" tabindex="-1"></a>models_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb114-8"><a href="#cb114-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"y ~ x1"</span>, <span class="st">"y ~ x1 + x2"</span>, <span class="st">"y ~ x1 + x2 + x3"</span>),</span>
<span id="cb114-9"><a href="#cb114-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(<span class="fu">summary</span>(model1)<span class="sc">$</span>r.squared,</span>
<span id="cb114-10"><a href="#cb114-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summary</span>(model2)<span class="sc">$</span>r.squared,</span>
<span id="cb114-11"><a href="#cb114-11" aria-hidden="true" tabindex="-1"></a>                <span class="fu">summary</span>(model3)<span class="sc">$</span>r.squared),</span>
<span id="cb114-12"><a href="#cb114-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Adj_R_squared =</span> <span class="fu">c</span>(<span class="fu">summary</span>(model1)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb114-13"><a href="#cb114-13" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summary</span>(model2)<span class="sc">$</span>adj.r.squared,</span>
<span id="cb114-14"><a href="#cb114-14" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">summary</span>(model3)<span class="sc">$</span>adj.r.squared)</span>
<span id="cb114-15"><a href="#cb114-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb114-16"><a href="#cb114-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-17"><a href="#cb114-17" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(models_comparison, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb114-18"><a href="#cb114-18" aria-hidden="true" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">"Model Comparison Summary"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Model Comparison Summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Model</th>
<th style="text-align: right;">R_squared</th>
<th style="text-align: right;">Adj_R_squared</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">y ~ x1</td>
<td style="text-align: right;">0.323</td>
<td style="text-align: right;">0.316</td>
</tr>
<tr class="even">
<td style="text-align: left;">y ~ x1 + x2</td>
<td style="text-align: right;">0.433</td>
<td style="text-align: right;">0.421</td>
</tr>
<tr class="odd">
<td style="text-align: left;">y ~ x1 + x2 + x3</td>
<td style="text-align: right;">0.893</td>
<td style="text-align: right;">0.890</td>
</tr>
</tbody>
</table>
<p>Variable Selection Process</p>
</div>
</div>
</section>
<section id="common-pitfalls-and-solutions" class="level3">
<h3 class="anchored" data-anchor-id="common-pitfalls-and-solutions">Common Pitfalls and Solutions</h3>
<ol type="1">
<li><strong>Outliers and Influential Points</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with outlier</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">110</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>x_clean <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a>y_clean <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="dv">3</span><span class="sc">*</span>x_clean <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, <span class="dv">0</span>, <span class="fl">0.5</span>)</span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a>data_clean <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_clean, <span class="at">y =</span> y_clean)</span>
<span id="cb115-6"><a href="#cb115-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-7"><a href="#cb115-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Add outlier</span></span>
<span id="cb115-8"><a href="#cb115-8" aria-hidden="true" tabindex="-1"></a>data_outlier <span class="ot">&lt;-</span> <span class="fu">rbind</span>(data_clean,</span>
<span id="cb115-9"><a href="#cb115-9" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="dv">4</span>, <span class="at">y =</span> <span class="sc">-</span><span class="dv">10</span>))</span>
<span id="cb115-10"><a href="#cb115-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-11"><a href="#cb115-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb115-12"><a href="#cb115-12" aria-hidden="true" tabindex="-1"></a>model_clean <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_clean)</span>
<span id="cb115-13"><a href="#cb115-13" aria-hidden="true" tabindex="-1"></a>model_outlier <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_outlier)</span>
<span id="cb115-14"><a href="#cb115-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-15"><a href="#cb115-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb115-16"><a href="#cb115-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb115-17"><a href="#cb115-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_clean, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb115-18"><a href="#cb115-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> data_outlier[<span class="dv">51</span>,], <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), </span>
<span id="cb115-19"><a href="#cb115-19" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb115-20"><a href="#cb115-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> data_clean, </span>
<span id="cb115-21"><a href="#cb115-21" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(model_clean), </span>
<span id="cb115-22"><a href="#cb115-22" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"Without Outlier"</span>)) <span class="sc">+</span></span>
<span id="cb115-23"><a href="#cb115-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> data_outlier, </span>
<span id="cb115-24"><a href="#cb115-24" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> <span class="fu">predict</span>(model_outlier), </span>
<span id="cb115-25"><a href="#cb115-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">color =</span> <span class="st">"With Outlier"</span>)) <span class="sc">+</span></span>
<span id="cb115-26"><a href="#cb115-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb115-27"><a href="#cb115-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Effect of Outliers on Regression"</span>,</span>
<span id="cb115-28"><a href="#cb115-28" aria-hidden="true" tabindex="-1"></a>       <span class="at">color =</span> <span class="st">"Model"</span>) <span class="sc">+</span></span>
<span id="cb115-29"><a href="#cb115-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/outliers-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Identifying and Handling Outliers</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><strong>Missing Data Patterns</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data with missing values</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">111</span>)</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>data_missing <span class="ot">&lt;-</span> data_example</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>data_missing<span class="sc">$</span>x1[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="dv">10</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>data_missing<span class="sc">$</span>x2[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="dv">15</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>data_missing<span class="sc">$</span>x3[<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span>n, <span class="dv">20</span>)] <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb116-8"><a href="#cb116-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize missing patterns</span></span>
<span id="cb116-9"><a href="#cb116-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(naniar)</span>
<span id="cb116-10"><a href="#cb116-10" aria-hidden="true" tabindex="-1"></a><span class="fu">vis_miss</span>(data_missing) <span class="sc">+</span></span>
<span id="cb116-11"><a href="#cb116-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb116-12"><a href="#cb116-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Missing Data Patterns"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/missing-data-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Missing Data Patterns</figcaption>
</figure>
</div>
</div>
</div>
<ol start="3" type="1">
<li><strong>Heteroscedasticity</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate heteroscedastic data</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">112</span>)</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a>x_hetero <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">3</span>, <span class="dv">3</span>, <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>y_hetero <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">+</span> <span class="fl">1.5</span><span class="sc">*</span>x_hetero <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">100</span>, <span class="dv">0</span>, <span class="fu">abs</span>(x_hetero)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>data_hetero <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x_hetero, <span class="at">y =</span> y_hetero)</span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model</span></span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>model_hetero <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data_hetero)</span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot</span></span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_hetero, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Heteroscedastic Data"</span>)</span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-17"><a href="#cb117-17" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data_hetero, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">fitted</span>(model_hetero), </span>
<span id="cb117-18"><a href="#cb117-18" aria-hidden="true" tabindex="-1"></a>                             <span class="at">y =</span> <span class="fu">residuals</span>(model_hetero))) <span class="sc">+</span></span>
<span id="cb117-19"><a href="#cb117-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb117-20"><a href="#cb117-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb117-21"><a href="#cb117-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb117-22"><a href="#cb117-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Residual Plot"</span>,</span>
<span id="cb117-23"><a href="#cb117-23" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"Fitted values"</span>,</span>
<span id="cb117-24"><a href="#cb117-24" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">"Residuals"</span>)</span>
<span id="cb117-25"><a href="#cb117-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-26"><a href="#cb117-26" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/heteroscedasticity-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Detecting and Visualizing Heteroscedasticity</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="best-practices" class="level3">
<h3 class="anchored" data-anchor-id="best-practices">Best Practices</h3>
<ol type="1">
<li><strong>Model Validation</strong></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Simple cross-validation example</span></span>
<span id="cb119-2"><a href="#cb119-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">113</span>)</span>
<span id="cb119-3"><a href="#cb119-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-4"><a href="#cb119-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create training and test sets</span></span>
<span id="cb119-5"><a href="#cb119-5" aria-hidden="true" tabindex="-1"></a>train_index <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(data_example), <span class="fl">0.7</span><span class="sc">*</span><span class="fu">nrow</span>(data_example))</span>
<span id="cb119-6"><a href="#cb119-6" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> data_example[train_index, ]</span>
<span id="cb119-7"><a href="#cb119-7" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> data_example[<span class="sc">-</span>train_index, ]</span>
<span id="cb119-8"><a href="#cb119-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-9"><a href="#cb119-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit model on training data</span></span>
<span id="cb119-10"><a href="#cb119-10" aria-hidden="true" tabindex="-1"></a>model_train <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data =</span> train_data)</span>
<span id="cb119-11"><a href="#cb119-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-12"><a href="#cb119-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict on test data</span></span>
<span id="cb119-13"><a href="#cb119-13" aria-hidden="true" tabindex="-1"></a>predictions <span class="ot">&lt;-</span> <span class="fu">predict</span>(model_train, <span class="at">newdata =</span> test_data)</span>
<span id="cb119-14"><a href="#cb119-14" aria-hidden="true" tabindex="-1"></a>actual <span class="ot">&lt;-</span> test_data<span class="sc">$</span>y</span>
<span id="cb119-15"><a href="#cb119-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-16"><a href="#cb119-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate performance metrics</span></span>
<span id="cb119-17"><a href="#cb119-17" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((predictions <span class="sc">-</span> actual)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb119-18"><a href="#cb119-18" aria-hidden="true" tabindex="-1"></a>mae <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">abs</span>(predictions <span class="sc">-</span> actual))</span>
<span id="cb119-19"><a href="#cb119-19" aria-hidden="true" tabindex="-1"></a>r2 <span class="ot">&lt;-</span> <span class="fu">cor</span>(predictions, actual)<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb119-20"><a href="#cb119-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-21"><a href="#cb119-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot predictions vs actual</span></span>
<span id="cb119-22"><a href="#cb119-22" aria-hidden="true" tabindex="-1"></a>data_validation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb119-23"><a href="#cb119-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> predictions,</span>
<span id="cb119-24"><a href="#cb119-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> actual</span>
<span id="cb119-25"><a href="#cb119-25" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb119-26"><a href="#cb119-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-27"><a href="#cb119-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data_validation, <span class="fu">aes</span>(<span class="at">x =</span> Actual, <span class="at">y =</span> Predicted)) <span class="sc">+</span></span>
<span id="cb119-28"><a href="#cb119-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb119-29"><a href="#cb119-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb119-30"><a href="#cb119-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb119-31"><a href="#cb119-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Model Validation: Predicted vs Actual"</span>,</span>
<span id="cb119-32"><a href="#cb119-32" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">sprintf</span>(<span class="st">"RMSE = %.2f, MAE = %.2f, R² = %.2f"</span>, </span>
<span id="cb119-33"><a href="#cb119-33" aria-hidden="true" tabindex="-1"></a>                         rmse, mae, r2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="correg_en_files/figure-html/model-validation-1.png" class="img-fluid figure-img" width="672"></p>
<figcaption>Cross-Validation Example</figcaption>
</figure>
</div>
</div>
</div>
<ol start="2" type="1">
<li><strong>Reporting Results</strong></li>
</ol>
<p>Example of a professional regression results table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create regression results table</span></span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'kableExtra'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following object is masked from 'package:dplyr':

    group_rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>model_final <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x1 <span class="sc">+</span> x2 <span class="sc">+</span> x3, <span class="at">data =</span> data_example)</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>results <span class="ot">&lt;-</span> <span class="fu">tidy</span>(model_final, <span class="at">conf.int =</span> <span class="cn">TRUE</span>)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(results, <span class="at">digits =</span> <span class="dv">3</span>,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">"Regression Results Summary"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover caption-top table-sm small" data-quarto-postprocess="true">
<caption>Regression Results Summary</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">term</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">estimate</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">std.error</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">statistic</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">p.value</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.low</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">conf.high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">(Intercept)</td>
<td style="text-align: right;">9.116</td>
<td style="text-align: right;">2.835</td>
<td style="text-align: right;">3.216</td>
<td style="text-align: right;">0.002</td>
<td style="text-align: right;">3.489</td>
<td style="text-align: right;">14.743</td>
</tr>
<tr class="even">
<td style="text-align: left;">x1</td>
<td style="text-align: right;">0.497</td>
<td style="text-align: right;">0.039</td>
<td style="text-align: right;">12.756</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.419</td>
<td style="text-align: right;">0.574</td>
</tr>
<tr class="odd">
<td style="text-align: left;">x2</td>
<td style="text-align: right;">0.905</td>
<td style="text-align: right;">0.086</td>
<td style="text-align: right;">10.468</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">0.734</td>
<td style="text-align: right;">1.077</td>
</tr>
<tr class="even">
<td style="text-align: left;">x3</td>
<td style="text-align: right;">-0.324</td>
<td style="text-align: right;">0.016</td>
<td style="text-align: right;">-20.322</td>
<td style="text-align: right;">0.000</td>
<td style="text-align: right;">-0.356</td>
<td style="text-align: right;">-0.292</td>
</tr>
</tbody>
</table>


</div>
</div>
</section>
</section>
<section id="conclusion-1" class="level2" data-number="15.14">
<h2 data-number="15.14" class="anchored" data-anchor-id="conclusion-1"><span class="header-section-number">15.14</span> Conclusion</h2>
<section id="key-takeaways-1" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaways-1">Key Takeaways</h3>
<ol type="1">
<li>Always start with exploratory data analysis</li>
<li>Check assumptions before interpreting results</li>
<li>Be aware of common pitfalls:
<ul>
<li>Outliers</li>
<li>Missing data</li>
<li>Multicollinearity</li>
<li>Heteroscedasticity</li>
</ul></li>
<li>Validate your model using:
<ul>
<li>Diagnostic plots</li>
<li>Cross-validation</li>
<li>Residual analysis</li>
</ul></li>
<li>Report results clearly and completely</li>
</ol>
</section>
<section id="further-reading" class="level3 unnumbered">
<h3 class="unnumbered anchored" data-anchor-id="further-reading">Further Reading</h3>
<p>For deeper understanding:</p>
<ul>
<li>Wooldridge, J.M. “Introductory Econometrics: A Modern Approach”</li>
<li>Angrist, J.D. and Pischke, J.S. “Mostly Harmless Econometrics”</li>
<li>Stock &amp; Watson “Introduction to Econometrics”</li>
</ul>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Understanding Ordinary Least Squares (OLS) Regression: A Student’s Guide
</div>
</div>
<div class="callout-body-container callout-body">
<p>Regression analysis is a fundamental statistical method that examines and models the relationship between variables to understand how changes in one or more independent variables influence a dependent variable.</p>
<p>At its heart, regression analysis helps us answer questions about cause and effect, prediction, and forecasting. For example, a business might use regression analysis to understand how advertising spending affects sales, or how employee training hours impact productivity.</p>
<section id="regression-as-a-stochastic-model-1" class="level3">
<h3 class="anchored" data-anchor-id="regression-as-a-stochastic-model-1">Regression as a Stochastic Model</h3>
<p>In mathematical modelling, we encounter two fundamental approaches to describing relationships between variables:</p>
<ul>
<li>deterministic models,</li>
<li>stochastic models.</li>
</ul>
<section id="deterministic-vs.-stochastic-models-1" class="level4">
<h4 class="anchored" data-anchor-id="deterministic-vs.-stochastic-models-1">Deterministic vs.&nbsp;Stochastic Models</h4>
<p>A deterministic model assumes a precise, fixed relationship between inputs and outputs. In such models, if we know the inputs, we can calculate the exact output with certainty. Consider the classic physics equation for distance:</p>
<p><span class="math display">\text{Distance} = \text{Speed} × \text{Time}</span></p>
<p>Given specific values for speed and time, this equation will always yield the same distance. There is no room for variation in the outcome.</p>
<p>In contrast, regression analysis embraces the presence of natural variation in data. The fundamental structure of a regression model is:</p>
<p><span class="math display">Y = f(X) + \epsilon</span></p>
<p>Where:</p>
<ul>
<li><span class="math inline">Y</span> represents the outcome we wish to predict</li>
<li><span class="math inline">f(X)</span> represents the systematic relationship between our predictors (X) and the outcome</li>
<li><span class="math inline">\epsilon</span> represents the random variation that naturally occurs in real-world data</li>
</ul>
</section>
</section>
<section id="what-is-simple-linear-regression" class="level3">
<h3 class="anchored" data-anchor-id="what-is-simple-linear-regression">What is Simple Linear Regression?</h3>
<p>Consider the relationship between <strong>study hours</strong> (predictor) and <strong>exam scores</strong> (outcome/response variable). Simple linear regression creates an optimal straight line through data points to model this relationship. This line serves two purposes: making predictions and quantifying the relationship between variables.</p>
<p>The mathematical relationship is expressed as:</p>
<p><span class="math display"> Y_i = \beta_0 + \beta_1X_i + \epsilon_i </span></p>
<p>Using our study hours example to illustrate each component:</p>
<ul>
<li><span class="math inline">Y_i</span> represents the dependent variable (exam scores)</li>
<li><span class="math inline">X_i</span> represents the independent variable (study hours)</li>
<li><span class="math inline">\beta_0</span> represents the intercept - the expected exam score at zero study hours</li>
<li><span class="math inline">\beta_1</span> represents the slope - the change in exam score per additional study hour</li>
<li><span class="math inline">\epsilon_i</span> represents the error term, accounting for unobserved factors</li>
</ul>
<p>Our goal is to find estimates <span class="math inline">\hat{\beta}_0</span> and <span class="math inline">\hat{\beta}_1</span> that best approximate the true parameters <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span>. The fitted regression line is then expressed as:</p>
<p><span class="math display"> \hat{Y}_i = \hat{\beta}_0 + \hat{\beta}_1X_i </span></p>
</section>
<section id="the-ordinary-least-squares-ols-method" class="level3">
<h3 class="anchored" data-anchor-id="the-ordinary-least-squares-ols-method">The Ordinary Least Squares (OLS) Method</h3>
<p>The “Ordinary Least Squares” method determines optimal values for <span class="math inline">\hat{\beta}_0</span> and <span class="math inline">\hat{\beta}_1</span> through a methodical process. While modern statistical software performs these calculations automatically, understanding the underlying process is crucial:</p>
<ol type="1">
<li><p>Begin with an initial estimate for the regression line</p>
<ul>
<li>Typically, we start with the horizontal line at <span class="math inline">\bar{Y}</span> (mean of Y)</li>
<li>This serves as our baseline, representing no relationship between X and Y</li>
</ul></li>
<li><p>Calculate the vertical distances (residuals) from each observed point to this line</p>
<ul>
<li>These residuals <span class="math inline">\hat{\epsilon}_i = e_i = Y_i - \hat{Y}_i</span> represent our prediction errors</li>
<li>A positive residual means our line underestimates the true value</li>
<li>A negative residual means our line overestimates the true value</li>
</ul></li>
<li><p>Square these distances to:</p>
<ul>
<li>Ensure positive and negative deviations don’t offset each other</li>
<li>Assign greater weight to larger deviations</li>
</ul></li>
<li><p>Sum all squared distances to obtain the Sum of Squared Errors (SSE)</p>
<ul>
<li><span class="math inline">SSE = \sum(Y_i - \hat{Y}_i)^2</span></li>
<li>This represents the total squared deviation of observed values from our predicted values</li>
</ul></li>
<li><p>Systematically adjust the slope and intercept of the line to minimize SSE:</p>
<ul>
<li>The process involves gradually modifying the slope and position of the line while observing how the sum of squared deviations (SSE) changes [formally, this requires concepts from differential calculus]</li>
<li>When SSE stops decreasing with subsequent small changes in line parameters, this indicates the optimal fit has been found</li>
<li>This point corresponds to the minimum possible value of SSE, meaning the best fit of the line to the data</li>
</ul></li>
</ol>
<p>More formally, OLS finds the optimal values for <span class="math inline">\beta_0</span> and <span class="math inline">\beta_1</span> by minimizing the sum of squared errors:</p>
<p><span class="math display">\min_{\beta_0, \beta_1} \sum e_i^2 = \min_{\beta_0, \beta_1} \sum(y_i - \hat{y_i})^2 = \min_{\beta_0, \beta_1} \sum(y_i - (\beta_0 + \beta_1x_i))^2</span> The solution to this minimization gives us:</p>
<p><span class="math display">\hat{\beta}_1 = \frac{\sum(x_i - \bar{x})(y_i - \bar{y})}{\sum(x_i - \bar{x})^2} = \frac{cov(X, Y)}{var(X)}</span></p>
<p><span class="math display">\hat{\beta}_0 = \bar{y} - \hat{\beta}_1\bar{x}</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="parameter-estimation" class="level3">
<h3 class="anchored" data-anchor-id="parameter-estimation">Parameter Estimation</h3>
<p>The formulas for estimating the parameters employ fundamental statistical measures:</p>
<p><span class="math display"> \hat{\beta}_1 = \frac{Cov(X,Y)}{Var(X)} = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{\sum(X_i - \bar{X})^2} </span></p>
<p>This formula comprises two essential statistical concepts:</p>
<ul>
<li>Covariance (<span class="math inline">Cov</span>) quantifies the joint movement of X and Y</li>
<li>Variance (<span class="math inline">Var</span>) measures the dispersion of X values around their mean</li>
<li><span class="math inline">\bar{X}</span> and <span class="math inline">\bar{Y}</span> represent the means of X and Y respectively</li>
</ul>
<p>After calculating <span class="math inline">\hat{\beta}_1</span>, we determine <span class="math inline">\hat{\beta}_0</span>:</p>
<p><span class="math display"> \hat{\beta}_0 = \bar{Y} - \hat{\beta}_1\bar{X} </span></p>
<p>This ensures the regression line intersects the point of means (<span class="math inline">\bar{X}</span>, <span class="math inline">\bar{Y}</span>).</p>
</section>
<section id="understanding-variation-in-regression-analysis" class="level3">
<h3 class="anchored" data-anchor-id="understanding-variation-in-regression-analysis">Understanding Variation in Regression Analysis</h3>
<p>In regression analysis, we decompose the variation in our data into distinct components to understand how well our model explains the outcome variable. Let’s examine each component of variation in detail.</p>
<section id="overview-of-variation-components" class="level4">
<h4 class="anchored" data-anchor-id="overview-of-variation-components">Overview of Variation Components</h4>
<p>The total Sum of Squares (SST) represents all variation present in our outcome variable. The Regression Sum of Squares (SSR) captures the variation explained by our model. The Error Sum of Squares (SSE) represents the remaining unexplained variation. Let’s examine each in detail.</p>
</section>
<section id="total-sum-of-squares-sst" class="level4">
<h4 class="anchored" data-anchor-id="total-sum-of-squares-sst">Total Sum of Squares (SST)</h4>
<p>Think of total variation (SST) as capturing the full range of differences in our data before we try to explain anything. It measures how much each observation differs from the overall average, giving us a baseline for how much variation exists to be explained.</p>
<p>SST measures the total variation in our outcome variable by calculating how much each observation deviates from the overall mean:</p>
<p><span class="math display"> SST = \sum(y_i - \bar{y})^2 </span></p>
<p>In this formula, <span class="math inline">y_i</span> represents each individual observation, and <span class="math inline">\bar{y}</span> represents the mean of all observations. The squared differences capture the total spread of our data around its average value.</p>
<p>To make this concrete, imagine measuring the heights of everyone in a city. Some people are much taller than average, others shorter, and SST captures these differences. Each squared term <span class="math inline">(y_i - \bar{y})^2</span> represents how much one person’s height differs from the city’s average, and we sum up all these differences.</p>
</section>
<section id="regression-sum-of-squares-ssr" class="level4">
<h4 class="anchored" data-anchor-id="regression-sum-of-squares-ssr">Regression Sum of Squares (SSR)</h4>
<p>Once we introduce explanatory variables (like genetics, nutrition, or age), we can predict heights more accurately. The explained variation (SSR) measures how much better our predictions become using these variables.</p>
<p>SSR quantifies how much variation our model explains through its predictor variables:</p>
<p><span class="math display"> SSR = \sum(\hat{y}_i - \bar{y})^2 </span></p>
<p>Here, <span class="math inline">\hat{y}_i</span> represents our model’s predicted values. This formula measures how far our predictions deviate from the mean, representing the variation captured by our model.</p>
</section>
<section id="error-sum-of-squares-sse" class="level4">
<h4 class="anchored" data-anchor-id="error-sum-of-squares-sse">Error Sum of Squares (SSE)</h4>
<p>SSE measures the variation that remains unexplained by our model:</p>
<p><span class="math display"> SSE = \sum(y_i - \hat{y}_i)^2 </span></p>
<p>This formula calculates the differences between actual values (<span class="math inline">y_i</span>) and predicted values (<span class="math inline">\hat{y}_i</span>), showing us how much variation our model failed to explain.</p>
<p>In our height example, these might be variations due to factors we didn’t or couldn’t measure, like specific environmental conditions or measurement errors.</p>
</section>
<section id="the-fundamental-relationship" class="level4">
<h4 class="anchored" data-anchor-id="the-fundamental-relationship">The Fundamental Relationship</h4>
<p>These three components are related through a key equation:</p>
<p><span class="math display"> SST = SSR + SSE </span></p>
<p>This equation shows that the total variation (SST) equals the sum of explained variation (SSR) and unexplained variation (SSE). This relationship forms the basis for measuring model performance.</p>
</section>
<section id="coefficient-of-determination-r²" class="level4">
<h4 class="anchored" data-anchor-id="coefficient-of-determination-r²">Coefficient of Determination (R²)</h4>
<p>The R² statistic, derived from these components, tells us the proportion of variation our model explains:</p>
<p><span class="math display"> R^2 = \frac{SSR}{SST} = 1 - \frac{SSE}{SST} </span></p>
<p>When R² equals 0.75, it indicates our model explains 75% of the variation in the outcome variable. The remaining 25% represents unexplained variation.</p>
</section>
<section id="important-considerations" class="level4">
<h4 class="anchored" data-anchor-id="important-considerations">Important Considerations</h4>
<p>Understanding these components helps us:</p>
<ol type="1">
<li>Evaluate model performance through the proportion of explained variation</li>
<li>Identify how much variation remains unexplained</li>
<li>Make informed decisions about model improvement</li>
<li>Compare different models’ explanatory power</li>
</ol>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid figure-img" width="768"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="the-coefficient-of-determination-r2" class="level3">
<h3 class="anchored" data-anchor-id="the-coefficient-of-determination-r2">The Coefficient of Determination (<span class="math inline">R^2</span>)</h3>
<p><span class="math inline">R^2</span> serves as a measure of model fit, representing the proportion of variance explained by our regression:</p>
<p><span class="math display"> R^2 = \frac{SSR}{SST} = \frac{SSR}{SSR + SSE} = 1 - \frac{SSE}{SST} </span></p>
<p>To interpret <span class="math inline">R^2</span>:</p>
<ul>
<li>An <span class="math inline">R^2</span> of 0.75 indicates the model explains 75% of variance (e.g.&nbsp;in exam scores)</li>
<li>An <span class="math inline">R^2</span> of 0.20 suggests predictors (e.g.&nbsp;study hours) account for 20% of score variation</li>
<li>An <span class="math inline">R^2</span> of 1.00 represents perfect prediction (rarely observed in practice)</li>
<li>An <span class="math inline">R^2</span> of 0.00 indicates no explanatory power</li>
</ul>
<p>Note: A lower <span class="math inline">R^2</span> value does not necessarily indicate an inferior model - it may simply reflect the complexity of the relationship being studied.</p>
</section>
<section id="key-takeaway" class="level3">
<h3 class="anchored" data-anchor-id="key-takeaway">Key Takeaway</h3>
<p>Linear regression establishes relationships between variables by identifying the optimal linear fit through data points. This optimization occurs through the minimization of squared residuals. The coefficient of determination (<span class="math inline">R^2</span>) then quantifies the model’s explanatory power by comparing explained variation to total variation in our data.</p>
</section>
</div>
</div>
</section>
</section>
<section id="appendix-a.1-understanding-correlation-measures-a-self-study-tutorial-using-stress-level-and-cognitive-performance-data" class="level2" data-number="15.15">
<h2 data-number="15.15" class="anchored" data-anchor-id="appendix-a.1-understanding-correlation-measures-a-self-study-tutorial-using-stress-level-and-cognitive-performance-data"><span class="header-section-number">15.15</span> Appendix A.1: Understanding Correlation Measures: A Self-Study Tutorial (Using Stress Level and Cognitive Performance Data)</h2>
<section id="dataset-overview" class="level3">
<h3 class="anchored" data-anchor-id="dataset-overview">Dataset Overview</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">anxiety_level =</span> <span class="fu">c</span>(<span class="dv">8</span>, <span class="dv">5</span>, <span class="dv">11</span>, <span class="dv">14</span>, <span class="dv">7</span>, <span class="dv">10</span>),</span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">cognitive_performance =</span> <span class="fu">c</span>(<span class="dv">85</span>, <span class="dv">90</span>, <span class="dv">62</span>, <span class="dv">55</span>, <span class="dv">80</span>, <span class="dv">65</span>)</span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="covariance-calculation" class="level3">
<h3 class="anchored" data-anchor-id="covariance-calculation">1. Covariance Calculation</h3>
<section id="step-1-calculate-means" class="level4">
<h4 class="anchored" data-anchor-id="step-1-calculate-means">Step 1: Calculate Means</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 38%">
<col style="width: 50%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th>Variable</th>
<th>Calculation</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Mean Anxiety (<span class="math inline">\bar{x}</span>)</td>
<td><span class="math inline">(8 + 5 + 11 + 14 + 7 + 10) ÷ 6</span></td>
<td>9.17</td>
</tr>
<tr class="even">
<td>Mean Cognitive (<span class="math inline">\bar{y}</span>)</td>
<td><span class="math inline">(85 + 90 + 62 + 55 + 80 + 65) ÷ 6</span></td>
<td>72.83</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2-calculate-deviations-and-products" class="level4">
<h4 class="anchored" data-anchor-id="step-2-calculate-deviations-and-products">Step 2: Calculate Deviations and Products</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>i</th>
<th><span class="math inline">x_i</span></th>
<th><span class="math inline">y_i</span></th>
<th><span class="math inline">(x_i - \bar{x})</span></th>
<th><span class="math inline">(y_i - \bar{y})</span></th>
<th><span class="math inline">(x_i - \bar{x})(y_i - \bar{y})</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>8</td>
<td>85</td>
<td>-1.17</td>
<td>12.17</td>
<td>-14.24</td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>90</td>
<td>-4.17</td>
<td>17.17</td>
<td>-71.60</td>
</tr>
<tr class="odd">
<td>3</td>
<td>11</td>
<td>62</td>
<td>1.83</td>
<td>-10.83</td>
<td>-19.82</td>
</tr>
<tr class="even">
<td>4</td>
<td>14</td>
<td>55</td>
<td>4.83</td>
<td>-17.83</td>
<td>-86.12</td>
</tr>
<tr class="odd">
<td>5</td>
<td>7</td>
<td>80</td>
<td>-2.17</td>
<td>7.17</td>
<td>-15.56</td>
</tr>
<tr class="even">
<td>6</td>
<td>10</td>
<td>65</td>
<td>0.83</td>
<td>-7.83</td>
<td>-6.50</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td>55</td>
<td>437</td>
<td>0.00</td>
<td>0.00</td>
<td>-213.84</td>
</tr>
</tbody>
</table>
</section>
<section id="step-3-calculate-covariance" class="level4">
<h4 class="anchored" data-anchor-id="step-3-calculate-covariance">Step 3: Calculate Covariance</h4>
<p><span class="math display"> \text{Cov}(X,Y) = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{n-1} = \frac{-213.84}{5} = -42.77 </span></p>
</section>
</section>
<section id="pearson-correlation-coefficient" class="level3">
<h3 class="anchored" data-anchor-id="pearson-correlation-coefficient">2. Pearson Correlation Coefficient</h3>
<section id="step-1-calculate-squared-deviations" class="level4">
<h4 class="anchored" data-anchor-id="step-1-calculate-squared-deviations">Step 1: Calculate Squared Deviations</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>i</th>
<th><span class="math inline">(x_i - \bar{x})</span></th>
<th><span class="math inline">(y_i - \bar{y})</span></th>
<th><span class="math inline">(x_i - \bar{x})^2</span></th>
<th><span class="math inline">(y_i - \bar{y})^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>-1.17</td>
<td>12.17</td>
<td>1.37</td>
<td>148.11</td>
</tr>
<tr class="even">
<td>2</td>
<td>-4.17</td>
<td>17.17</td>
<td>17.39</td>
<td>294.81</td>
</tr>
<tr class="odd">
<td>3</td>
<td>1.83</td>
<td>-10.83</td>
<td>3.35</td>
<td>117.29</td>
</tr>
<tr class="even">
<td>4</td>
<td>4.83</td>
<td>-17.83</td>
<td>23.33</td>
<td>317.91</td>
</tr>
<tr class="odd">
<td>5</td>
<td>-2.17</td>
<td>7.17</td>
<td>4.71</td>
<td>51.41</td>
</tr>
<tr class="even">
<td>6</td>
<td>0.83</td>
<td>-7.83</td>
<td>0.69</td>
<td>61.31</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td>0.00</td>
<td>0.00</td>
<td>50.84</td>
<td>990.84</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2-calculate-standard-deviations" class="level4">
<h4 class="anchored" data-anchor-id="step-2-calculate-standard-deviations">Step 2: Calculate Standard Deviations</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th>Measure</th>
<th>Formula</th>
<th>Calculation</th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">s_x</span></td>
<td><span class="math inline">\sqrt{\frac{\sum (x_i - \bar{x})^2}{n-1}}</span></td>
<td><span class="math inline">\sqrt{\frac{50.84}{5}}</span></td>
<td>3.19</td>
</tr>
<tr class="even">
<td><span class="math inline">s_y</span></td>
<td><span class="math inline">\sqrt{\frac{\sum (y_i - \bar{y})^2}{n-1}}</span></td>
<td><span class="math inline">\sqrt{\frac{990.84}{5}}</span></td>
<td>14.08</td>
</tr>
</tbody>
</table>
</section>
<section id="step-3-calculate-pearson-correlation" class="level4">
<h4 class="anchored" data-anchor-id="step-3-calculate-pearson-correlation">Step 3: Calculate Pearson Correlation</h4>
<p><span class="math display"> r = \frac{\text{Cov}(X,Y)}{s_x s_y} = \frac{-42.77}{3.19 \times 14.08} = -0.95 </span></p>
</section>
</section>
<section id="spearman-rank-correlation" class="level3">
<h3 class="anchored" data-anchor-id="spearman-rank-correlation">3. Spearman Rank Correlation</h3>
<section id="step-1-assign-ranks" class="level4">
<h4 class="anchored" data-anchor-id="step-1-assign-ranks">Step 1: Assign Ranks</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>i</th>
<th><span class="math inline">x_i</span></th>
<th><span class="math inline">y_i</span></th>
<th>Rank <span class="math inline">x_i</span></th>
<th>Rank <span class="math inline">y_i</span></th>
<th><span class="math inline">d_i</span></th>
<th><span class="math inline">d_i^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>8</td>
<td>85</td>
<td>3</td>
<td>2</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>2</td>
<td>5</td>
<td>90</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>11</td>
<td>62</td>
<td>5</td>
<td>5</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>4</td>
<td>14</td>
<td>55</td>
<td>6</td>
<td>6</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>5</td>
<td>7</td>
<td>80</td>
<td>2</td>
<td>3</td>
<td>-1</td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>10</td>
<td>65</td>
<td>4</td>
<td>4</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>2</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2-calculate-spearman-correlation" class="level4">
<h4 class="anchored" data-anchor-id="step-2-calculate-spearman-correlation">Step 2: Calculate Spearman Correlation</h4>
<p><span class="math display"> \rho = 1 - \frac{6\sum d_i^2}{n(n^2-1)} = 1 - \frac{6(2)}{6(36-1)} = 1 - \frac{12}{210} = 0.94 </span></p>
</section>
</section>
<section id="verification-using-r" class="level3">
<h3 class="anchored" data-anchor-id="verification-using-r">Verification using R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlations using R</span></span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data<span class="sc">$</span>anxiety_level, data<span class="sc">$</span>cognitive_performance, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9527979</code></pre>
</div>
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(data<span class="sc">$</span>anxiety_level, data<span class="sc">$</span>cognitive_performance, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9428571</code></pre>
</div>
</div>
</section>
<section id="interpretation" class="level3">
<h3 class="anchored" data-anchor-id="interpretation">Interpretation</h3>
<ol type="1">
<li><p>The strong negative Pearson correlation (r = -0.95) indicates a very strong negative linear relationship between anxiety level and cognitive performance.</p></li>
<li><p>The strong positive Spearman correlation (ρ = 0.94) shows that the relationship is also strongly monotonic.</p></li>
<li><p>The difference between Pearson and Spearman correlations suggests that while there is a strong relationship, it might not be perfectly linear.</p></li>
</ol>
</section>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<ol type="1">
<li>Verify each calculation step in the tables above.</li>
<li>Try calculating these measures with a modified dataset:
<ul>
<li>Add one outlier and observe how it affects both correlation coefficients</li>
<li>Change one pair of values and recalculate</li>
</ul></li>
</ol>
</section>
</section>
<section id="appendix-a.2-calculating-covariance-pearson-spearman-correlation-and-ols---worked-example" class="level2" data-number="15.16">
<h2 data-number="15.16" class="anchored" data-anchor-id="appendix-a.2-calculating-covariance-pearson-spearman-correlation-and-ols---worked-example"><span class="header-section-number">15.16</span> Appendix A.2: Calculating Covariance, Pearson, Spearman Correlation, and OLS - worked example</h2>
<p>A political science student is investigating the relationship between district magnitude (DM) and Gallagher’s disproportionality index (GH) in parliamentary elections across 10 randomly selected democracies.</p>
<p>Data on electoral district magnitudes (<span class="math inline">\text{DM}</span>) and Gallagher index:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">\text{DM}</span> (<span class="math inline">X</span>)</th>
<th>Gallagher (<span class="math inline">Y</span>)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>18.2</td>
</tr>
<tr class="even">
<td>3</td>
<td>16.7</td>
</tr>
<tr class="odd">
<td>4</td>
<td>15.8</td>
</tr>
<tr class="even">
<td>5</td>
<td>15.3</td>
</tr>
<tr class="odd">
<td>6</td>
<td>15.0</td>
</tr>
<tr class="even">
<td>7</td>
<td>14.8</td>
</tr>
<tr class="odd">
<td>8</td>
<td>14.7</td>
</tr>
<tr class="even">
<td>9</td>
<td>14.6</td>
</tr>
<tr class="odd">
<td>10</td>
<td>14.55</td>
</tr>
<tr class="even">
<td>11</td>
<td>14.52</td>
</tr>
</tbody>
</table>
<section id="step-1-calculate-basic-statistics" class="level3">
<h3 class="anchored" data-anchor-id="step-1-calculate-basic-statistics">Step 1: Calculate Basic Statistics</h3>
<p>Calculation of means:</p>
<p>For <span class="math inline">\text{DM}</span> (<span class="math inline">X</span>): <span class="math display">\bar{X} = \frac{\sum_{i=1}^n X_i}{n}</span></p>
<p>Detailed calculation:</p>
<p><span class="math display">2 + 3 + 4 + 5 + 6 + 7 + 8 + 9 + 10 + 11 = 65</span> <span class="math display">\bar{x} = \frac{65}{10} = 6.5</span></p>
<p>For Gallagher index (<span class="math inline">Y</span>): <span class="math display">\bar{Y} = \frac{\sum_{i=1}^n Y_i}{n}</span></p>
<p>Detailed calculation:</p>
<p><span class="math display">18.2 + 16.7 + 15.8 + 15.3 + 15.0 + 14.8 + 14.7 + 14.6 + 14.55 + 14.52 = 154.17</span> <span class="math display">\bar{y} = \frac{154.17}{10} = 15.417</span></p>
</section>
<section id="step-2-detailed-covariance-calculations" class="level3">
<h3 class="anchored" data-anchor-id="step-2-detailed-covariance-calculations">Step 2: Detailed Covariance Calculations</h3>
<p>Complete working table showing all calculations:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">i</span></th>
<th><span class="math inline">X_i</span></th>
<th><span class="math inline">Y_i</span></th>
<th><span class="math inline">(X_i - \bar{X})</span></th>
<th><span class="math inline">(Y_i - \bar{Y})</span></th>
<th><span class="math inline">(X_i - \bar{X})(Y_i - \bar{Y})</span></th>
<th><span class="math inline">(X_i - \bar{X})^2</span></th>
<th><span class="math inline">(Y_i - \bar{Y})^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>18.2</td>
<td><span class="math inline">-4.5</span></td>
<td>2.783</td>
<td><span class="math inline">-12.5235</span></td>
<td>20.25</td>
<td>7.7451</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>16.7</td>
<td><span class="math inline">-3.5</span></td>
<td>1.283</td>
<td><span class="math inline">-4.4905</span></td>
<td>12.25</td>
<td>1.6461</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>15.8</td>
<td><span class="math inline">-2.5</span></td>
<td>0.383</td>
<td><span class="math inline">-0.9575</span></td>
<td>6.25</td>
<td>0.1467</td>
</tr>
<tr class="even">
<td>4</td>
<td>5</td>
<td>15.3</td>
<td><span class="math inline">-1.5</span></td>
<td><span class="math inline">-0.117</span></td>
<td>0.1755</td>
<td>2.25</td>
<td>0.0137</td>
</tr>
<tr class="odd">
<td>5</td>
<td>6</td>
<td>15.0</td>
<td><span class="math inline">-0.5</span></td>
<td><span class="math inline">-0.417</span></td>
<td>0.2085</td>
<td>0.25</td>
<td>0.1739</td>
</tr>
<tr class="even">
<td>6</td>
<td>7</td>
<td>14.8</td>
<td>0.5</td>
<td><span class="math inline">-0.617</span></td>
<td><span class="math inline">-0.3085</span></td>
<td>0.25</td>
<td>0.3807</td>
</tr>
<tr class="odd">
<td>7</td>
<td>8</td>
<td>14.7</td>
<td>1.5</td>
<td><span class="math inline">-0.717</span></td>
<td><span class="math inline">-1.0755</span></td>
<td>2.25</td>
<td>0.5141</td>
</tr>
<tr class="even">
<td>8</td>
<td>9</td>
<td>14.6</td>
<td>2.5</td>
<td><span class="math inline">-0.817</span></td>
<td><span class="math inline">-2.0425</span></td>
<td>6.25</td>
<td>0.6675</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10</td>
<td>14.55</td>
<td>3.5</td>
<td><span class="math inline">-0.867</span></td>
<td><span class="math inline">-3.0345</span></td>
<td>12.25</td>
<td>0.7517</td>
</tr>
<tr class="even">
<td>10</td>
<td>11</td>
<td>14.52</td>
<td>4.5</td>
<td><span class="math inline">-0.897</span></td>
<td><span class="math inline">-4.0365</span></td>
<td>20.25</td>
<td>0.8047</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td>65</td>
<td>154.17</td>
<td>0</td>
<td>0</td>
<td><span class="math inline">-28.085</span></td>
<td>82.5</td>
<td>12.8442</td>
</tr>
</tbody>
</table>
<p>Covariance calculation: <span class="math display">\text{Cov}(X,Y) = \frac{\sum_{i=1}^n (X_i - \bar{X})(Y_i - \bar{Y})}{n-1}</span></p>
<p><span class="math display">\text{Cov}(X,Y) = \frac{-28.085}{9} = -3.120556</span></p>
</section>
<section id="step-3-standard-deviation-calculations" class="level3">
<h3 class="anchored" data-anchor-id="step-3-standard-deviation-calculations">Step 3: Standard Deviation Calculations</h3>
<p>For <span class="math inline">\text{DM}</span> (<span class="math inline">X</span>): <span class="math display">\sigma_X = \sqrt{\frac{\sum_{i=1}^n (X_i - \bar{X})^2}{n-1}}</span></p>
<p><span class="math display">\sigma_x = \sqrt{\frac{82.5}{9}} = \sqrt{9.1667} = 3.026582</span></p>
<p>For Gallagher (<span class="math inline">Y</span>): <span class="math display">\sigma_Y = \sqrt{\frac{\sum_{i=1}^n (Y_i - \bar{Y})^2}{n-1}}</span></p>
<p><span class="math display">\sigma_y = \sqrt{\frac{12.8442}{9}} = \sqrt{1.4271} = 1.194612</span></p>
</section>
<section id="step-4-pearson-correlation-calculation" class="level3">
<h3 class="anchored" data-anchor-id="step-4-pearson-correlation-calculation">Step 4: Pearson Correlation Calculation</h3>
<p><span class="math display">r = \frac{\text{Cov}(X,Y)}{\sigma_X \sigma_Y}</span></p>
<p><span class="math display">r = \frac{-3.120556}{3.026582 \times 1.194612} = \frac{-3.120556}{3.615752} = -0.863044</span></p>
</section>
<section id="step-5-spearman-rank-correlation-calculation" class="level3">
<h3 class="anchored" data-anchor-id="step-5-spearman-rank-correlation-calculation">Step 5: Spearman Rank Correlation Calculation</h3>
<p>Complete ranking table with all calculations:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">i</span></th>
<th><span class="math inline">X_i</span></th>
<th><span class="math inline">Y_i</span></th>
<th>Rank <span class="math inline">X_i</span></th>
<th>Rank <span class="math inline">Y_i</span></th>
<th><span class="math inline">d_i</span></th>
<th><span class="math inline">d_i^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>18.2</td>
<td>1</td>
<td>10</td>
<td><span class="math inline">-9</span></td>
<td>81</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>16.7</td>
<td>2</td>
<td>9</td>
<td><span class="math inline">-7</span></td>
<td>49</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>15.8</td>
<td>3</td>
<td>8</td>
<td><span class="math inline">-5</span></td>
<td>25</td>
</tr>
<tr class="even">
<td>4</td>
<td>5</td>
<td>15.3</td>
<td>4</td>
<td>7</td>
<td><span class="math inline">-3</span></td>
<td>9</td>
</tr>
<tr class="odd">
<td>5</td>
<td>6</td>
<td>15.0</td>
<td>5</td>
<td>6</td>
<td><span class="math inline">-1</span></td>
<td>1</td>
</tr>
<tr class="even">
<td>6</td>
<td>7</td>
<td>14.8</td>
<td>6</td>
<td>5</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>7</td>
<td>8</td>
<td>14.7</td>
<td>7</td>
<td>4</td>
<td>3</td>
<td>9</td>
</tr>
<tr class="even">
<td>8</td>
<td>9</td>
<td>14.6</td>
<td>8</td>
<td>3</td>
<td>5</td>
<td>25</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10</td>
<td>14.55</td>
<td>9</td>
<td>2</td>
<td>7</td>
<td>49</td>
</tr>
<tr class="even">
<td>10</td>
<td>11</td>
<td>14.52</td>
<td>10</td>
<td>1</td>
<td>9</td>
<td>81</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>330</td>
</tr>
</tbody>
</table>
<p>Spearman correlation calculation: <span class="math display">\rho = 1 - \frac{6\sum d_i^2}{n(n^2-1)}</span></p>
<p><span class="math display">\rho = 1 - \frac{6 \times 330}{10(100 - 1)} = 1 - \frac{1980}{990} = 1 - 2 = -1</span></p>
</section>
<section id="step-6-r-verification" class="level3">
<h3 class="anchored" data-anchor-id="step-6-r-verification">Step 6: R Verification</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create vectors</span></span>
<span id="cb129-2"><a href="#cb129-2" aria-hidden="true" tabindex="-1"></a>DM <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>)</span>
<span id="cb129-3"><a href="#cb129-3" aria-hidden="true" tabindex="-1"></a>GH <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">18.2</span>, <span class="fl">16.7</span>, <span class="fl">15.8</span>, <span class="fl">15.3</span>, <span class="fl">15.0</span>, <span class="fl">14.8</span>, <span class="fl">14.7</span>, <span class="fl">14.6</span>, <span class="fl">14.55</span>, <span class="fl">14.52</span>)</span>
<span id="cb129-4"><a href="#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="#cb129-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate covariance</span></span>
<span id="cb129-6"><a href="#cb129-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(DM, GH)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -3.120556</code></pre>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate correlations</span></span>
<span id="cb131-2"><a href="#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(DM, GH, <span class="at">method =</span> <span class="st">"pearson"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.8627742</code></pre>
</div>
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(DM, GH, <span class="at">method =</span> <span class="st">"spearman"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1</code></pre>
</div>
</div>
</section>
<section id="step-7-basic-visualization" class="level3">
<h3 class="anchored" data-anchor-id="step-7-basic-visualization">Step 7: Basic Visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">DM =</span> DM, <span class="at">GH =</span> GH)</span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Create scatter plot</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> DM, <span class="at">y =</span> GH)) <span class="sc">+</span></span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb135-10"><a href="#cb135-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb135-11"><a href="#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"District Magnitude vs Gallagher Index"</span>,</span>
<span id="cb135-12"><a href="#cb135-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"District Magnitude (DM)"</span>,</span>
<span id="cb135-13"><a href="#cb135-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Gallagher Index (GH)"</span></span>
<span id="cb135-14"><a href="#cb135-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb135-15"><a href="#cb135-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="ols-estimation-and-goodness-of-fit-measures" class="level3">
<h3 class="anchored" data-anchor-id="ols-estimation-and-goodness-of-fit-measures">OLS Estimation and Goodness-of-Fit Measures</h3>
</section>
<section id="step-1-calculate-ols-estimates" class="level3">
<h3 class="anchored" data-anchor-id="step-1-calculate-ols-estimates">Step 1: Calculate OLS Estimates</h3>
<p>Using previously calculated values:</p>
<ul>
<li><span class="math inline">\sum(X_i - \bar{X})(Y_i - \bar{Y}) = -28.085</span></li>
<li><span class="math inline">\sum(X_i - \bar{X})^2 = 82.5</span></li>
<li><span class="math inline">\bar{X} = 6.5</span></li>
<li><span class="math inline">\bar{Y} = 15.417</span></li>
</ul>
<p>Calculate slope (<span class="math inline">\hat{\beta_1}</span>): <span class="math inline">\hat{\beta_1} = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{\sum(X_i - \bar{X})^2}</span></p>
<p><span class="math display">\hat{\beta_1} = -28,085 ÷ 82,5 = -0,3404</span></p>
<p>Calculate intercept (<span class="math inline">\hat{\beta_0}</span>): <span class="math inline">\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X}</span></p>
<p><span class="math display">\hat{\beta_0} = 15,417 - (-0,3404 × 6,5)
   = 15,417 + 2,2126
   = 17,6296</span></p>
<p>Therefore, the OLS regression equation is: <span class="math inline">\hat{Y} = 17.6296 - 0.3404X</span></p>
</section>
<section id="step-2-calculate-fitted-values-and-residuals" class="level3">
<h3 class="anchored" data-anchor-id="step-2-calculate-fitted-values-and-residuals">Step 2: Calculate Fitted Values and Residuals</h3>
<p>Complete table showing all calculations:</p>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th><span class="math inline">i</span></th>
<th><span class="math inline">X_i</span></th>
<th><span class="math inline">Y_i</span></th>
<th><span class="math inline">\hat{Y}_i</span></th>
<th><span class="math inline">e_i = Y_i - \hat{Y}_i</span></th>
<th><span class="math inline">e_i^2</span></th>
<th><span class="math inline">(Y_i - \bar{Y})^2</span></th>
<th><span class="math inline">(\hat{Y}_i - \bar{Y})^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>18.2</td>
<td>16.9488</td>
<td>1.2512</td>
<td>1.5655</td>
<td>7.7451</td>
<td>2.3404</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>16.7</td>
<td>16.6084</td>
<td>0.0916</td>
<td>0.0084</td>
<td>1.6461</td>
<td>1.4241</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>15.8</td>
<td>16.2680</td>
<td>-0.4680</td>
<td>0.2190</td>
<td>0.1467</td>
<td>0.7225</td>
</tr>
<tr class="even">
<td>4</td>
<td>5</td>
<td>15.3</td>
<td>15.9276</td>
<td>-0.6276</td>
<td>0.3939</td>
<td>0.0137</td>
<td>0.2601</td>
</tr>
<tr class="odd">
<td>5</td>
<td>6</td>
<td>15.0</td>
<td>15.5872</td>
<td>-0.5872</td>
<td>0.3448</td>
<td>0.1739</td>
<td>0.0289</td>
</tr>
<tr class="even">
<td>6</td>
<td>7</td>
<td>14.8</td>
<td>15.2468</td>
<td>-0.4468</td>
<td>0.1996</td>
<td>0.3807</td>
<td>0.0290</td>
</tr>
<tr class="odd">
<td>7</td>
<td>8</td>
<td>14.7</td>
<td>14.9064</td>
<td>-0.2064</td>
<td>0.0426</td>
<td>0.5141</td>
<td>0.2610</td>
</tr>
<tr class="even">
<td>8</td>
<td>9</td>
<td>14.6</td>
<td>14.5660</td>
<td>0.0340</td>
<td>0.0012</td>
<td>0.6675</td>
<td>0.7241</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10</td>
<td>14.55</td>
<td>14.2256</td>
<td>0.3244</td>
<td>0.1052</td>
<td>0.7517</td>
<td>1.4184</td>
</tr>
<tr class="even">
<td>10</td>
<td>11</td>
<td>14.52</td>
<td>13.8852</td>
<td>0.6348</td>
<td>0.4030</td>
<td>0.8047</td>
<td>2.3439</td>
</tr>
<tr class="odd">
<td>Sum</td>
<td>65</td>
<td>154.17</td>
<td>154.17</td>
<td>0</td>
<td>3.2832</td>
<td>12.8442</td>
<td>9.5524</td>
</tr>
</tbody>
</table>
<p>Calculations for fitted values:</p>
<pre><code>For X = 2:
Ŷ = 17.6296 + (-0.3404 × 2) = 16.9488

For X = 3:
Ŷ = 17.6296 + (-0.3404 × 3) = 16.6084

[... continue for all values]</code></pre>
</section>
<section id="step-3-calculate-goodness-of-fit-measures" class="level3">
<h3 class="anchored" data-anchor-id="step-3-calculate-goodness-of-fit-measures">Step 3: Calculate Goodness-of-Fit Measures</h3>
<p>Sum of Squared Errors (SSE): <span class="math inline">SSE = \sum e_i^2</span></p>
<pre><code>SSE = 3.2832</code></pre>
<p>Sum of Squared Total (SST): <span class="math inline">SST = \sum(Y_i - \bar{Y})^2</span></p>
<pre><code>SST = 12.8442</code></pre>
<p>Sum of Squared Regression (SSR): <span class="math inline">SSR = \sum(\hat{Y}_i - \bar{Y})^2</span></p>
<pre><code>SSR = 9.5524</code></pre>
<p>Verify decomposition: <span class="math inline">SST = SSR + SSE</span></p>
<pre><code>12.8442 = 9.5524 + 3.2832 (within rounding error)</code></pre>
<p>R-squared calculation: <span class="math inline">R^2 = \frac{SSR}{SST} = 1 - \frac{SSE}{SST}</span></p>
<pre><code>R² = 9.5524 ÷ 12.8442
   = 0.7438</code></pre>
</section>
<section id="step-4-r-verification" class="level3">
<h3 class="anchored" data-anchor-id="step-4-r-verification">Step 4: R Verification</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit linear model</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(GH <span class="sc">~</span> DM, <span class="at">data =</span> data)</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"># View summary statistics</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = GH ~ DM, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.62764 -0.46274 -0.08615  0.26624  1.25109 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 17.62976    0.50121  35.174 4.67e-10 ***
DM          -0.34042    0.07053  -4.827  0.00131 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6406 on 8 degrees of freedom
Multiple R-squared:  0.7444,    Adjusted R-squared:  0.7124 
F-statistic:  23.3 on 1 and 8 DF,  p-value: 0.00131</code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate R-squared manually</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a>SST <span class="ot">&lt;-</span> <span class="fu">sum</span>((GH <span class="sc">-</span> <span class="fu">mean</span>(GH))<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb145-3"><a href="#cb145-3" aria-hidden="true" tabindex="-1"></a>SSE <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">residuals</span>(model)<span class="sc">^</span><span class="dv">2</span>)</span>
<span id="cb145-4"><a href="#cb145-4" aria-hidden="true" tabindex="-1"></a>SSR <span class="ot">&lt;-</span> SST <span class="sc">-</span> SSE</span>
<span id="cb145-5"><a href="#cb145-5" aria-hidden="true" tabindex="-1"></a>R2_manual <span class="ot">&lt;-</span> SSR<span class="sc">/</span>SST</span>
<span id="cb145-6"><a href="#cb145-6" aria-hidden="true" tabindex="-1"></a>R2_manual</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.7443793</code></pre>
</div>
</div>
</section>
<section id="step-5-residual-analysis" class="level3">
<h3 class="anchored" data-anchor-id="step-5-residual-analysis">Step 5: Residual Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create residual plots</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-6-predicted-vs-actual-values-plot" class="level3">
<h3 class="anchored" data-anchor-id="step-6-predicted-vs-actual-values-plot">Step 6: Predicted vs Actual Values Plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create predicted vs actual plot</span></span>
<span id="cb148-2"><a href="#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(</span>
<span id="cb148-3"><a href="#cb148-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Actual =</span> GH,</span>
<span id="cb148-4"><a href="#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> <span class="fu">fitted</span>(model)</span>
<span id="cb148-5"><a href="#cb148-5" aria-hidden="true" tabindex="-1"></a>), <span class="fu">aes</span>(<span class="at">x =</span> Predicted, <span class="at">y =</span> Actual)) <span class="sc">+</span></span>
<span id="cb148-6"><a href="#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb148-7"><a href="#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb148-8"><a href="#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb148-9"><a href="#cb148-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Predicted vs Actual Values"</span>,</span>
<span id="cb148-10"><a href="#cb148-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Predicted Gallagher Index"</span>,</span>
<span id="cb148-11"><a href="#cb148-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Actual Gallagher Index"</span></span>
<span id="cb148-12"><a href="#cb148-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb148-13"><a href="#cb148-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="log-transformed-models" class="level3">
<h3 class="anchored" data-anchor-id="log-transformed-models">Log-Transformed Models</h3>
</section>
<section id="step-1-data-transformation" class="level3">
<h3 class="anchored" data-anchor-id="step-1-data-transformation">Step 1: Data Transformation</h3>
<p>First, calculate natural logarithms of variables:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math inline">i</span></th>
<th><span class="math inline">X_i</span></th>
<th><span class="math inline">Y_i</span></th>
<th><span class="math inline">\ln(X_i)</span></th>
<th><span class="math inline">\ln(Y_i)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>18.2</td>
<td>0.6931</td>
<td>2.9014</td>
</tr>
<tr class="even">
<td>2</td>
<td>3</td>
<td>16.7</td>
<td>1.0986</td>
<td>2.8154</td>
</tr>
<tr class="odd">
<td>3</td>
<td>4</td>
<td>15.8</td>
<td>1.3863</td>
<td>2.7600</td>
</tr>
<tr class="even">
<td>4</td>
<td>5</td>
<td>15.3</td>
<td>1.6094</td>
<td>2.7278</td>
</tr>
<tr class="odd">
<td>5</td>
<td>6</td>
<td>15.0</td>
<td>1.7918</td>
<td>2.7081</td>
</tr>
<tr class="even">
<td>6</td>
<td>7</td>
<td>14.8</td>
<td>1.9459</td>
<td>2.6946</td>
</tr>
<tr class="odd">
<td>7</td>
<td>8</td>
<td>14.7</td>
<td>2.0794</td>
<td>2.6878</td>
</tr>
<tr class="even">
<td>8</td>
<td>9</td>
<td>14.6</td>
<td>2.1972</td>
<td>2.6810</td>
</tr>
<tr class="odd">
<td>9</td>
<td>10</td>
<td>14.55</td>
<td>2.3026</td>
<td>2.6777</td>
</tr>
<tr class="even">
<td>10</td>
<td>11</td>
<td>14.52</td>
<td>2.3979</td>
<td>2.6757</td>
</tr>
</tbody>
</table>
</section>
<section id="step-2-compare-different-model-specifications" class="level3">
<h3 class="anchored" data-anchor-id="step-2-compare-different-model-specifications">Step 2: Compare Different Model Specifications</h3>
<p>We estimate three alternative specifications:</p>
<ol type="1">
<li>Log-linear model: <span class="math inline">\ln(Y_i) = \beta_0 + \beta_1 X_i + \epsilon_i</span></li>
<li>Linear-log model: <span class="math inline">Y_i = \beta_0 + \beta_1\ln(X_i) + \epsilon_i</span></li>
<li>Log-log model: <span class="math inline">\ln(Y_i) = \beta_0 + \beta_1\ln(X_i) + \epsilon_i</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create transformed variables</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>log_DM <span class="ot">&lt;-</span> <span class="fu">log</span>(data<span class="sc">$</span>DM)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a>data<span class="sc">$</span>log_GH <span class="ot">&lt;-</span> <span class="fu">log</span>(data<span class="sc">$</span>GH)</span>
<span id="cb149-4"><a href="#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="#cb149-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Fit models</span></span>
<span id="cb149-6"><a href="#cb149-6" aria-hidden="true" tabindex="-1"></a>model_linear <span class="ot">&lt;-</span> <span class="fu">lm</span>(GH <span class="sc">~</span> DM, <span class="at">data =</span> data)</span>
<span id="cb149-7"><a href="#cb149-7" aria-hidden="true" tabindex="-1"></a>model_loglinear <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_GH <span class="sc">~</span> DM, <span class="at">data =</span> data)</span>
<span id="cb149-8"><a href="#cb149-8" aria-hidden="true" tabindex="-1"></a>model_linearlog <span class="ot">&lt;-</span> <span class="fu">lm</span>(GH <span class="sc">~</span> log_DM, <span class="at">data =</span> data)</span>
<span id="cb149-9"><a href="#cb149-9" aria-hidden="true" tabindex="-1"></a>model_loglog <span class="ot">&lt;-</span> <span class="fu">lm</span>(log_GH <span class="sc">~</span> log_DM, <span class="at">data =</span> data)</span>
<span id="cb149-10"><a href="#cb149-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-11"><a href="#cb149-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Compare R-squared values</span></span>
<span id="cb149-12"><a href="#cb149-12" aria-hidden="true" tabindex="-1"></a>models_comparison <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb149-13"><a href="#cb149-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">c</span>(<span class="st">"Linear"</span>, <span class="st">"Log-linear"</span>, <span class="st">"Linear-log"</span>, <span class="st">"Log-log"</span>),</span>
<span id="cb149-14"><a href="#cb149-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">R_squared =</span> <span class="fu">c</span>(</span>
<span id="cb149-15"><a href="#cb149-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_linear)<span class="sc">$</span>r.squared,</span>
<span id="cb149-16"><a href="#cb149-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_loglinear)<span class="sc">$</span>r.squared,</span>
<span id="cb149-17"><a href="#cb149-17" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_linearlog)<span class="sc">$</span>r.squared,</span>
<span id="cb149-18"><a href="#cb149-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summary</span>(model_loglog)<span class="sc">$</span>r.squared</span>
<span id="cb149-19"><a href="#cb149-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb149-20"><a href="#cb149-20" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb149-21"><a href="#cb149-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-22"><a href="#cb149-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Display comparison</span></span>
<span id="cb149-23"><a href="#cb149-23" aria-hidden="true" tabindex="-1"></a>models_comparison</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Model R_squared
1     Linear 0.7443793
2 Log-linear 0.7670346
3 Linear-log 0.9141560
4    Log-log 0.9288088</code></pre>
</div>
</div>
</section>
<section id="step-3-visual-comparison" class="level3">
<h3 class="anchored" data-anchor-id="step-3-visual-comparison">Step 3: Visual Comparison</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plots for each model</span></span>
<span id="cb151-2"><a href="#cb151-2" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> DM, <span class="at">y =</span> GH)) <span class="sc">+</span></span>
<span id="cb151-3"><a href="#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-4"><a href="#cb151-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb151-5"><a href="#cb151-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear Model"</span>) <span class="sc">+</span></span>
<span id="cb151-6"><a href="#cb151-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb151-7"><a href="#cb151-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-8"><a href="#cb151-8" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> DM, <span class="at">y =</span> log_GH)) <span class="sc">+</span></span>
<span id="cb151-9"><a href="#cb151-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-10"><a href="#cb151-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb151-11"><a href="#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log-linear Model"</span>) <span class="sc">+</span></span>
<span id="cb151-12"><a href="#cb151-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb151-13"><a href="#cb151-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-14"><a href="#cb151-14" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> log_DM, <span class="at">y =</span> GH)) <span class="sc">+</span></span>
<span id="cb151-15"><a href="#cb151-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-16"><a href="#cb151-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb151-17"><a href="#cb151-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Linear-log Model"</span>) <span class="sc">+</span></span>
<span id="cb151-18"><a href="#cb151-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb151-19"><a href="#cb151-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-20"><a href="#cb151-20" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> log_DM, <span class="at">y =</span> log_GH)) <span class="sc">+</span></span>
<span id="cb151-21"><a href="#cb151-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb151-22"><a href="#cb151-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb151-23"><a href="#cb151-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Log-log Model"</span>) <span class="sc">+</span></span>
<span id="cb151-24"><a href="#cb151-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb151-25"><a href="#cb151-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-26"><a href="#cb151-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Arrange plots in a grid</span></span>
<span id="cb151-27"><a href="#cb151-27" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gridExtra)</span>
<span id="cb151-28"><a href="#cb151-28" aria-hidden="true" tabindex="-1"></a><span class="fu">grid.arrange</span>(p1, p2, p3, p4, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'
`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-4-residual-analysis-for-best-model" class="level3">
<h3 class="anchored" data-anchor-id="step-4-residual-analysis-for-best-model">Step 4: Residual Analysis for Best Model</h3>
<p>Based on R-squared values, analyze residuals for the best-fitting model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residual plots for best model</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model_linearlog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-5-interpretation-of-best-model" class="level3">
<h3 class="anchored" data-anchor-id="step-5-interpretation-of-best-model">Step 5: Interpretation of Best Model</h3>
<p>The linear-log model coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb154"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb154-1"><a href="#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_linearlog)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = GH ~ log_DM, data = data)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.40702 -0.30207 -0.04907  0.22905  0.60549 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  19.0223     0.4079   46.64 4.94e-11 ***
log_DM       -2.0599     0.2232   -9.23 1.54e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.3712 on 8 degrees of freedom
Multiple R-squared:  0.9142,    Adjusted R-squared:  0.9034 
F-statistic: 85.19 on 1 and 8 DF,  p-value: 1.539e-05</code></pre>
</div>
</div>
<p>Interpretation: - <span class="math inline">\hat{\beta_0}</span> represents the expected Gallagher Index when ln(DM) = 0 (i.e., when DM = 1) - <span class="math inline">\hat{\beta_1}</span> represents the change in Gallagher Index associated with a one-unit increase in ln(DM)</p>
</section>
<section id="step-6-model-predictions" class="level3">
<h3 class="anchored" data-anchor-id="step-6-model-predictions">Step 6: Model Predictions</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb156"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb156-1"><a href="#cb156-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create prediction plot for best model</span></span>
<span id="cb156-2"><a href="#cb156-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> log_DM, <span class="at">y =</span> GH)) <span class="sc">+</span></span>
<span id="cb156-3"><a href="#cb156-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb156-4"><a href="#cb156-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">TRUE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb156-5"><a href="#cb156-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb156-6"><a href="#cb156-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Linear-log Model: Gallagher Index vs ln(District Magnitude)"</span>,</span>
<span id="cb156-7"><a href="#cb156-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"ln(District Magnitude)"</span>,</span>
<span id="cb156-8"><a href="#cb156-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Gallagher Index"</span></span>
<span id="cb156-9"><a href="#cb156-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb156-10"><a href="#cb156-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`geom_smooth()` using formula = 'y ~ x'</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="step-7-elasticity-analysis" class="level3">
<h3 class="anchored" data-anchor-id="step-7-elasticity-analysis">Step 7: Elasticity Analysis</h3>
<p>For the log-log model, coefficients represent elasticities directly. Calculate average elasticity for the linear-log model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb158"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb158-1"><a href="#cb158-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate elasticity at means</span></span>
<span id="cb158-2"><a href="#cb158-2" aria-hidden="true" tabindex="-1"></a>mean_DM <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>DM)</span>
<span id="cb158-3"><a href="#cb158-3" aria-hidden="true" tabindex="-1"></a>mean_GH <span class="ot">&lt;-</span> <span class="fu">mean</span>(data<span class="sc">$</span>GH)</span>
<span id="cb158-4"><a href="#cb158-4" aria-hidden="true" tabindex="-1"></a>beta1 <span class="ot">&lt;-</span> <span class="fu">coef</span>(model_linearlog)[<span class="dv">2</span>]</span>
<span id="cb158-5"><a href="#cb158-5" aria-hidden="true" tabindex="-1"></a>elasticity <span class="ot">&lt;-</span> beta1 <span class="sc">*</span> (<span class="dv">1</span><span class="sc">/</span>mean_GH)</span>
<span id="cb158-6"><a href="#cb158-6" aria-hidden="true" tabindex="-1"></a>elasticity</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    log_DM 
-0.1336136 </code></pre>
</div>
</div>
<p>This represents the percentage change in the Gallagher Index for a 1% change in District Magnitude.</p>
</section>
</section>
<section id="appendix-a.3-understanding-pearson-spearman-and-kendall" class="level2" data-number="15.17">
<h2 data-number="15.17" class="anchored" data-anchor-id="appendix-a.3-understanding-pearson-spearman-and-kendall"><span class="header-section-number">15.17</span> Appendix A.3: Understanding Pearson, Spearman, and Kendall</h2>
<section id="dataset" class="level3">
<h3 class="anchored" data-anchor-id="dataset">Dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb160"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb160-1"><a href="#cb160-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb160-2"><a href="#cb160-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">3</span>, <span class="dv">8</span>),</span>
<span id="cb160-3"><a href="#cb160-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">7</span>)</span>
<span id="cb160-4"><a href="#cb160-4" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="pearson-correlation-1" class="level3">
<h3 class="anchored" data-anchor-id="pearson-correlation-1">Pearson Correlation</h3>
<p><span class="math display"> r = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum (x_i - \bar{x})^2 \sum (y_i - \bar{y})^2}} </span></p>
<section id="step-by-step-calculations" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-calculations">Step-by-Step Calculations:</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th>i</th>
<th><span class="math inline">x_i</span></th>
<th><span class="math inline">y_i</span></th>
<th><span class="math inline">x_i - \bar{x}</span></th>
<th><span class="math inline">y_i - \bar{y}</span></th>
<th><span class="math inline">(x_i - \bar{x})(y_i - \bar{y})</span></th>
<th><span class="math inline">(x_i - \bar{x})^2</span></th>
<th><span class="math inline">(y_i - \bar{y})^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>3</td>
<td>-2.4</td>
<td>-1.6</td>
<td>3.84</td>
<td>5.76</td>
<td>2.56</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>5</td>
<td>-0.4</td>
<td>0.4</td>
<td>-0.16</td>
<td>0.16</td>
<td>0.16</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>4</td>
<td>0.6</td>
<td>-0.6</td>
<td>-0.36</td>
<td>0.36</td>
<td>0.36</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>4</td>
<td>-1.4</td>
<td>-0.6</td>
<td>0.84</td>
<td>1.96</td>
<td>0.36</td>
</tr>
<tr class="odd">
<td>5</td>
<td>8</td>
<td>7</td>
<td>3.6</td>
<td>2.4</td>
<td>8.64</td>
<td>12.96</td>
<td>5.76</td>
</tr>
<tr class="even">
<td>Sum</td>
<td>22</td>
<td>23</td>
<td>0</td>
<td>0</td>
<td>12.8</td>
<td>21.2</td>
<td>9.2</td>
</tr>
</tbody>
</table>
<p><span class="math inline">\bar{x} = 4.4</span> <span class="math inline">\bar{y} = 4.6</span></p>
<p><span class="math display"> r = \frac{12.8}{\sqrt{21.2 \times 9.2}} = \frac{12.8}{\sqrt{195.04}} = \frac{12.8}{13.97} = 0.92 </span></p>
</section>
</section>
<section id="spearman-correlation-1" class="level3">
<h3 class="anchored" data-anchor-id="spearman-correlation-1">Spearman Correlation</h3>
<p><span class="math display"> \rho = 1 - \frac{6\sum d_i^2}{n(n^2-1)} </span></p>
<section id="step-by-step-calculations-1" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-calculations-1">Step-by-Step Calculations:</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>i</th>
<th><span class="math inline">x_i</span></th>
<th><span class="math inline">y_i</span></th>
<th>Rank <span class="math inline">x_i</span></th>
<th>Rank <span class="math inline">y_i</span></th>
<th><span class="math inline">d_i</span></th>
<th><span class="math inline">d_i^2</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>2</td>
<td>3</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr class="even">
<td>2</td>
<td>4</td>
<td>5</td>
<td>3</td>
<td>5</td>
<td>-2</td>
<td>4</td>
</tr>
<tr class="odd">
<td>3</td>
<td>5</td>
<td>4</td>
<td>4</td>
<td>2.5</td>
<td>1.5</td>
<td>2.25</td>
</tr>
<tr class="even">
<td>4</td>
<td>3</td>
<td>4</td>
<td>2</td>
<td>2.5</td>
<td>-0.5</td>
<td>0.25</td>
</tr>
<tr class="odd">
<td>5</td>
<td>8</td>
<td>7</td>
<td>5</td>
<td>4</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="even">
<td>Sum</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td>7.5</td>
</tr>
</tbody>
</table>
<p><span class="math display"> \rho = 1 - \frac{6(7.5)}{5(25-1)} = 1 - \frac{45}{120} = 0.82 </span></p>
</section>
</section>
<section id="kendalls-tau" class="level3">
<h3 class="anchored" data-anchor-id="kendalls-tau">Kendall’s Tau</h3>
<p><span class="math display"> \tau = \frac{\text{number of concordant pairs} - \text{number of discordant pairs}}{\frac{1}{2}n(n-1)} </span></p>
<section id="step-by-step-calculations-2" class="level4">
<h4 class="anchored" data-anchor-id="step-by-step-calculations-2">Step-by-Step Calculations:</h4>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Pair (i,j)</th>
<th><span class="math inline">x_i,x_j</span></th>
<th><span class="math inline">y_i,y_j</span></th>
<th><span class="math inline">x_j-x_i</span></th>
<th><span class="math inline">y_j-y_i</span></th>
<th>Result</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>(1,2)</td>
<td>2,4</td>
<td>3,5</td>
<td>+2</td>
<td>+2</td>
<td>C</td>
</tr>
<tr class="even">
<td>(1,3)</td>
<td>2,5</td>
<td>3,4</td>
<td>+3</td>
<td>+1</td>
<td>C</td>
</tr>
<tr class="odd">
<td>(1,4)</td>
<td>2,3</td>
<td>3,4</td>
<td>+1</td>
<td>+1</td>
<td>C</td>
</tr>
<tr class="even">
<td>(1,5)</td>
<td>2,8</td>
<td>3,7</td>
<td>+6</td>
<td>+4</td>
<td>C</td>
</tr>
<tr class="odd">
<td>(2,3)</td>
<td>4,5</td>
<td>5,4</td>
<td>+1</td>
<td>-1</td>
<td>D</td>
</tr>
<tr class="even">
<td>(2,4)</td>
<td>4,3</td>
<td>5,4</td>
<td>-1</td>
<td>-1</td>
<td>C</td>
</tr>
<tr class="odd">
<td>(2,5)</td>
<td>4,8</td>
<td>5,7</td>
<td>+4</td>
<td>+2</td>
<td>C</td>
</tr>
<tr class="even">
<td>(3,4)</td>
<td>5,3</td>
<td>4,4</td>
<td>-2</td>
<td>0</td>
<td>D</td>
</tr>
<tr class="odd">
<td>(3,5)</td>
<td>5,8</td>
<td>4,7</td>
<td>+3</td>
<td>+3</td>
<td>C</td>
</tr>
<tr class="even">
<td>(4,5)</td>
<td>3,8</td>
<td>4,7</td>
<td>+5</td>
<td>+3</td>
<td>C</td>
</tr>
</tbody>
</table>
<p>Number of concordant pairs = 8 Number of discordant pairs = 2 <span class="math display"> \tau = \frac{8-2}{10} = 0.74 </span></p>
</section>
</section>
<section id="verification-in-r" class="level3">
<h3 class="anchored" data-anchor-id="verification-in-r">Verification in R</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Pearson:"</span>, <span class="fu">round</span>(<span class="fu">cor</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y, <span class="at">method=</span><span class="st">"pearson"</span>), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Pearson: 0.92 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb163"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb163-1"><a href="#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Spearman:"</span>, <span class="fu">round</span>(<span class="fu">cor</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y, <span class="at">method=</span><span class="st">"spearman"</span>), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Spearman: 0.82 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb165"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb165-1"><a href="#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Kendall:"</span>, <span class="fu">round</span>(<span class="fu">cor</span>(data<span class="sc">$</span>x, data<span class="sc">$</span>y, <span class="at">method=</span><span class="st">"kendall"</span>), <span class="dv">2</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Kendall: 0.74 </code></pre>
</div>
</div>
</section>
<section id="interpretation-of-results" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-of-results">Interpretation of Results</h3>
<ol type="1">
<li><strong>Pearson Correlation (r = 0.92)</strong>
<ul>
<li>Strong positive linear correlation</li>
<li>Indicates a very strong linear relationship between variables</li>
</ul></li>
<li><strong>Spearman Correlation (ρ = 0.82)</strong>
<ul>
<li>Also strong positive correlation</li>
<li>Slightly lower than Pearson’s, suggesting some deviations from monotonicity</li>
</ul></li>
<li><strong>Kendall’s Tau (τ = 0.74)</strong>
<ul>
<li>Lowest of the three values, but still indicates strong association</li>
<li>More robust to outliers</li>
</ul></li>
</ol>
</section>
<section id="comparison-of-measures" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-measures">Comparison of Measures</h3>
<ol type="1">
<li><strong>Differences in Values:</strong>
<ul>
<li>Pearson (0.92) - highest value, strong linearity</li>
<li>Spearman (0.82) - considers only ranking</li>
<li>Kendall (0.74) - most conservative measure</li>
</ul></li>
<li><strong>Practical Application:</strong>
<ul>
<li>All measures confirm strong positive association</li>
<li>Differences between measures indicate slight deviations from perfect linearity</li>
<li>Kendall provides the most conservative estimate of relationship strength</li>
</ul></li>
</ol>
</section>
<section id="exercises" class="level3">
<h3 class="anchored" data-anchor-id="exercises">Exercises</h3>
<ol type="1">
<li>Change y[3] from 4 to 6 and recalculate all three correlations</li>
<li>Add an outlier (x=10, y=2) and recalculate correlations</li>
<li>Compare which measure is most sensitive to changes in the data</li>
</ol>
</section>
<section id="key-points-to-remember" class="level3">
<h3 class="anchored" data-anchor-id="key-points-to-remember">Key Points to Remember</h3>
<ol type="1">
<li><strong>Pearson Correlation:</strong>
<ul>
<li>Measures linear relationship</li>
<li>Most sensitive to outliers</li>
<li>Requires interval or ratio data</li>
</ul></li>
<li><strong>Spearman Correlation:</strong>
<ul>
<li>Measures monotonic relationship</li>
<li>Less sensitive to outliers</li>
<li>Works with ordinal data</li>
</ul></li>
<li><strong>Kendall’s Tau:</strong>
<ul>
<li>Measures ordinal association</li>
<li>Most robust to outliers</li>
<li>Best for small samples and tied ranks</li>
</ul></li>
</ol>
</section>
</section>
<section id="appendix-b-bias-in-ols-estimation-with-endogenous-regressors" class="level2" data-number="15.18">
<h2 data-number="15.18" class="anchored" data-anchor-id="appendix-b-bias-in-ols-estimation-with-endogenous-regressors"><span class="header-section-number">15.18</span> Appendix B: Bias in OLS Estimation with Endogenous Regressors</h2>
<p>In this tutorial, we will explore the bias in Ordinary Least Squares (OLS) estimation when the error term is correlated with the explanatory variable, a situation known as endogeneity. We will first derive the bias mathematically and then illustrate it using a simulated dataset in R.</p>
</section>
<section id="theoretical-derivation" class="level2" data-number="15.19">
<h2 data-number="15.19" class="anchored" data-anchor-id="theoretical-derivation"><span class="header-section-number">15.19</span> Theoretical Derivation</h2>
<p>Consider a data generating process (DGP) where the true relationship between <span class="math inline">x</span> and <span class="math inline">y</span> is:</p>
<p><span class="math display"> y = 2x + e </span></p>
<p>However, there is an endogeneity problem because the error term <span class="math inline">e</span> is correlated with <span class="math inline">x</span> in the following way:</p>
<p><span class="math display"> e = 1x + u </span></p>
<p>where <span class="math inline">u</span> is an independent error term.</p>
<p>If we estimate the simple linear model <span class="math inline">y = \hat{\beta_0} + \hat{\beta_1}x + \varepsilon</span> using OLS, the OLS estimator of <span class="math inline">\hat{\beta_1}</span> will be biased due to the endogeneity issue.</p>
<p>To understand the bias, let’s derive the expected value of the OLS estimator <span class="math inline">\hat{\beta}_1</span>:</p>
<p><span class="math display">\begin{align*}
E[\hat{\beta}_1] &amp;= E[(X'X)^{-1}X'y] \\
                 &amp;= E[(X'X)^{-1}X'(2x + 1x + u)] \\
                 &amp;= E[(X'X)^{-1}X'(3x + u)] \\
                 &amp;= 3 + E[(X'X)^{-1}X'u]
\end{align*}</span></p>
<p>If the error term <span class="math inline">u</span> is uncorrelated with <span class="math inline">x</span>, then <span class="math inline">E[(X'X)^{-1}X'u] = 0</span>, and the OLS estimator would be unbiased: <span class="math inline">E[\hat{\beta}_1] = 3</span>. However, in this case, the original error term <span class="math inline">e</span> is correlated with <span class="math inline">x</span>, so <span class="math inline">u</span> is also likely to be correlated with <span class="math inline">x</span>.</p>
<p>Assuming <span class="math inline">E[(X'X)^{-1}X'u] \neq 0</span>, the OLS estimator will be biased:</p>
<p><span class="math display">\begin{align*}
\text{Bias}(\hat{\beta}_1) &amp;= E[\hat{\beta}_1] - \beta_{1,\text{true}} \\
                           &amp;= 3 + E[(X'X)^{-1}X'u] - 2 \\
                           &amp;= 1 + E[(X'X)^{-1}X'u]
\end{align*}</span></p>
<p>The direction and magnitude of the bias will depend on the correlation between <span class="math inline">x</span> and <span class="math inline">u</span>. If <span class="math inline">x</span> and <span class="math inline">u</span> are positively correlated, the bias will be positive, and the OLS estimator will overestimate the true coefficient. Conversely, if <span class="math inline">x</span> and <span class="math inline">u</span> are negatively correlated, the bias will be negative, and the OLS estimator will underestimate the true coefficient.</p>
</section>
<section id="simulation-in-r" class="level2" data-number="15.20">
<h2 data-number="15.20" class="anchored" data-anchor-id="simulation-in-r"><span class="header-section-number">15.20</span> Simulation in R</h2>
<p>Let’s create a simple dataset with 10 observations where <span class="math inline">x</span> is in the interval 1:10, and generate <span class="math inline">y</span> values based on the given DGP: <span class="math inline">y = 2x + e</span>, where <span class="math inline">e = 1x + u</span>, and <span class="math inline">u</span> is a random error term.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a>u <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a>e <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">*</span>x <span class="sc">+</span> u</span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co"># e &lt;- 1*x</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span>x <span class="sc">+</span> e</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-8"><a href="#cb167-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate the data frame</span></span>
<span id="cb167-9"><a href="#cb167-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)</span>
<span id="cb167-10"><a href="#cb167-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-11"><a href="#cb167-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate the OLS model</span></span>
<span id="cb167-12"><a href="#cb167-12" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(y <span class="sc">~</span> x, <span class="at">data =</span> data)</span>
<span id="cb167-13"><a href="#cb167-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-14"><a href="#cb167-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Print the model summary</span></span>
<span id="cb167-15"><a href="#cb167-15" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = y ~ x, data = data)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.1348 -0.5624 -0.1393  0.3854  1.6814 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   0.5255     0.6673   0.787    0.454    
x             2.9180     0.1075  27.134 3.67e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9768 on 8 degrees of freedom
Multiple R-squared:  0.9893,    Adjusted R-squared:  0.9879 
F-statistic: 736.3 on 1 and 8 DF,  p-value: 3.666e-09</code></pre>
</div>
</div>
<p>In this example, the true relationship is <span class="math inline">y = 2x + e</span>, where <span class="math inline">e = 1x + u</span>. However, when we estimate the OLS model, we get:</p>
<p><span class="math display"> \hat{y} = 0.18376 + 3.05874x </span></p>
<p>The estimated coefficient for <span class="math inline">x</span> is 3.05874, which is biased upward from the true value of 2. This bias is due to the correlation between the error term <span class="math inline">e</span> and the explanatory variable <span class="math inline">x</span>.</p>
<p>To visualize the bias using ggplot2, we can plot the true relationship (<span class="math inline">y = 2x</span>) and the estimated OLS relationship:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y)) <span class="sc">+</span></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="fu">coef</span>(model)[<span class="dv">1</span>], <span class="at">slope =</span> <span class="fu">coef</span>(model)[<span class="dv">2</span>], <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"True vs. Estimated Relationship"</span>, <span class="at">x =</span> <span class="st">"x"</span>, <span class="at">y =</span> <span class="st">"y"</span>) <span class="sc">+</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">"Lines"</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), </span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"True"</span>, <span class="st">"OLS"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot will show that the estimated OLS line (red) is steeper than the true relationship line (blue), illustrating the upward bias in the estimated coefficient.</p>
</section>
<section id="conclusion-2" class="level2" data-number="15.21">
<h2 data-number="15.21" class="anchored" data-anchor-id="conclusion-2"><span class="header-section-number">15.21</span> Conclusion</h2>
<p>In summary, when the error term is correlated with the explanatory variable (endogeneity), the OLS estimator will be biased. The direction and magnitude of the bias depend on the nature of the correlation between the error term and the explanatory variable. This tutorial demonstrated the bias both mathematically and through a simulated example in R, using ggplot2 for visualization.</p>
</section>
<section id="appendix-c.-worked-examples" class="level2" data-number="15.22">
<h2 data-number="15.22" class="anchored" data-anchor-id="appendix-c.-worked-examples"><span class="header-section-number">15.22</span> Appendix C. Worked Examples</h2>
</section>
<section id="descriptive-statistics-and-ols-example---income-and-voter-turnout" class="level2" data-number="15.23">
<h2 data-number="15.23" class="anchored" data-anchor-id="descriptive-statistics-and-ols-example---income-and-voter-turnout"><span class="header-section-number">15.23</span> Descriptive Statistics and OLS Example - Income and Voter Turnout</h2>
<p><strong>Background</strong></p>
<p>In preparation for the 2024 municipal elections, the Amsterdam Electoral Commission conducted research on voter participation patterns across different city neighborhoods. A key question emerged:</p>
<p>Does economic prosperity of a neighborhood correlate with civic engagement, specifically voter turnout?</p>
<p><strong>Data Collection</strong></p>
<p>Sample: 5 representative neighborhoods in Amsterdam</p>
<p>Time Period: Data from the 2022 municipal elections</p>
<p>Variables:</p>
<ul>
<li>Income: Average annual household income per capita (thousands €)</li>
<li>Turnout: Percentage of registered voters who voted in the election</li>
</ul>
<section id="initial-r-output-for-reference" class="level3">
<h3 class="anchored" data-anchor-id="initial-r-output-for-reference">Initial R Output for Reference</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb170"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb170-1"><a href="#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb170-2"><a href="#cb170-2" aria-hidden="true" tabindex="-1"></a>income <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">50</span>, <span class="dv">45</span>, <span class="dv">56</span>, <span class="dv">40</span>, <span class="dv">60</span>)  <span class="co"># thousands €</span></span>
<span id="cb170-3"><a href="#cb170-3" aria-hidden="true" tabindex="-1"></a>turnout <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">60</span>, <span class="dv">56</span>, <span class="dv">70</span>, <span class="dv">50</span>, <span class="dv">75</span>) <span class="co"># %</span></span>
<span id="cb170-4"><a href="#cb170-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb170-5"><a href="#cb170-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Full model check</span></span>
<span id="cb170-6"><a href="#cb170-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(turnout <span class="sc">~</span> income)</span>
<span id="cb170-7"><a href="#cb170-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = turnout ~ income)

Residuals:
      1       2       3       4       5 
-1.9486  0.3359  0.5100  0.6204  0.4824 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -0.89647    3.96731  -0.226 0.835748    
income       1.25690    0.07822  16.068 0.000524 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.263 on 3 degrees of freedom
Multiple R-squared:  0.9885,    Adjusted R-squared:  0.9847 
F-statistic: 258.2 on 1 and 3 DF,  p-value: 0.0005243</code></pre>
</div>
</div>
</section>
<section id="dispersion-measures" class="level3">
<h3 class="anchored" data-anchor-id="dispersion-measures">Dispersion Measures</h3>
<p><strong>Means:</strong></p>
<p><span class="math display">\bar{X} = \frac{\sum_{i=1}^n X_i}{n} = \frac{50 + 45 + 56 + 40 + 60}{5} = \frac{251}{5} = 50.2</span></p>
<p><span class="math display">\bar{Y} = \frac{\sum_{i=1}^n Y_i}{n} = \frac{60 + 56 + 70 + 50 + 75}{5} = \frac{311}{5} = 62.2</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(income)  <span class="co"># 50.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 50.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(turnout) <span class="co"># 62.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 62.2</code></pre>
</div>
</div>
<p><strong>Variances:</strong></p>
<p><span class="math display">s^2_X = \frac{\sum(X_i - \bar{X})^2}{n-1}</span></p>
<p>Deviations for X: <span class="math inline">(-0.2, -5.2, 5.8, -10.2, 9.8)</span></p>
<p><span class="math display">s^2_X = \frac{0.04 + 27.04 + 33.64 + 104.04 + 96.04}{4} = \frac{260.8}{4} = 65.2</span></p>
<p>Deviations for Y: <span class="math inline">(-2.2, -6.2, 7.8, -12.2, 12.8)</span></p>
<p><span class="math display">s^2_Y = \frac{4.84 + 38.44 + 60.84 + 148.84 + 163.84}{4} = \frac{416.8}{4} = 104.2</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(income)  <span class="co"># 65.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 65.2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(turnout) <span class="co"># 104.2</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 104.2</code></pre>
</div>
</div>
</section>
<section id="covariance-and-correlation" class="level3">
<h3 class="anchored" data-anchor-id="covariance-and-correlation">Covariance and Correlation</h3>
<p><strong>Covariance:</strong></p>
<p><span class="math display">s_{XY} = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{n-1}</span></p>
<p>Products of deviations:</p>
<p><span class="math display">(-0.2 \times -2.2) = 0.44</span> <span class="math display">(-5.2 \times -6.2) = 32.24</span> <span class="math display">(5.8 \times 7.8) = 45.24</span> <span class="math display">(-10.2 \times -12.2) = 124.44</span> <span class="math display">(9.8 \times 12.8) = 125.44</span></p>
<p><span class="math display">s_{XY} = \frac{327.8}{4} = 81.95</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(income, turnout) <span class="co"># 81.95</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 81.95</code></pre>
</div>
</div>
<p><strong>Correlation:</strong></p>
<p><span class="math display">r_{XY} = \frac{s_{XY}}{\sqrt{s^2_X}\sqrt{s^2_Y}} = \frac{81.95}{\sqrt{65.2}\sqrt{104.2}} = 0.994</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(income, turnout) <span class="co"># 0.994</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9942402</code></pre>
</div>
</div>
</section>
<section id="ols-regression-haty-hatbeta_0-hatbeta_1x" class="level3">
<h3 class="anchored" data-anchor-id="ols-regression-haty-hatbeta_0-hatbeta_1x">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></h3>
<p><strong>Slope coefficient:</strong></p>
<p><span class="math display">\hat{\beta_1} = \frac{s_{XY}}{s^2_X} = \frac{81.95}{65.2} = 1.2571429</span></p>
<p><strong>Intercept:</strong></p>
<p><span class="math display">\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X}</span></p>
<p>Step by step:</p>
<ol type="1">
<li><span class="math display">1.2571429 \times 50.2 = 63.1085714</span></li>
<li><span class="math display">\hat{\beta_0} = 62.2 - 63.1085714 = -0.9085714</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)  <span class="co"># Exact coefficients from R</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)      income 
 -0.8964724   1.2569018 </code></pre>
</div>
</div>
</section>
<section id="detailed-decomposition-of-variance-and-r-squared" class="level3">
<h3 class="anchored" data-anchor-id="detailed-decomposition-of-variance-and-r-squared">Detailed Decomposition of Variance and R-squared</h3>
<p><strong>Step 1: Calculate predicted values</strong> <span class="math inline">(\hat{Y})</span>:</p>
<p><span class="math display"> \hat{Y} = -0.9085714 + 1.2571429X</span></p>
<p>The predicted values <span class="math inline">\hat{Y}</span> for each <span class="math inline">X</span> value:</p>
<p>For <span class="math inline">X = 50</span>:</p>
<p><span class="math display">
\hat{Y} = -0.9085714 + 1.2571429 \times (50)
</span> <span class="math display">\hat{Y} = -0.9085714 + 62.857145</span> <span class="math display">\hat{Y} = 61.9485736</span></p>
<p>For <span class="math inline">X = 45</span>:</p>
<p><span class="math display">
\hat{Y} = -0.9085714 + 1.2571429 \times (45)
</span> <span class="math display">\hat{Y} = -0.9085714 + 56.5714305</span> <span class="math display">\hat{Y} = 55.6535591</span></p>
<p>For <span class="math inline">X = 56</span>:</p>
<p><span class="math display">
\hat{Y} = -0.9085714 + 1.2571429 \times (56)
</span> <span class="math display">\hat{Y} = -0.9085714 + 70.4200024</span> <span class="math display">\hat{Y} = 69.5114310</span></p>
<p>For <span class="math inline">X = 40</span>:</p>
<p><span class="math display">
\hat{Y} = -0.9085714 + 1.2571429 \times (40)
</span> <span class="math display">\hat{Y} = -0.9085714 + 50.2657160</span> <span class="math display">\hat{Y} = 49.3571446</span></p>
<p>For <span class="math inline">X = 60</span>:</p>
<p><span class="math display">
\hat{Y} = -0.9085714 + 1.2571429 \times (60)
</span> <span class="math display">\hat{Y} = -0.9085714 + 75.4285740</span> <span class="math display">\hat{Y} = 74.5200026</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification of predicted values</span></span>
<span id="cb186-2"><a href="#cb186-2" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.9085714</span> <span class="sc">+</span> <span class="fl">1.2571429</span> <span class="sc">*</span> income</span>
<span id="cb186-3"><a href="#cb186-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb186-4"><a href="#cb186-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X =</span> income,</span>
<span id="cb186-5"><a href="#cb186-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y =</span> turnout,</span>
<span id="cb186-6"><a href="#cb186-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Y_hat =</span> y_hat,</span>
<span id="cb186-7"><a href="#cb186-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span></span>
<span id="cb186-8"><a href="#cb186-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   X  Y    Y_hat
1 50 60 61.94857
2 45 56 55.66286
3 56 70 69.49143
4 40 50 49.37714
5 60 75 74.52000</code></pre>
</div>
</div>
<p><strong>Step 2: Calculate SST (Total Sum of Squares)</strong></p>
<p><span class="math display">SST = \sum(Y_i - \bar{Y})^2 \text{ where } \bar{Y} = 62.2</span></p>
<p><span class="math display">(60 - 62.2)^2 = (-2.2)^2 = 4.84</span> <span class="math display">(56 - 62.2)^2 = (-6.2)^2 = 38.44</span> <span class="math display">(70 - 62.2)^2 = (7.8)^2 = 60.84</span> <span class="math display">(50 - 62.2)^2 = (-12.2)^2 = 148.84</span> <span class="math display">(75 - 62.2)^2 = (12.8)^2 = 163.84</span></p>
<p><span class="math display">SST = 4.84 + 38.44 + 60.84 + 148.84 + 163.84 = 416.8</span></p>
<p><strong>Step 3: Calculate SSR (Regression Sum of Squares)</strong></p>
<p><span class="math display">SSR = \sum(\hat{Y}_i - \bar{Y})^2</span></p>
<p><span class="math display">(61.9485736 - 62.2)^2 = (-0.2514264)^2 = 0.0632151</span> <span class="math display">(55.6535591 - 62.2)^2 = (-6.5464409)^2 = 42.8558689</span> <span class="math display">(69.5114310 - 62.2)^2 = (7.3114310)^2 = 53.4570178</span> <span class="math display">(49.3571446 - 62.2)^2 = (-12.8428554)^2 = 164.9389370</span> <span class="math display">(74.5200026 - 62.2)^2 = (12.3200026)^2 = 151.7824640</span></p>
<p><span class="math display">SSR = 413.0975028</span></p>
<p><strong>Step 4: Calculate SSE (Error Sum of Squares)</strong></p>
<p><span class="math display">SSE = \sum(Y_i - \hat{Y}_i)^2</span></p>
<p><span class="math display">(60 - 61.9485736)^2 = (-1.9485736)^2 = 3.7969384</span> <span class="math display">(56 - 55.6535591)^2 = (0.3464409)^2 = 0.1200212</span> <span class="math display">(70 - 69.5114310)^2 = (0.4885690)^2 = 0.2387198</span> <span class="math display">(50 - 49.3571446)^2 = (0.6428554)^2 = 0.4132631</span> <span class="math display">(75 - 74.5200026)^2 = (0.4799974)^2 = 0.2303975</span></p>
<p><span class="math display">SSE = 4.7024972</span></p>
<p><strong>Step 5: Verify decomposition</strong></p>
<p><span class="math display">SST = SSR + SSE</span> <span class="math display">416.8 = 413.0975028 + 4.7024972</span></p>
<p><strong>Step 6: Calculate R-squared</strong></p>
<p><span class="math display">R^2 = \frac{SSR}{SST} = \frac{413.0975028}{416.8} = 0.9916</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>r.squared  <span class="co"># Should match our calculation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9885135</code></pre>
</div>
</div>
</section>
<section id="visualization" class="level3">
<h3 class="anchored" data-anchor-id="visualization">Visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">income =</span> income, <span class="at">turnout =</span> turnout)</span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> income, <span class="at">y =</span> turnout)) <span class="sc">+</span></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb190-7"><a href="#cb190-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb190-8"><a href="#cb190-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Voter Turnout vs Income per Capita"</span>,</span>
<span id="cb190-9"><a href="#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Income per Capita (thousands €)"</span>,</span>
<span id="cb190-10"><a href="#cb190-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Voter Turnout (%)"</span></span>
<span id="cb190-11"><a href="#cb190-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb190-12"><a href="#cb190-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb190-13"><a href="#cb190-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb190-14"><a href="#cb190-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>),</span>
<span id="cb190-15"><a href="#cb190-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb190-16"><a href="#cb190-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-1" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-1">Interpretation</h3>
<p>The analysis shows:</p>
<ol type="1">
<li><p>A very strong positive correlation (<span class="math inline">r = 0.994</span>) between income and voter turnout</p></li>
<li><p>The regression equation <span class="math display">\hat{Y} = -0.9085714 + 1.2571429X</span> indicates that:</p>
<ul>
<li>For each €1,000 increase in income, turnout increases by about 1.26 percentage points</li>
<li>The intercept (<span class="math inline">-0.9086</span>) has little practical meaning as income is never zero</li>
</ul></li>
<li><p>The R-squared of 0.9916 indicates that 99.16% of the variance in turnout is explained by income</p></li>
</ol>
</section>
</section>
<section id="anxiety-levels-and-cognitive-performance-a-laboratory-study" class="level2" data-number="15.24">
<h2 data-number="15.24" class="anchored" data-anchor-id="anxiety-levels-and-cognitive-performance-a-laboratory-study"><span class="header-section-number">15.24</span> Anxiety Levels and Cognitive Performance: A Laboratory Study</h2>
<section id="data-and-context" class="level3">
<h3 class="anchored" data-anchor-id="data-and-context">Data and Context</h3>
<p>In a psychology experiment, researchers measured the relationship between anxiety levels (measured by galvanic skin response, GSR) and cognitive performance (score on a working memory task).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb191"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb191-1"><a href="#cb191-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb191-2"><a href="#cb191-2" aria-hidden="true" tabindex="-1"></a>anxiety <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">2.1</span>, <span class="fl">3.4</span>, <span class="fl">4.2</span>, <span class="fl">5.1</span>, <span class="fl">5.8</span>, <span class="fl">6.4</span>, <span class="fl">7.2</span>, <span class="fl">8.0</span>)  <span class="co"># GSR readings</span></span>
<span id="cb191-3"><a href="#cb191-3" aria-hidden="true" tabindex="-1"></a>performance <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">92</span>, <span class="dv">88</span>, <span class="dv">84</span>, <span class="dv">78</span>, <span class="dv">74</span>, <span class="dv">70</span>, <span class="dv">65</span>, <span class="dv">62</span>)      <span class="co"># Working memory scores</span></span>
<span id="cb191-4"><a href="#cb191-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb191-5"><a href="#cb191-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial model check</span></span>
<span id="cb191-6"><a href="#cb191-6" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(performance <span class="sc">~</span> anxiety)</span>
<span id="cb191-7"><a href="#cb191-7" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = performance ~ anxiety)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.8993 -0.6660  0.2162  0.6106  1.5262 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 105.3248     1.3189   79.86 2.60e-10 ***
anxiety      -5.4407     0.2359  -23.06 4.35e-07 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.236 on 6 degrees of freedom
Multiple R-squared:  0.9888,    Adjusted R-squared:  0.987 
F-statistic: 531.9 on 1 and 6 DF,  p-value: 4.355e-07</code></pre>
</div>
</div>
</section>
<section id="descriptive-statistics" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics">Descriptive Statistics</h3>
<p><strong>Means:</strong> <span class="math display">\bar{X} = \frac{2.1 + 3.4 + 4.2 + 5.1 + 5.8 + 6.4 + 7.2 + 8.0}{8} = \frac{42.2}{8} = 5.275</span></p>
<p><span class="math display">\bar{Y} = \frac{92 + 88 + 84 + 78 + 74 + 70 + 65 + 62}{8} = \frac{613}{8} = 76.625</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(anxiety)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.275</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 76.625</code></pre>
</div>
</div>
<p><strong>Variances:</strong> <span class="math display">s^2_X = \frac{\sum(X_i - \bar{X})^2}{n-1}</span></p>
<p>Deviations for X:</p>
<ul>
<li><span class="math inline">(2.1 - 5.275) = -3.175</span></li>
<li><span class="math inline">(3.4 - 5.275) = -1.875</span></li>
<li><span class="math inline">(4.2 - 5.275) = -1.075</span></li>
<li><span class="math inline">(5.1 - 5.275) = -0.175</span></li>
<li><span class="math inline">(5.8 - 5.275) = 0.525</span></li>
<li><span class="math inline">(6.4 - 5.275) = 1.125</span></li>
<li><span class="math inline">(7.2 - 5.275) = 1.925</span></li>
<li><span class="math inline">(8.0 - 5.275) = 2.725</span></li>
</ul>
<p>Squared deviations:</p>
<p><span class="math display">10.08063 + 3.51563 + 1.15563 + 0.03063 + 0.27563 + 1.26563 + 3.70563 +
7.42563 = 27.45500</span></p>
<p><span class="math display">s^2_X = \frac{27.45500}{7} = 3.922143</span></p>
<p>Similarly for Y: Deviations:</p>
<p><span class="math display">15.375, 11.375, 7.375, 1.375, -2.625, -6.625, -11.625, -14.625</span></p>
<p><span class="math display">s^2_Y = \frac{236.875 + 129.391 + 54.391 + 1.891 + 6.891 + 43.891 + 135.141 + 213.891}{7} = \frac{822.362}{7} = 117.4803</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(anxiety)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.922143</code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 117.4107</code></pre>
</div>
</div>
</section>
<section id="covariance-and-correlation-1" class="level3">
<h3 class="anchored" data-anchor-id="covariance-and-correlation-1">Covariance and Correlation</h3>
<p><strong>Covariance:</strong> <span class="math display">s_{XY} = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{n-1}</span></p>
<p>Products of deviations:</p>
<p><span class="math display">(-3.175 × 15.375) = -48.815625</span></p>
<p><span class="math display">(-1.875 × 11.375) = -21.328125</span></p>
<p><span class="math display">(-1.075 × 7.375) = -7.928125</span></p>
<p><span class="math display">(-0.175 × 1.375) = -0.240625</span></p>
<p><span class="math display">(0.525 × -2.625) = -1.378125</span></p>
<p><span class="math display">(1.125 × -6.625) = -7.453125</span></p>
<p><span class="math display">(1.925 × -11.625) = -22.378125</span></p>
<p><span class="math display">(2.725 × -14.625) = -39.853125</span></p>
<p>Sum <span class="math inline">= -149.375</span></p>
<p><span class="math display">s_{XY} = \frac{-149.375}{7} = -21.33929</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb201-2"><a href="#cb201-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(anxiety, performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -21.33929</code></pre>
</div>
</div>
<p><strong>Correlation:</strong> <span class="math display">r_{XY} = \frac{s_{XY}}{\sqrt{s^2_X}\sqrt{s^2_Y}} = \frac{-21.33929}{\sqrt{3.922143}\sqrt{117.4803}} = -0.9932</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(anxiety, performance)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9944073</code></pre>
</div>
</div>
</section>
<section id="ols-regression-haty-hatbeta_0-hatbeta_1x-1" class="level3">
<h3 class="anchored" data-anchor-id="ols-regression-haty-hatbeta_0-hatbeta_1x-1">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></h3>
<p><strong>Slope coefficient:</strong> <span class="math display">\hat{\beta_1} = \frac{s_{XY}}{s^2_X} = \frac{-21.33929}{3.922143} = -5.4407</span></p>
<p><strong>Intercept:</strong> <span class="math display">\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X}</span> Steps:</p>
<ol type="1">
<li><span class="math inline">-5.4407 × 5.275 = -28.6997</span></li>
<li><span class="math inline">\hat{\beta_0} = 76.625 - (-28.6997) = 105.3247</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb205-2"><a href="#cb205-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     anxiety 
 105.324804   -5.440721 </code></pre>
</div>
</div>
</section>
<section id="r-squared-calculation" class="level3">
<h3 class="anchored" data-anchor-id="r-squared-calculation">4. R-squared Calculation</h3>
<p><strong>Step 1: Calculate predicted values</strong> <span class="math inline">(\hat{Y})</span>: <span class="math display">\hat{Y} = 105.3247 - 5.4407X</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fl">105.3247</span> <span class="sc">-</span> <span class="fl">5.4407</span> <span class="sc">*</span> anxiety</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Anxiety =</span> anxiety,</span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Performance =</span> performance,</span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> y_hat,</span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span></span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Anxiety Performance Predicted
1     2.1          92  93.89923
2     3.4          88  86.82632
3     4.2          84  82.47376
4     5.1          78  77.57713
5     5.8          74  73.76864
6     6.4          70  70.50422
7     7.2          65  66.15166
8     8.0          62  61.79910</code></pre>
</div>
</div>
<p><strong>Step 2: Sum of Squares</strong></p>
<p><span class="math inline">SST = \sum(Y_i - \bar{Y})^2 = 822.362</span></p>
<p><span class="math inline">SSR = \sum(\hat{Y}_i - \bar{Y})^2 = 816.3094</span></p>
<p><span class="math inline">SSE = \sum(Y_i - \hat{Y}_i)^2 = 6.0526</span></p>
<p><strong>R-squared:</strong> <span class="math display">R^2 = \frac{SSR}{SST} = \frac{816.3094}{822.362} = 0.9926</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb209-2"><a href="#cb209-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.9888459</code></pre>
</div>
</div>
</section>
<section id="visualization-1" class="level3">
<h3 class="anchored" data-anchor-id="visualization-1">Visualization</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb211-2"><a href="#cb211-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-3"><a href="#cb211-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">data.frame</span>(anxiety, performance), <span class="fu">aes</span>(<span class="at">x =</span> anxiety, <span class="at">y =</span> performance)) <span class="sc">+</span></span>
<span id="cb211-4"><a href="#cb211-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb211-5"><a href="#cb211-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb211-6"><a href="#cb211-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb211-7"><a href="#cb211-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cognitive Performance vs. Anxiety Levels"</span>,</span>
<span id="cb211-8"><a href="#cb211-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Anxiety (GSR)"</span>,</span>
<span id="cb211-9"><a href="#cb211-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Performance Score"</span></span>
<span id="cb211-10"><a href="#cb211-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb211-11"><a href="#cb211-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="interpretation-2" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-2">Interpretation</h3>
<ol type="1">
<li>Strong negative correlation (r = -0.993) between anxiety and cognitive performance</li>
<li>For each unit increase in GSR (anxiety), performance decreases by approximately 5.44 points</li>
<li>The model explains 99.26% of the variance in performance scores</li>
<li>The relationship appears to be strongly linear, suggesting a reliable anxiety-performance relationship</li>
<li>The high intercept (105.32) represents the theoretical maximum performance at zero anxiety</li>
</ol>
</section>
<section id="study-limitations" class="level3">
<h3 class="anchored" data-anchor-id="study-limitations">Study Limitations</h3>
<ol type="1">
<li>Small sample size (n=8)</li>
<li>Possible other confounding variables</li>
<li>Limited range of anxiety levels</li>
<li>Cross-sectional rather than longitudinal data</li>
</ol>
</section>
</section>
<section id="district-magnitude-and-electoral-disproportionality-a-comparative-analysis" class="level2" data-number="15.25">
<h2 data-number="15.25" class="anchored" data-anchor-id="district-magnitude-and-electoral-disproportionality-a-comparative-analysis"><span class="header-section-number">15.25</span> District Magnitude and Electoral Disproportionality: A Comparative Analysis</h2>
<section id="data-generating-process" class="level3">
<h3 class="anchored" data-anchor-id="data-generating-process">Data Generating Process</h3>
<p>Let’s set up a DGP where:</p>
<p><span class="math display">\begin{aligned}
&amp; Y_{\text{Gallagher}} = 12 - 0.8X_{\text{DM}} + \varepsilon \\
&amp; \varepsilon \sim \mathcal{N}(0, 1) \\
&amp; X_{\text{DM}} \in \{3, 5, 7, 10, 12, 15\}
\end{aligned}</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb212"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb212-1"><a href="#cb212-1" aria-hidden="true" tabindex="-1"></a><span class="co"># DGP</span></span>
<span id="cb212-2"><a href="#cb212-2" aria-hidden="true" tabindex="-1"></a>magnitude <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">12</span>, <span class="dv">15</span>)</span>
<span id="cb212-3"><a href="#cb212-3" aria-hidden="true" tabindex="-1"></a>epsilon <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="dv">6</span>, <span class="at">mean =</span> <span class="dv">0</span>, <span class="at">sd =</span> <span class="dv">1</span>)</span>
<span id="cb212-4"><a href="#cb212-4" aria-hidden="true" tabindex="-1"></a>gallagher <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">-</span> <span class="fl">0.8</span> <span class="sc">*</span> magnitude <span class="sc">+</span> epsilon</span>
<span id="cb212-5"><a href="#cb212-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-6"><a href="#cb212-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Round (sampled from the DGP) Gallagher indices to one decimal place</span></span>
<span id="cb212-7"><a href="#cb212-7" aria-hidden="true" tabindex="-1"></a>gallagher <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="fu">c</span>(<span class="fl">9.0</span>, <span class="fl">7.8</span>, <span class="fl">9.2</span>, <span class="fl">4.1</span>, <span class="fl">2.5</span>, <span class="fl">1.7</span>), <span class="dv">1</span>)</span>
<span id="cb212-8"><a href="#cb212-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb212-9"><a href="#cb212-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Show data</span></span>
<span id="cb212-10"><a href="#cb212-10" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb212-11"><a href="#cb212-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">District_Magnitude =</span> magnitude,</span>
<span id="cb212-12"><a href="#cb212-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gallagher_Index =</span> gallagher</span>
<span id="cb212-13"><a href="#cb212-13" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  District_Magnitude Gallagher_Index
1                  3             9.0
2                  5             7.8
3                  7             9.2
4                 10             4.1
5                 12             2.5
6                 15             1.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb214"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb214-1"><a href="#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Initial model check</span></span>
<span id="cb214-2"><a href="#cb214-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(gallagher <span class="sc">~</span> magnitude)</span>
<span id="cb214-3"><a href="#cb214-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = gallagher ~ magnitude)

Residuals:
      1       2       3       4       5       6 
-0.6516 -0.4628  2.3260 -0.6908 -0.9020  0.3813 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  11.7349     1.3034   9.003 0.000843 ***
magnitude    -0.6944     0.1359  -5.110 0.006934 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.368 on 4 degrees of freedom
Multiple R-squared:  0.8672,    Adjusted R-squared:  0.834 
F-statistic: 26.11 on 1 and 4 DF,  p-value: 0.006934</code></pre>
</div>
</div>
</section>
<section id="descriptive-statistics-1" class="level3">
<h3 class="anchored" data-anchor-id="descriptive-statistics-1">Descriptive Statistics</h3>
<p><strong>Means:</strong> <span class="math display">\bar{X} = \frac{3 + 5 + 7 + 10 + 12 + 15}{6} = \frac{52}{6} = 8.6667</span></p>
<p><span class="math display">\bar{Y} = \frac{9.0 + 7.8 + 9.2 + 4.1 + 2.5 + 1.7}{6} = \frac{34.3}{6} = 5.7167</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb216"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb216-1"><a href="#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb216-2"><a href="#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(magnitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 8.666667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb218"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb218-1"><a href="#cb218-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(gallagher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.716667</code></pre>
</div>
</div>
<p><strong>Variances:</strong> <span class="math display">s^2_X = \frac{\sum(X_i - \bar{X})^2}{n-1}</span></p>
<p>Deviations for X:</p>
<ul>
<li>(3 - 8.6667) = -5.6667</li>
<li>(5 - 8.6667) = -3.6667</li>
<li>(7 - 8.6667) = -1.6667</li>
<li>(10 - 8.6667) = 1.3333</li>
<li>(12 - 8.6667) = 3.3333</li>
<li>(15 - 8.6667) = 6.3333</li>
</ul>
<p>Squared deviations:</p>
<p><span class="math display">
32.1115 + 13.4445 + 2.7779 + 1.7777 + 11.1109 + 40.1107 = 101.3332
</span></p>
<p><span class="math display">s^2_X = \frac{101.3332}{5} = 20.2666</span></p>
<p>For Y: Deviations: 3.2833, 2.0833, 3.4833, -1.6167, -3.2167, -4.0167</p>
<p><span class="math display">s^2_Y = \frac{56.3483}{5} = 11.2697</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb220"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb220-1"><a href="#cb220-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb220-2"><a href="#cb220-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(magnitude)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 20.26667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(gallagher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 11.26967</code></pre>
</div>
</div>
</section>
<section id="covariance-and-correlation-2" class="level3">
<h3 class="anchored" data-anchor-id="covariance-and-correlation-2">Covariance and Correlation</h3>
<p><strong>Covariance:</strong> <span class="math display">s_{XY} = \frac{\sum(X_i - \bar{X})(Y_i - \bar{Y})}{n-1}</span></p>
<p>Products of deviations:</p>
<ul>
<li>(-5.6667 × 3.2833) = -18.6057</li>
<li>(-3.6667 × 2.0833) = -7.6387</li>
<li>(-1.6667 × 3.4833) = -5.8056</li>
<li>(1.3333 × -1.6167) = -2.1556</li>
<li>(3.3333 × -3.2167) = -10.7223</li>
<li>(6.3333 × -4.0167) = -25.4391</li>
</ul>
<p>Sum = -70.3670</p>
<p><span class="math display">s_{XY} = \frac{-70.3670}{5} = -14.0734</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cov</span>(magnitude, gallagher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -14.07333</code></pre>
</div>
</div>
<p><strong>Correlation:</strong> <span class="math display">r_{XY} = \frac{s_{XY}}{\sqrt{s^2_X}\sqrt{s^2_Y}} = \frac{-14.0734}{\sqrt{20.2666}\sqrt{11.2697}} = -0.9279</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(magnitude, gallagher)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -0.9312157</code></pre>
</div>
</div>
</section>
<section id="ols-regression-haty-hatbeta_0-hatbeta_1x-2" class="level3">
<h3 class="anchored" data-anchor-id="ols-regression-haty-hatbeta_0-hatbeta_1x-2">OLS Regression <span class="math inline">(\hat{Y} = \hat{\beta_0} + \hat{\beta_1}X)</span></h3>
<p><strong>Slope coefficient:</strong> <span class="math display">\hat{\beta_1} = \frac{s_{XY}}{s^2_X} = \frac{-14.0734}{20.2666} = -0.6944</span></p>
<p><strong>Intercept:</strong> <span class="math display">\hat{\beta_0} = \bar{Y} - \hat{\beta_1}\bar{X}</span> Steps:</p>
<ol type="1">
<li><span class="math inline">-0.6944 × 8.6667 = -6.0181</span></li>
<li><span class="math inline">\hat{\beta_0} = 5.7167 - (-6.0181) = 11.7348</span></li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)   magnitude 
 11.7348684  -0.6944079 </code></pre>
</div>
</div>
</section>
<section id="r-squared-calculation-1" class="level3">
<h3 class="anchored" data-anchor-id="r-squared-calculation-1">R-squared Calculation</h3>
<p><strong>Step 1: Calculate predicted values</strong> <span class="math inline">(\hat{Y})</span>:</p>
<p><span class="math display">\hat{Y} = 11.7348 - 0.6944X</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted values</span></span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>y_hat <span class="ot">&lt;-</span> <span class="fl">11.7348</span> <span class="sc">-</span> <span class="fl">0.6944</span> <span class="sc">*</span> magnitude</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Magnitude =</span> magnitude,</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Gallagher =</span> gallagher,</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">Predicted =</span> y_hat,</span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">row.names =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Magnitude Gallagher Predicted
1         3       9.0    9.6516
2         5       7.8    8.2628
3         7       9.2    6.8740
4        10       4.1    4.7908
5        12       2.5    3.4020
6        15       1.7    1.3188</code></pre>
</div>
</div>
<p><strong>Step 2: Sum of Squares</strong> <span class="math inline">SST = \sum(Y_i - \bar{Y})^2 = 56.3483</span> <span class="math inline">SSR = \sum(\hat{Y}_i - \bar{Y})^2 = 48.5271</span> <span class="math inline">SSE = \sum(Y_i - \hat{Y}_i)^2 = 7.8212</span></p>
<p><strong>R-squared:</strong> <span class="math display">R^2 = \frac{SSR}{SST} = \frac{48.5271}{56.3483} = 0.8612</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Verification</span></span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>r.squared</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.8671626</code></pre>
</div>
</div>
</section>
<section id="visualization---true-vs.-estimated-parameters" class="level3">
<h3 class="anchored" data-anchor-id="visualization---true-vs.-estimated-parameters">Visualization - True vs.&nbsp;Estimated Parameters</h3>
<ul>
<li>True DGP: Y = 12 - 0.8X + ε</li>
<li>Estimated Model: Y = 11.7348 - 0.6944X</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb234"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb234-1"><a href="#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb234-2"><a href="#cb234-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-3"><a href="#cb234-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create data frame with original data</span></span>
<span id="cb234-4"><a href="#cb234-4" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb234-5"><a href="#cb234-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">magnitude =</span> magnitude,</span>
<span id="cb234-6"><a href="#cb234-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">gallagher =</span> gallagher</span>
<span id="cb234-7"><a href="#cb234-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb234-8"><a href="#cb234-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-9"><a href="#cb234-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create sequence for smooth lines</span></span>
<span id="cb234-10"><a href="#cb234-10" aria-hidden="true" tabindex="-1"></a>x_seq <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="fu">min</span>(magnitude), <span class="fu">max</span>(magnitude), <span class="at">length.out =</span> <span class="dv">100</span>)</span>
<span id="cb234-11"><a href="#cb234-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-12"><a href="#cb234-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate predicted values for both lines</span></span>
<span id="cb234-13"><a href="#cb234-13" aria-hidden="true" tabindex="-1"></a>true_dgp <span class="ot">&lt;-</span> <span class="dv">12</span> <span class="sc">-</span> <span class="fl">0.8</span> <span class="sc">*</span> x_seq</span>
<span id="cb234-14"><a href="#cb234-14" aria-hidden="true" tabindex="-1"></a>estimated <span class="ot">&lt;-</span> <span class="fl">11.7348</span> <span class="sc">-</span> <span class="fl">0.6944</span> <span class="sc">*</span> x_seq</span>
<span id="cb234-15"><a href="#cb234-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-16"><a href="#cb234-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine into a data frame for plotting</span></span>
<span id="cb234-17"><a href="#cb234-17" aria-hidden="true" tabindex="-1"></a>lines_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb234-18"><a href="#cb234-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">magnitude =</span> <span class="fu">rep</span>(x_seq, <span class="dv">2</span>),</span>
<span id="cb234-19"><a href="#cb234-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">value =</span> <span class="fu">c</span>(true_dgp, estimated),</span>
<span id="cb234-20"><a href="#cb234-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">Model =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">"True DGP"</span>, <span class="st">"Estimated"</span>), <span class="at">each =</span> <span class="fu">length</span>(x_seq))</span>
<span id="cb234-21"><a href="#cb234-21" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb234-22"><a href="#cb234-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb234-23"><a href="#cb234-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Create plot</span></span>
<span id="cb234-24"><a href="#cb234-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb234-25"><a href="#cb234-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> lines_df, </span>
<span id="cb234-26"><a href="#cb234-26" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> magnitude, <span class="at">y =</span> value, <span class="at">color =</span> Model, <span class="at">linetype =</span> Model),</span>
<span id="cb234-27"><a href="#cb234-27" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb234-28"><a href="#cb234-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> df, </span>
<span id="cb234-29"><a href="#cb234-29" aria-hidden="true" tabindex="-1"></a>             <span class="fu">aes</span>(<span class="at">x =</span> magnitude, <span class="at">y =</span> gallagher),</span>
<span id="cb234-30"><a href="#cb234-30" aria-hidden="true" tabindex="-1"></a>             <span class="at">color =</span> <span class="st">"black"</span>, </span>
<span id="cb234-31"><a href="#cb234-31" aria-hidden="true" tabindex="-1"></a>             <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb234-32"><a href="#cb234-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"red"</span>, <span class="st">"blue"</span>)) <span class="sc">+</span></span>
<span id="cb234-33"><a href="#cb234-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_linetype_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">"dashed"</span>, <span class="st">"solid"</span>)) <span class="sc">+</span></span>
<span id="cb234-34"><a href="#cb234-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb234-35"><a href="#cb234-35" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"True DGP vs. Estimated Regression Line"</span>,</span>
<span id="cb234-36"><a href="#cb234-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Black points show observed data with random noise"</span>,</span>
<span id="cb234-37"><a href="#cb234-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"District Magnitude"</span>,</span>
<span id="cb234-38"><a href="#cb234-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Gallagher Index"</span>,</span>
<span id="cb234-39"><a href="#cb234-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"True DGP: Y = 12 - 0.8X + ε</span><span class="sc">\n</span><span class="st">Estimated: Y = 11.73 - 0.69X"</span></span>
<span id="cb234-40"><a href="#cb234-40" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb234-41"><a href="#cb234-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb234-42"><a href="#cb234-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb234-43"><a href="#cb234-43" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"top"</span>,</span>
<span id="cb234-44"><a href="#cb234-44" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.caption =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="dv">0</span>)</span>
<span id="cb234-45"><a href="#cb234-45" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="correg_en_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="observations-about-model-fit" class="level3">
<h3 class="anchored" data-anchor-id="observations-about-model-fit">Observations about Model Fit</h3>
<ol type="1">
<li><strong>Slope Comparison</strong>
<ul>
<li>True slope: -0.8</li>
<li>Estimated slope: -0.69</li>
<li>The estimated slope is reasonably close to the true parameter</li>
</ul></li>
<li><strong>Intercept Comparison</strong>
<ul>
<li>True intercept: 12</li>
<li>Estimated intercept: 11.73</li>
<li>The estimated intercept very closely approximates the true value</li>
</ul></li>
<li><strong>Visual Patterns</strong>
<ul>
<li>The lines are nearly parallel, showing good slope recovery</li>
<li>Points scatter around both lines due to the random error term (ε)</li>
<li>The small sample size (n=6) leads to some imprecision in estimation</li>
<li>The estimated line (blue) provides a good approximation of the true DGP (red dashed)</li>
</ul></li>
<li><strong>Impact of Random Error</strong>
<ul>
<li>The scatter of points around the true DGP line reflects the N(0,1) error term</li>
<li>This noise leads to the slight differences in estimated parameters</li>
<li>With a larger sample, we would expect even closer convergence to true parameters</li>
</ul></li>
</ol>
</section>
<section id="interpretation-3" class="level3">
<h3 class="anchored" data-anchor-id="interpretation-3">Interpretation</h3>
<ol type="1">
<li>Strong negative correlation (r = -0.93) between district magnitude and electoral disproportionality</li>
<li>For each unit increase in district magnitude, the Gallagher index decreases by approximately 0.69 points</li>
<li>The model explains 86.12% of the variance in disproportionality</li>
<li>The relationship appears strongly linear with moderate scatter</li>
<li>The intercept (11.73) represents the expected disproportionality in a hypothetical single-member district system</li>
</ol>
</section>
<section id="study-context" class="level3">
<h3 class="anchored" data-anchor-id="study-context">Study Context</h3>
<ul>
<li>Data represents simulated observations from a DGP with moderate noise</li>
<li>Sample shows how increasing district magnitude tends to reduce disproportionality</li>
<li>Random component reflects other institutional and political factors affecting disproportionality</li>
</ul>
</section>
<section id="limitations" class="level3">
<h3 class="anchored" data-anchor-id="limitations">Limitations</h3>
<ol type="1">
<li>Small sample size (n=6)</li>
<li>Simulated rather than real-world data</li>
<li>Assumes linear relationship</li>
<li>Does not account for other institutional features</li>
</ol>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./rozdzial6.html" class="pagination-link" aria-label="Wizualizacja Danych: z przykładami w R">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Wizualizacja Danych: z przykładami w R</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./correg_pl.html" class="pagination-link" aria-label="Wprowadzenie do Analizy Korelacji i Regresji">
        <span class="nav-page-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Wprowadzenie do Analizy Korelacji i Regresji</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>